﻿var RENDER = {
    init: function (property) {
		var History = window.History; 
		var b = property,
			URL = (b.PUBLISH) ? '/' : '/render',
			param = (b.PUBLISH) ? '/publish/true' : '',
			selectEL = '',
			galleryEL = new Object();

    	this.b = b;
		this.b.pageContent = {};
		this.b.pageContent[b.PAGE] = b.INITPAGE;
    	this.b.URL = URL;
    	this.b.param = param;
    	this.history = window.History;
    	this.b.MENULIST = [];
    	this.galleryEL = galleryEL;
    	_this = this;
    	$(window).ready(function() {
	        (function(window){
	            var History = window.History;
	            if ( !History.enabled ) {
	                return false;
	            }
	            History.Adapter.bind(window,'statechange',function(){
	                var State = History.getState(),
	                	cUrl = new getLocation(State.url),
	                	loc = cUrl.pathname,
	                	uri = (b.PUBLISH) ? loc.replace(/^\//,'').replace(/\/$/,'') : loc.replace(/\/*(render)\/*/,''),
	                	uri = uri.replace('/view/',','),
	                	s = uri.split(','),
	                	bookmark = '';

	                if($('.cl-flat-modal').length > 0) $('.cl-flat-modal .modal').modal('hide');

	                if(uri == b.URL || uri == '') {
	                	uri = (b.ONE) ? 'index' : b.MENULINK[0];
	                }

	                (typeof s[1] != 'undefined') ? b.VIEW = s[1] : b.VIEW = '';
	                b.PAGE = decodeURI(uri);
	                if(b.PAGE.indexOf('@')>-1) {
	                	var tmp = b.PAGE.split('@');
	                	b.PAGE = tmp[0];
	                	bookmark = tmp[1];
	                }

	                if((b.PAGE).indexOf(',')>-1) {
	                	var tmp = b.PAGE.split(',');
	                	b.VIEW = tmp[1];
	                }

			    	var callParent = getParent(s[0],b.VIEW,	b.PAGE),
			    		pageMove = true;

			    	if(b.VIEW && s[0] != 'forum' && s[0] != 'psearch' && b.COUNT == 0 && !b.PUBLISH) {
			    		$(this).showModalFlat('INFORMATION','Page not found',true,false,'','ok');
			    		History.back();
			    		pageMove = false;
			    	}

			    	if(pageMove) {
			    		var menu_name = decodeURIComponent(loc),
			    			pagemenu_link = '#tpl-menu.nav li a[href="' + menu_name + '"]';
			    		//$('#tpl-menu.nav li').removeClass('active');
			    		//$('#tpl-menu.nav li a[href="' + menu_name + '"]').parent().addClass('active');

			    		if(!$(pagemenu_link).parent().hasClass('active')) {
			              	$('#tpl-menu li').removeClass('active').removeClass('open');

			              	$(pagemenu_link).parent().addClass('active');
			              	if($(pagemenu_link).closest('.dropdown-menu').length>0) {
			                  	if($('body').width() > 768) $(pagemenu_link).closest('.dropdown').addClass('active');
			                  	else $(pagemenu_link).closest('.dropdown').addClass('open');
			              	} else {
			                	if($('.el-menu > header').hasClass('navbar-fheader')) $('#mobile-nav li.menu-has-children ul.dropdown-menu').hide();
				                else {
				                  if($('body').width() < 768) $('#tpl-menu li.dropdown ul.dropdown-menu').hide();
				                }
			              	}
			            }

			    		callParent.then(function() {
			    			$.post('/template/conf',{ sid : b.SID, page : b.PAGE, publish : b.PUBLISH }, function(data) {
			    				b.ISLOCK = data.islock;
			    				b.HEADER = (data.overlay) ? 1 : 0;

			    				var isSidebar = ($('header').hasClass('sidebar')) ? true : false;
			    				if(b.HEADER && !isSidebar) {
			    					$('.header-empty').css('height',0);
			    					$('.header.el-menu').removeClass('fixed');
			    					$('header.navbar').addClass('transparent');
			    				} else {
			    					$('header.navbar').removeClass('transparent');
			    				}

			    				$('#pageScript').remove();
			    				if(data.pageScript) $('body').append(data.pageScript);
			    				if(data.meta != null) {
			    					$.each(data.meta, function(k,v) {
			    						$('meta[name="' + k + '"]').attr('content',v);
			    						if(k == 'title') {
			    							$(document).prop('title', v);
			    						}
			    					});
			    				}
			    			},'json');
			    		}).then(function() {
			                clearDsgnbody();
			                if($('.popup').length) $('.popup').remove(); //clear Popup;
					    	showPageCallback(showPage, function() {
					            var pgmove_vMode = $('.mobilepc_ch').attr('data-desktop-option');
					            if(b.VALIDPLAN) {
									if(typeof b.SETTINGS.viewportMode != 'undefined' && b.SETTINGS.vpMode_onoff===true) $.mpcWeb.mpcWebhtml(pgmove_vMode,b.pageContent[b.PAGE],b.SETTINGS.zoom,'pagemove');
					            }

					        	if(b.VIEW) {
									if(b.PARENT.mode == 'shopping') {
										$('.data-page-prev, .data-page-next').removeClass('active');
										if(b.PARENT.prev) $('.data-page-prev').addClass('active');
										if(b.PARENT.next) $('.data-page-next').addClass('active');

										if($('#review-onoff').val() == 'true') $.products.review(b.VIEW,b.PAGE);
										if($('#qna-onoff').val() == 'true') $.products.qna(b.VIEW,b.PAGE);
									} else {
										_this.displayComment(b.VIEW);
						                funcCallback( displayPageToolbar, function() {
						                	setTimeout(function() {
							                    displaySnsShare(b.PARENT.pid);
							                    displayBottomList(b.PARENT.pid);
						                	}, 100);
						                });
						            }
					            }

							    setTimeout(function() {
							    	if(b.ONE && !b.VIEW || (b.PAGE == b.MENULINK[0]) && !b.VIEW) setSitePopup();
									if(b.VALIDPLAN && (b.VALIDTYPE == 'BN' || b.VALIDTYPE == 'SM')) {
										if(typeof b.SETTINGS.fnav != 'undefined' && !$.isEmptyObject(b.SETTINGS.fnav)) $.fnav.draw(b.SETTINGS.fnav);
									}
									if(b.VALIDPLAN) {
								    	if(typeof b.SETTINGS.viewportMode != 'undefined' && b.SETTINGS.vpMode_onoff===true) mobileWebfnavCheck(pgmove_vMode);
							    	}
							    }, 500);						     	
					    	});
			    		}).then(function() {
			    			if(typeof $.cookie('gallery-item') != 'undefined' && b.VIEW == '') {
					        	setTimeout(function() {
					        		moveGallery($.cookie('gallery-item'));
					        	},500);
			    			} else if(typeof $.cookie('gallery') != 'undefined' && b.VIEW == '') {
					        	setTimeout(function() {
					        		moveGallery($.cookie('gallery'));
					        	},500);
			    			} else if(typeof $.cookie('forum-item') != 'undefined' && b.VIEW == '') {
			    				setTimeout(function() {
			    					scrollToBlock('.element[data-id="' + $.cookie('forum-item') + '"]', 1000);
			    					$.removeCookie('forum-item', { path: '/' });
			    				}, 500);
			    			} else {
				    			var url = window.location;
				    			setTimeout(function() {
				    				moveScroll(0,url.href);
				    			},100);
			    			}
			    			if(typeof b.SETTINGS.google != 'undefined' && b.SETTINGS.google.length > 0) {
			    				var https_check = (location.protocol=='https:') ? 'https:' : 'http:',
			    					host_url = b.URL +  b.PAGE;

			    				host_url = (b.PARENT && b.PARENT.mode=='project') ? (host_url.replace(/,/g,"/view/")) : host_url;  

			    				if(b.SETTINGS.google.indexOf('UA-') > -1) ga('send', 'pageview', location.pathname);
			    				else if(b.SETTINGS.google.indexOf('G-') > -1) {
			    					gtag('config', b.SETTINGS.google, {
        								page_title: b.TITLE,
        								page_location: https_check + '//'+ b.HOST + host_url,
        								page_path: host_url
        							});
			    				}
								//else gtag('config', b.SETTINGS.google , {page_path : location.pathname});
    							//console.log(https_check + '//'+ b.HOST + host_url);
                                console.log('google analytics send, pageview');
			    			}
							if(typeof b.SETTINGS.naver_log != 'undefined' && b.SETTINGS.naver_log.length > 0) {
								wcs.inflow();
								wcs_do(_nasa);
								// console.log('naver analytics send, pageview');
							}
							if(typeof b.SETTINGS.gtag_event != 'undefined' && typeof b.SETTINGS.gtag_event.page != 'undefined' && b.SETTINGS.gtag_event.page.length > 0) {
								if(typeof b.SETTINGS.gtag_event.type != 'undefined' && b.SETTINGS.gtag_event.type == 'event' && b.SETTINGS.gtag_event.page == b.PAGE) {
									// console.log(b.SETTINGS.gtag_event);
									var v0 = b.SETTINGS.gtag_event.val[0],
										v1 = b.SETTINGS.gtag_event.val[1],
										v2 = b.SETTINGS.gtag_event.val[2];

									gtag(b.SETTINGS.gtag_event.type,v0,{v1:v2});
									// gtag(b.SETTINGS.gtag_event.type, b.SETTINGS.gtag_event.val[0], { b.SETTINGS.gtag_event.val[1] : b.SETTINGS.gtag_event.val[2] });
								}
							
							}

							// menu ver3 : fheader
							setTimeout(function() {
								if($('header.navbar').hasClass('navbar-fheader')) $.fheader.position();
							},400);


							// favicon refresh
							var favicon = b.RESOURCE + '/' + b.SID + '/' + b.SID + '-favicon.ico?_' + new Date().getTime();
							changeFavicon(favicon);

							if(typeof pageMoveCallback == 'function') pageMoveCallback();
							formTranslate(LANG);
			    		});
			    	}
	            });

				History.Adapter.bind(window, 'popstate', function() { // history.js suggests statechange but it has a bug with urls with hashes not firing statechange
	                var State = History.getState(),
	                	cUrl = new getLocation(State.url),
	                	bUrl = new getLocation(window.location.href);

	                if(b.ONE) {
	                	if(cUrl.href!=window.location.href) {
	                		if(b.PAGE!='index') {
	                			var link = (!b.PUBLISH) ? '/render/index' : bUrl.pathname;
								var url = new getLocation(link);
					        	golink(_this,url);
								history.pushState('', '', link + bUrl.hash);
	                		} else {
	                			// if(bUrl.hash) {
	                			// 	var go = (bUrl.hash).replace('#','');
	                			// 	moveLinkPage(go);
	                			// }
	                		}
	                	}
	                }
				});
	            
	        })(window);

		    $('.dsgn-body').addClass('mode-render');
	    	//$.modalON();

			if(typeof b.SETTINGS == 'undefined') return;
			if(typeof b.SETTINGS.rightClick == 'undefined' || b.SETTINGS.rightClick === false) return;
		    $('body').on('contextmenu', function(event){ return false; });
			$('body').on('selectstart', '.element, .forum-view, .comment-list', function(event){ return false; });
	    	$('body').on('dragstart', '.element, .forum-view, .comment-list',  function(event){ return false; });
	    });
		
		Pace.on('done', function() {
			setTimeout(function() { 
				$('body').removeClass('pace-disable'); 
			},500);

			if(typeof $.cookie('gallery-item') != 'undefined' && b.VIEW == '') {
				moveGallery($.cookie('gallery-item'));
			}
			
		    // moveScroll(0);
		});

		if(typeof pageMoveCallback == 'function') pageMoveCallback();
		formTranslate(LANG);

	    $('.dsgn-body').addClass('mode-render');
	    // $('button.navbar-toggle').addClass('hide');
    	// (b.WRAP) ? $('.dsgn-body').addClass('tiny') : $('.dsgn-body').removeClass('tiny');

		$('header').wrap('<div class="header el-menu" data-el="el-menu" data-name="menu"></div>');

		var $tag = $('header');
		$tag.removeClass('tpl-menu');
		if(b.ONE){
			if(b.VIEW) $tag.find('#site-home').attr('href',URL).removeClass('mini-home');
			else $tag.find('#site-home').attr('href','javascript:;').addClass('mini-home');
		} else $tag.find('#site-home').attr('href',URL).removeClass('mini-home');


		var first_elname = (b.HEADER && Object.keys(b.CONTENTS).length > 0) ? Object.keys(b.CONTENTS)[0] : '';
		if(first_elname && typeof b.CONTENTS[first_elname] != 'undefined' && b.CONTENTS[first_elname]['element']['overlap'] == 0) {
			b.HEADER = 0;					
		}

		var isSidebar = $tag.hasClass('sidebar');
		if(isSidebar) {
			$('.dsgn-body').addClass('sidebar');
			$('.header.el-menu').addClass('sidebar');
		}

		if(b.HEADER && !isSidebar) {
			$('header.navbar').addClass('transparent');
		}

		header_fixed = $('header.navbar').height();
		menu_color = $('header.navbar').css('background-color');
		if(menu_color==('rgba(0, 0, 0, 0)')) {
			$('header.navbar').css('background-color',$('dsgn-body').css('background-color'));
		}

		// footer
		$('.footer-' + b.SID).addClass('el-footer').addClass('element').attr('data-type','footer');

	    $(window).on('scroll',function() {
	    	if($('.dsgn-body').hasClass('mobile-nav-active')) return false;

			if($(this).scrollTop() > 200) {
				if($('#goto-top').css('display') == 'none') $('#goto-top').fadeIn(200);
			} else {
				if($('#goto-top').css('display') == 'block') $('#goto-top').fadeOut(200);
			}

	        if($('.dsgn-body').hasClass('sidebar')==false) {
	            fixedMenu();
	        }

	        if($(this).scrollTop() == 0 && $('header').hasClass('navbar-fheader')) {
				setTimeout(function() { $.fheader.position(); }, 200);
			}

	        scrollspy();
	        parallax();
	    });

		$(window).on('orientationchange',function(){
			if($('.blueimp-gallery-display').length) {
				var $slide = $('.blueimp-gallery .slides .slide'),
					play = $('.blueimp-gallery-playing').length,
					idx = 0;
				$.each($slide, function(i,v) {
		        	var trans = $(this).attr('style');
		        	if(trans.indexOf('translate(0px, 0px)') > 0) {
		        		idx = $(this).attr('data-index');
		        	}
				});

				var gallery = $('.blueimp-gallery-display').attr('id');
				$('#' + gallery + ' .close').click();
				$.processON();
				setTimeout(function() { 
					$.processOFF() ; 
					$('.gallery-item[data-index="' + idx + '"] a[data-gallery="#' + gallery + '"]').click(); 
					if(play) $('#' + gallery + ' .play-pause').click();
				}, 1000);
			}
		});

		$(window).resize(function () {
			$('.config-image-view').hide();
			if($('body').width() <= 768 && $('.dsgn-body').hasClass('sidebar')) {
				if($('header.navbar').hasClass('sidebar')) {
					cssSidebar('off');
				}
				//$('.dsgn-body').removeClass('sidebar').addClass('removed-sidebar');
			} else if ($('body').width() > 768 /*&& $('.dsgn-body').hasClass('removed-sidebar')*/) {
				if($('header.navbar').hasClass('sidebar')) {
					cssSidebar('on');
				}
				//$('.dsgn-body').removeClass('removed-sidebar').addClass('sidebar');
				var top = ($('.creatorlink-header').length == 1) ? '55px' : '0px';
				$('.el_0').css('margin-top',top);
				if($('.header-empty').length > 0) $('.header-empty').remove();
			}

            if( $('.header-empty').length > 0 && $('.header-empty').height() != $('.el-menu').height() ) {
            	$('.header-empty').css('height',$('.el-menu').height()+'px');
            }

			// menu ver3 : fheader
			if($('header.navbar').hasClass('navbar-fheader')) $.fheader.position();
			
	        if($('body').width() <= 768) {
	            if($('#tpl-menu li.active.dropdown').length > 0) $('#tpl-menu li.active.dropdown').removeClass('active');
	        } else {
	            if($('#tpl-menu li.active').closest('ul').hasClass('dropdown-menu')) $('#tpl-menu li.active').closest('li.dropdown').addClass('active');
	            $('#tpl-menu ul.dropdown-menu').removeAttr('style');
	        }

			// gallery option - gh
			if($('.element[data-type="gallery"] .goption[data-gh]').length > 0) refreshGalleryHeight();

	        var vpmode_opt = $('.mobilepc_ch').attr('data-desktop-option'),
     	 	   	vpmode = vpmode_opt ? vpmode_opt : b.SETTINGS.viewportMode,
         	    vpModeOnoff = (property.SETTINGS.vpMode_onoff === true) ? true : false,
         	    checkFnav = ($('.fnav').length > 0 && vpmode=='mobile_web') ? true : false,
         	    WebType = $.mpcWeb.mpcCheckWebType();

	        if($('.fnav').length > 0) {
	            if($('body').width() <= 480) {
	            	if($('#cl-music-player-icon').length > 0) $('#goto-top,#cl-music-player-icon').addClass('movedOne');
	            } 
	        }

	        if(vpModeOnoff && WebType == 'MOBILE') $.mpcWeb.mpcMusicandGoTop(checkFnav,vpmode);

	        fixedMenu();
	        scrollspy();
	        if($('.fr-view').length) {
	            setForumWrap();
	        }
	        sitePopupResize();
	    });
	    this.liveUpdate(b.SMENU);

	    if($('#tpl-menu').children().length) $('button.navbar-toggle').css('visibility','visible');

		if(b.PAGE == 'psearch') $.psearch.view();

		var displaySnsShare = function(pid) {
			var checkUrl = b.PAGE.split(','),
				type = (checkUrl[0] == 'forum') ? 'F' : 'P',
				check_view_empty = (b.VIEW && b.COUNT == 1 && $('.error_404.element[data-name="error_404"]').length == 1) ? true : false;
			if(type == 'P' && (b.COUNT == 0 || check_view_empty)) return false;

		    var option = (b.PARENT.settings) ? jQuery.parseJSON(b.PARENT.settings) : {};
		    if(typeof option.sns_share_display == 'undefined' || !option.sns_share_display) return false;
		    else if ( option.sns_share_display == 'ON') {
		    	if(type == 'F') $('.tpl-forum-list-footer .tpl-page-toolbar .tpl-forum-toolbar-button.share').removeClass('hide');
		    	else $( '.tpl-page-footer' ).removeClass( 'hide' );
		    }
		}

		$('[data-imglink="true"][attr-link]').live('click',function(){
		    var imgtarget = $(this).attr('data-target'),
		        imgshlink = $(this).attr('data-shlink'),
		        imgblank = $(this).attr('data-blank');

		    if(imgblank == '_blank') {
		        var openNewWindow = window.open('about:blank');
		            openNewWindow.location.href=imgshlink; 
		    } else {
		        location.href=imgshlink;
		    }
		});

		$('.siteLANG ul a, .siteLANG-dmenu-wrap ul li a').live({
			click: function(e) {
				e.preventDefault();
				var sid = (typeof SID != 'undefined' && SID) ? SID : property.SID,
					slang_code = $(this).attr('data-code'),
					slang_str = $(this).text().trim();

				changeLanguage(slang_code);
			}
		});

		$('.sitePopupTodayHide, .sitePopupClose').live({
			click: function() {
				if($(this).hasClass('sitePopupTodayHide')) $(this).find('input').click();
				var selectedPopup = $(this).closest('.modal-popup').attr('id');
				$('#' + selectedPopup).find('.popup-close').click();
			}
		});

		$('.popup-close').live({
		    click: function() {
		        var selectedPopup = $(this).closest('.modal-popup').attr('id'),
		            idx = $(this).closest('.modal-popup').attr('data-idx'),
		            ptime = $(this).closest('.modal-popup').attr('data-time'),
		            isTodayHide = $(this).closest('.modal-popup').find('.sitePopupTodayHide input').prop('checked'),
		            date = new Date();
		            
		        var ptime_val = {
					'always'    : 0,
					'onlyone'   : 365 * 24 * 60 * 60 * 1000,
					'week'      : 7 * 24 * 60 * 60 * 1000, 
					'day'       : 24 * 60 * 60 * 1000, 
					'12hour'    : 12 * 60 * 60 * 1000, 
					'6hour'     : 6 * 60 * 60 * 1000, 
					'2hour'     : 2 * 60 * 60 * 1000, 
					'1hour'     : 60 * 60 * 1000, 
					'30min'     : 30 * 60 * 1000, 
					'10min'     : 10 * 60 * 1000
		        };

		        if(isTodayHide) {
		        	date.setTime(date.getTime() + ptime_val['day']);
		        } else { 
		        	date.setTime(date.getTime() + ptime_val[ptime]);
		        }
		        $('#' + selectedPopup).fadeOut();
		        if(isTodayHide || (typeof ptime !='undefined' && ptime != 'always' && ptime != '')) { $.cookie(selectedPopup, true, { path: '/', expires: date}); }
		        else { $.removeCookie(selectedPopup, { path: '/' }); }
		    }
		});

		var displayBottomList = function(pid) {
			
			var checkUrl = b.PAGE.split(','),
				type = (checkUrl[0] == 'forum') ? 'F' : 'P',
				check_view_empty = (b.VIEW && b.COUNT == 1 && $('.error_404.element[data-name="error_404"]').length == 1) ? true : false;
			if(type == 'P' && (b.COUNT == 0 || check_view_empty)) return false;

			var option = (b.PARENT.settings) ? jQuery.parseJSON(b.PARENT.settings) : {};
			if(typeof option.bottomlist_display == 'undefined' || !option.bottomlist_display) return false;
			else if (option.bottomlist_display == 'ON') {
				$.bottomlist.init({
					pid : pid,
					type : type
				});
			}
		}

		var moveScroll = function(interval, loc) {
			var url = (typeof loc == 'undefined') ? decodeURIComponent(document.URL) : decodeURIComponent(loc);
		    link = url.split('#').pop();
		    if($.inArray(link,b.MENULINK) > -1 && b.ONE && !b.VIEW) {
		        moveLinkPage(link,interval);
		        $.removeCookie('gallery', { path: '/' });
		        $.removeCookie('gallery-item', { path : '/' });
		    } else if (url.match(/\@/g)) {
		        link = url.split('\@').pop();
		        var bookmark_link = url.substr(url.lastIndexOf('/')+1);
		        if(link) moveLinkPage(bookmark_link,800,true);
		    }
		}

		var moveBookmark = function(page,bookmark,interval,target) {
			var page_arr = (typeof page == 'undefined') ? new Array() : page.split('\,'),
				view = (page_arr.length > 1) ? page_arr[1] : '';

		    interval = (typeof interval == 'undefined') ? 1200 : interval;
		    target = (typeof target == 'undefined') ? '' : target;

		    if( (view!='' && view==b.VIEW && !target) || (view=='' && !b.VIEW && page_arr[0]==b.PAGE && !target) ) {
		        moveLinkPage(page_arr[0]+bookmark,interval,true);
		    } else {
		        var linkUrl = '';
		        if(b.ONE) {
		            linkUrl = (view.length>0) ? '/index/view/' + view : '/index';
		            linkUrl = (!b.PUBLISH) ? '/render' + linkUrl + bookmark : linkUrl + bookmark;
		        } else {
		        	var url_str = (view.length>0) ? page_arr[0] + '/view/' + view : page;
		            linkUrl = (URL=='/') ? '/' + url_str + bookmark : URL + '/' + url_str + bookmark;  
		        }

		        if(target) {
					var openLinkPage = window.open('about:blank');
					openLinkPage.location.href=linkUrl;
		        } else {
					var url = new getLocation(linkUrl);		        	
		        	golink(_this,url);
		        	// location.replace(linkUrl);
		        }
		        
		    }
		}

		var moveLinkPage = function(link,interval,isblock) {
			interval = (typeof interval == 'undefined') ? 1200 : interval;
			if(typeof isblock == 'undefined') isblock = '';
		    if($('.dsgn-body').width()<769) {
		        header_fixed = $('.el-menu .navbar-header').height()-1;
		    } else {
		        header_fixed = $('#tpl-menu').height();
		    }

		    var isBookmark = false, bookmark_arr = new Array();
		    link = decodeURIComponent(link);
			if(link.match(/\@/g)) { 
				isBookmark = true;
				bookmark_arr = link.split('\@');


				var check_link = true,
					is_visible_menu = false;

				$.each(b.SMENU, function (idx, obj) {
					if(is_o_page == obj.name.replace(/ /g,'-')) {
						if(!obj.link) check_link = false;
						if(obj.display == 'on') is_visible_menu = false;
					}
					if(obj.children) {
						$.each(obj.children, function (i, v){
							if(is_o_page == v.name.replace(/ /g,'-')) {
								if(!v.link) check_link = false;
								if(v.display == 'on') is_visible_menu = false;
							}
						});
					}
				});

				var is_here = ($('.element[data-bookmark="' + bookmark_arr[1] + '"]').length > 0 ) ? true : false,
					is_page = (b.PAGE.toLowerCase()==bookmark_arr[0].toLowerCase() || b.VIEW && b.VIEW == bookmark_arr[0]) ? true : false,
					is_o_page = (bookmark_arr[0].indexOf(',') > -1 && !b.VIEW) ? bookmark_arr[0].substring(0,bookmark_arr[0].indexOf(',')) : (b.VIEW) ? 'index' : bookmark_arr[0],
					// is_visible_menu = ($.inArray(is_o_page,b.MENULINK)>-1) ? true : false,
					// check_link = ( $('#tpl-menu li a[href*="'+is_o_page+'"]').length > 0 && $('#tpl-menu li a[href*="'+is_o_page+'"]').text().trim().replace(/ /gi,'-') == is_o_page ) ? false : true,
					is_link = (check_link && is_visible_menu && is_o_page != 'INTRO') ? true : false,
					is_visible = (check_link && is_visible_menu && is_o_page != 'INTRO') ? true : false;

				if( ( !is_visible_menu && is_o_page!='index' ) ||
					( /*!is_page &&*/ ( is_link || is_visible ) ) ||
					( is_page && !is_here ) )  { 
					if(is_visible_menu==false) ;
					else return false; 
				}
				link = 'element[data-bookmark="' + bookmark_arr[1] + '"]';     
				
			} else {
			    link = (isblock=='') ? 'link-to-' + link : link;
			}

			if($('header').hasClass('navbar-fheader')) header_fixed = $('header.navbar').outerHeight() - 1;

		    var offset = ($('.dsgn-body').hasClass('sidebar')) ? 0 : -header_fixed;
		    if($('header.navbar').hasClass('disableOffset') && !$('.'+link).hasClass('el_0')) offset = 0;

		    // $('body').scrollTo('.'+link,interval,{offset:offset,easing :'easeInOutQuart'});
		    if($('.'+link).length==0) return;
		    var sTop = $('.'+link).offset().top + offset,
		    	duration = (typeof $('#tpl-menu').attr('data-duration') != 'undefined') ? parseInt($('#tpl-menu').attr('data-duration')) : 1000;
		    $('html, body').animate({
		        scrollTop: sTop
		    },duration, 'easeInOutQuart');

		    var menuStr = (!isBookmark) ? link.replace('link-to-','') : bookmark_arr[0];
		    setTimeout(function() {
		    	$('header #tpl-menu li a[href=#' + menuStr + ']').closest('li').addClass('active').siblings().removeClass('active');
		    	if($('#mobile-nav #tpl-menu li').length) $('#mobile-nav #tpl-menu li a[href=#' + menuStr + ']').closest('li').addClass('active').siblings().removeClass('active');
		    },1100);
		}

		var getParent = function(parent,id,page) {
		    var deferred = $.Deferred();
		    if(id) {
		    	parent = (parent == 'forum') ? parent : 'project';
				$.getJSON('/template/get/parent/' + parent + '/id/' + id + '/sid/' + _this.b.SID + '/page/' + encodeURIComponent(page) + _this.b.param, function(data) {
					_this.b.PARENT = data.PARENT;
					_this.b.COUNT = data.COUNT;
				});
		    } else {
				_this.b.PARENT = {};
				_this.b.COUNT = 0;
		    }
			deferred.resolve();
		    return deferred.promise();
		}

		var showPageCallback = function(func,callback) {
		    func(b.MCSS, b.MSTYLE, b.MTAG, true);
		    if(typeof callback=='function') {
		    	callback();
		    }
		}

		var showPage = function (css, style, tag, prop) {
			if($('.fmcss').length > 0) $('.fmcss').remove();
		    $.each(style.children,function(k,v) {
		        if(k!='.dsgn-body') {
		            delete style.children[k];
		        }
		    });			
    		elFooter();

			if(b.HEADER && b.PARENT.mode == 'shopping') b.HEADER = 0;
		    if(b.HEADER && !isSidebar) {
		        $('header.navbar').addClass('transparent');
		    }

		    menu_color = $('header.navbar').css('background-color');
		    header_fixed = $('header.navbar').height();
		    if(menu_color==('rgba(0, 0, 0, 0)')) {
		        $('header.navbar').css('background-color',$('dsgn-body').css('background-color'));
		    }


		    var is_lock_block = 'active';
		    if(b.ISLOCK == 'true') { 
				isMenuLock(function() {
					if(b.ISLOCK == 'true' && is_lock_block == '' || b.ISLOCK != 'true') elPush(prop);
				});

				// is_lock_block = isMenuLock();
		    } else {
				if(b.ISLOCK == 'true' && is_lock_block == '' || b.ISLOCK != 'true') elPush(prop);		    	
		    }

			// menu active
			/* 190710 -  menu or sub-menu 일부 같을때 첫번째 메뉴에 active error 생겨서 주석 처리. */
			// if(b.PARENT.page) {
			// 	$('#tpl-menu li').find('a:contains("' + b.PARENT.page + '")').parent().addClass('active');
			// } else {
			// 	if(b.ONE) {
			// 		if(b.SMENU[0].display == 'off') $('#tpl-menu li').first().addClass('active');
			// 	} else if(b.PAGE) {
			// 		$('#tpl-menu li').find('a:contains("' + b.PAGE + '")').parent().addClass('active');
			// 	}
			// };

		    RENDER.setLoginout(b.LOGINOUT, b.SID, b.PUBLISH, b.PROFILEIMG);
		    $('body,html').animate({scrollTop: 0}, 300,'easeInOutQuart');
		}

		var loadPush = function(data) {
			// console.log(' page draw:: loadPush');

			var deferred = $.Deferred();
			var pageID = b.PAGE.split(','),
				chgBG = false,
				tmpTag = '',
				currentPAGE = b.PAGE,
				default_t_css = '', default_m_css = '';

			var checkGalleryView = (b.VIEW && b.PAGE.match(/^forum,/g) === null) ? true : false,
				page_pos = 0;

			var googleFonts = {
					'abel' : 'Abel',
					'abril fatface' : 'Abril+Fatface',
					'alegreya' : 'Alegreya:400,400i',
					'black han sans' : 'Black+Han+Sans',
					'cardo' : 'Cardo:400,400i',
					'cookie' : 'Cookie',
					'dancing script' : 'Dancing+Script:400',
					'dosis' : 'Dosis:400',
					'droid sans' : 'Droid+Sans:400',
					'droid serif' : 'Droid+Serif:400,400i',
					'great vibes' : 'Great+Vibes',
					'lato' : 'Lato:400,400i',
					'libre baskerville' : 'Libre+Baskerville:400,400i',
					'lora' : 'Lora:400,400i',
					'montserrat' : 'Montserrat:400,400i',
					'muli' : 'Muli:400,400i',
					'nixie one' : 'Nixie+One',
					'noto sans kr' : 'Noto+Sans+KR:100,300,400',
					'noto sans' : 'Noto+Sans:400,400i',
					'open sans' : 'Open+Sans:100,400',
					'oswald' : 'Oswald:400',
					'playball' : 'Playball',
					'playfair display' : 'Playfair+Display:400,400i',
					'pT sans' : 'PT+Sans:400,400i',
					'pT serif' : 'PT+Serif:400,400i',
					'questrial' : 'Questrial',
					'quicksand' : 'Quicksand:400',
					'raleway' : 'Raleway:400,400i',
					'roboto' : 'Roboto:400,400i',
					'stalemate' : 'Stalemate'
			}

	        $('#el-empty').empty();
	        b.COUNT = data.length;

	        $.each(data, function (idx, val) {
	        	page_pos += 1;

	            var tag = htmlspecialchars_decode(val.eltag,'ENT_QUOTES'),
	            	settings = (typeof val.elsettings != 'undefined' && val.elsettings) ? $.parseJSON(val.elsettings) : {},
	            	gallery_empty = true,
	            	fontload = [];

				if(idx == 0 && b.HEADER && val.overlap == 0) {
					b.HEADER = 0;
					$('header').removeClass('transparent');
					if($('header').hasClass('navbar-fheader')) $.fheader.position();
				}

	            if(val.type == 'project' && val.eltag.charAt(0) == '\<') tag = val.eltag;

	            if(typeof val.fonts != 'undefined') {
		            $.each(val.fonts, function(i,v) {
		            	if(b.ELFONTS.indexOf(i)<0) {
		            		b.ELFONTS.push(i);
		            		if(v) $('#loadfonts').append(v);
		            		else {
		            			if(i in googleFonts)
		            				WebFont.load({ google : { families : [ googleFonts[i.toLowerCase()] ] }});
		            		}
		            	}
		            });
	            }

	            if (val.type == 'gallery' || val.type == 'shopping') {
	                $('#el-empty').append($(tag));
	                $('#el-empty').find('[data-loop="true"]').html('');

	                var nodes = $(tag).find('[data-loop="true"]').children(),
	                    p = $('#el-empty').children(),
	                    i = [],
	                    view = $(tag).find('[data-loop="true"]').data('view'),
	                    total = 0;

                    galleryEL[val.seq] = {
                    	'seq' : val.seq,
                    	'elname' : val.elname,
                    	'eltag' : tag,
                    	'folder' : val.folder,
                    	'mode' : val.mode,
                    	'elsettings' : val.elsettings,
                    	'feature' : val.feature,
                    };

	                if(typeof view == 'undefined') view = 10;
	                var cookie_page = 1,
	                	cookie_view = view,
	                    cookie_gallery_category = '',
	                    is_gc_cookie = (typeof $.cookie('gallery-category-'+val.seq) != 'undefined' && $.cookie('gallery-category-'+val.seq).length > 0) ? true : false;

	            	var category_onoff = (typeof settings.category_display != 'undefined' && settings.category_display) ? settings.category_display : 'OFF';

	                if(typeof $.cookie('loadmore-' + val.seq) != 'undefined' && $.cookie('loadmore-' + val.seq).length > 0) {
	                    cookie_page = $.cookie('loadmore-'+val.seq);
	                    cookie_gallery_category = (typeof $.cookie('gallery-category-'+val.seq) != 'undefined') ? $.cookie('gallery-category-'+val.seq) : '';
	                    cookie_view = cookie_page * view;
	                } else { 
						var checkCateHomeHide = (category_onoff == 'ON' &&
												typeof settings.category != 'undefined' && settings.category && 
												typeof settings.category_home_hide != 'undefined' && settings.category_home_hide) ? true : false;
						if(checkCateHomeHide) {
							var gc = settings.category.replace(/\|/g,'').split(',');
							cookie_gallery_category = gc[0];
							is_gc_cookie = true;

							$.cookie('gallery-catehome-' + val.seq, cookie_gallery_category, { path : '/', expires: 12 * 60 * 60 * 1000 });
						}
	                }
                    $.cookie('gallery-page-' + val.seq, cookie_page, { path : '/', expires: 12 * 60 * 60 * 1000 });
                    $.cookie('gallery-category-' + val.seq, cookie_gallery_category, { path : '/', expires: 12 * 60 * 60 * 1000 });
                    $.removeCookie('loadmore-' + val.seq, { path : '/' });  

					var el_gh = $(tag).find('.goption').attr('data-gh'),
						checkGalleryHeight = (typeof el_gh != 'undefined' && el_gh) ? true : false,
						checkGallerySVG = ($(tag).find('.gimg-svg-wrap').length > 0) ? true : false;

	                $.ajax({
	                    url: '/template/gallery/list/pid/' + val.seq + '/sid/' + b.SID + '/spage/' + currentPAGE + '/view/' + cookie_view + param,
	                    data: { g_mode: val.mode, visible: true, sfl: 'category', stx: unescape(cookie_gallery_category) },
	                    dataType: 'json',
	                    type: 'POST',
	                    async: false,
	                    cache: false,
	                    success: function (data) {
	                        $.each(data.list, function (idx, v) {
	                            i.push(v);
	                        });

	                        total = (typeof data.total.list_total == 'undefined') ?  data.total : data.total.list_total;
				            cookie_view = ( cookie_view > total ) ? total : cookie_view;
	                        // cookie_view = (cookie_view < total) ? cookie_view : total;

	                        if( total>0 ) gallery_empty = false;
	                        if( i.length>0 || (i.length==0 && is_gc_cookie) ) {
	                            var loop_count = nodes.length, item_index = 0;
	                            var elem = [];
	                            $.each(i,function(index,v) {
	                                loop_pos = index%loop_count;
	                                c = nodes[loop_pos];

									v.title = (v.title.length>0) ? v.title : 'Title';
									v.caption = (v.caption.length>0) ? v.caption : 'You can change this text';

									$(c).addClass('gallery-item').attr('data-index',index).attr('data-seq',v.seq);

	                                var vgsettings = (typeof v.gsettings != 'undefined' && v.gsettings) ? $.parseJSON(v.gsettings) : {},
								        img_path = (typeof vgsettings['storage'] != 'undefined') ? vgsettings['storage'] : _this.b.RESOURCE + '/' + _this.b.SID + '/',
								        img_original = (typeof vgsettings['storage'] != 'undefined') ? img_path + '1920/' : img_path;

									var folder = (val.folder == 0) ? '' : val.folder + '/',
										src = getServeImage(v.image,val.folder,img_path),
										src_s0 = getServeImage(v.image,'0',img_path);
									$(c).find('img').attr('src', src);
									if(checkGalleryHeight) $(c).find('.g-img').css('background-image', 'url('+src+')');
									if(checkGallerySVG) {
										var gimgSVG = $(c).find('.gimg-svg-wrap svg');
										gimgSVG.find('pattern').attr('id','gimgSvg_'+val.elname+'_'+index);
										gimgSVG.find('image').attr('xlink:href', src);
										gimgSVG.find('polygon').attr('fill', 'url(#gimgSvg_'+val.elname+'_'+index+')');
									}

									var glink = (typeof vgsettings['glink'] != 'undefined' && vgsettings['glink']) ? vgsettings['glink'] : '',
										glink_target = (typeof vgsettings['glink_target'] != 'undefined' && vgsettings['glink_target']) ? vgsettings['glink_target'] : '';

									if(glink) {
										if(glink.match(/^\@/g) !== null) {													// link-type: link-bookmark ==> a[attr-bookmark]
											var bookmark_seq = glink.replace(/^\@/g,'');
											if(typeof _this.b.SETTINGS.blockBookmarkList == 'undefined' || typeof _this.b.SETTINGS.blockBookmarkList['bookmark' + bookmark_seq] == 'undefined') {
												glink = '';
												glink_target = '';
											}
                                        } else if(_this.b.MENULIST.includes(glink.replace(/^\//g,'').replace(/ /g,'-'))) {	// link-type: link-menu     ==> a[data-user-link]
                                        } else {																			// link-type: link-out      ==> a[attr-link]
											if(checkBase64Encode(glink)) glink = Base64.decode(glink);
										}
									}

									if (typeof v.price_hidden != 'undefined' && v.price_hidden == 'ON' && property['SITEUM'] >= 1) {
										$(c).addClass('gallery-item').addClass('nonePrice');
										$(c).find('a').attr('href', '#');
									} else {
		                                if(glink) {
											var glink_val = makeLinkUrl(glink, b.ONE, b.VIEW);

										    $(c).find('a').removeAttr('data-gallery').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');
										    $(c).find('a').attr('href',glink_val);

										    if(_this.b.MENULIST.includes(glink.replace(/ /g,'-'))) {
										        $(c).find('a').attr('data-user-link',glink_val);
										    } else if(glink.match(/^\@/g)) {
										        $(c).find('a').attr('attr-bookmark',glink.replace(/^\@/g,''));
										    } else {
										        $(c).find('a').attr('attr-link',glink);
										    }
		                                } else {
				                            $(c).find('a').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');

											if (val.mode == 'gallery') {
												$(c).find('a').attr('href', src_s0);
												$(c).find('a').attr('data-gallery', '#gframe-' + val.seq);
											} else {
												$(c).find('a').removeAttr('data-gallery');
												$(c).find('a').attr('href', ((URL=='/') ? '' : URL) + '/' + b.PAGE + '/view/' + v.seq);
											}
			                            }
			                        }

									if(glink_target == '_blank') $(c).find('a').attr('target','_blank');
									else $(c).find('a').removeAttr('target');

									$(c).find('a').attr('data-title', v.title);

	                                // caption
	                                var ftitle = $(c).find('h5.figure'),
	                                    fcaption = $(c).find('p.figure'),
	                                    fdatetime = $(c).find('.figure.datetime'),
	                                    fhashtag = $(c).find('.figure.hashtag'),
	                                    fprice = $(c).find('.figure.price'),
										freview = $(c).find('.figure.review');

	                                // datetime / hashtag
	                                if(fdatetime.length<1) {
	                                    $(c).find('figcaption').append('<div class="figure datetime hide"></div>');
	                                    fdatetime = $(c).find('.figure.datetime');
	                                }
	                                if(fhashtag.length<1) {
	                                    $(c).find('figcaption').append('<div class="figure hashtag hide"></div>');
	                                    fhashtag = $(c).find('.figure.hashtag');
	                                }

	                                $(c).find('figcaption').removeClass('hide');
	                                if (v.title || v.caption) {
	                                    var gallery_caption = v.caption;
	                                    gallery_caption = gallery_caption.replace(/\n/g,'<br />');

	                                    ftitle.html(v.title);
	                                    fcaption.html(gallery_caption);
	                                    fdatetime.text(v.datetime);
	                                    fhashtag.text(v.hashtag);
	                                }

									if(val.mode == 'shopping') {

										var checkPriceHidden = (typeof v.price_hidden != 'undefined' && v.price_hidden == 'ON') ? true : false,
											gallery_price = (v.price && !checkPriceHidden) ? v.price : 0,
											gallery_sale_price = (typeof v.sale != 'undefined' && v.sale > 0 && !checkPriceHidden) ? v.sale : 0,
											gallery_sale_per = (typeof v.sale_per != 'undefined' && v.sale_per && !checkPriceHidden) ? v.sale_per : '',
											product_soldout = (typeof settings.sh_soldout == 'string') ? settings.sh_soldout : '구매불가',
											product_status = ((v.status == 'off' || (v.quantity_on == 'on' && v.quantity < 1)) && product_soldout && !checkPriceHidden) ? '<span class="cl-sh-soldout">' + product_soldout + '</span>' : '';

										$(c).find('.cl-sh-soldout').remove();
										if(product_status != '') $(c).attr('data-soldout',true);
										else $(c).removeAttr('data-soldout');

										if($(c).find('ul.figure.price').length > 0) {
											//Ver2
											if(gallery_price > 0) {
												$(c).find('ul.figure.price .price-val').html('￦' + gallery_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));
												$(c).find('ul.figure.price .price-val').removeClass('hide');

												if(gallery_sale_price > 0) {
													$(c).find('ul.figure.price .price-sale').html('￦' + gallery_sale_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));
													$(c).find('ul.figure.price .price-sale-per').html(gallery_sale_per);
													$(c).find('ul.figure.price .price-sale, ul.figure.price .price-sale-per').removeClass('hide');
												} else {
													$(c).find('ul.figure.price .price-sale, ul.figure.price .price-sale-per').addClass('hide').html('');
												}
											} else {
												$(c).find('ul.figure.price .price-val, ul.figure.price .price-sale, ul.figure.price .price-sale-per').addClass('hide').html('');
											}

											if(product_status) $(c).find('ul.figure.price').append('<li>'+product_status+'</li>');

										} else {
											//Ver1
											if(fprice.length == 0) fprice = fcaption;
											
											if(checkPriceHidden) fprice.html('');
											else fprice.html('<span class="figure-krw">￦</span>' + gallery_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',') + product_status);
										}

										if($(c).find('ul.figure.review').length > 0) {
											var gallery_review = (v.review_onoff && v.review_cnt) ? v.review_cnt : 0;
											if(gallery_review > 0) {
												$(c).find('ul.figure.review, ul.figure.review li').removeClass('hide');
												$(c).find('ul.figure.review .figure-review-cnt').html(gallery_review);
												$(c).find('ul.figure.review .figure-review-score').html(v.review_score);
											} else {
												$(c).find('ul.figure.review, ul.figure.review li').addClass('hide');
												$(c).find('ul.figure.review .figure-review-cnt, ul.figure.review .figure-review-score').html('');
											}
										}

									} else {
										fprice.addClass('hide');
										freview.addClass('hide');
									}
                                    
	                                $(p).find('[data-loop="true"]').append($(c)[0].outerHTML);		                                
	                            });
	                            
	                        } else {
	                            if(val.mode=='project' && b.TEMPLATE == false) {
	                            	nodes.addClass('gallery-item');
	                                nodes.find('a').attr('href', ((URL=='/') ? '' : URL) + '/' + b.PAGE + '/view/template').removeAttr('data-gallery').find('img').attr('data-index',0);
	                            }
	                            $(p).find('[data-loop="true"]').append(nodes);
	                        }

	                        tag = $(p)[0].outerHTML;
	                        $('#el-empty').empty();
	                    }
	                });
	            } else {
	                if(typeof pageID[1] != 'undefined' && idx==0 && pageID[1] != 'template' && b.COUNT==0) {
	                    d = document.createElement('div');
	                    $(d).addClass('temp-element').html(tag);
	                    var pTitle = (b.PARENT.title) ? b.PARENT.title : 'Title',
	                        pCaption = (b.PARENT.caption) ? b.PARENT.caption : 'You can change this text';
	                    pCaption = pCaption.replace(/\n/g, '<br />');

	                    $(d).find('.data-date').text(b.PARENT.datetime);
	                    $(d).find('.data-category').text(b.PARENT.category);
	                    $(d).find('h5.figure').text(pTitle);
	                    $(d).find('p.figure').html(pCaption);

	                    tag = $(d).html();
	                    $(d).remove();
	                    tmpTag = tag;
	                }
	            }

	            //add style
	            var $style_tag = $('<style type="text/css"></style>');
	            $style_tag.attr('id','el_'+idx+'css');
	            $style_tag.html(htmlspecialchars_decode(val.elcss));
	            $('.header').before($style_tag);

	            //change carousel id
	            var $tag = $(tag);
	            $.each($tag.find('[data-edit="true"]'), function(i,v) {
	                var source = $(this).outerHTML();
	                source = source.replace(/&lt;&nbsp;/g,'&lt;').replace(/&nbsp;&gt;/g,'&gt;').replace(/data-attr-bookmark/g,'attr-bookmark');
	                $(this).replaceWith(source);
	            });
	            
	            if(typeof total == 'undefined') total = 0;
                
                // gallery frame add
				if(val.type == 'gallery') {
					if(val.mode == 'gallery' && total) tag = appendGalleryFrame($(tag),val.seq,val.elsettings);

					if(total > view && total > cookie_view) {
						var btn_class = (val.feature=='masonry') ? 'gallery-loadmore masonry-layout' : 'gallery-loadmore',
							btn_txt = (typeof settings.loadmore_lang != 'undefined' && settings.loadmore_lang == 'KO') ? '더보기' : 'LOAD MORE',
							btn_tag = '<div class="' + btn_class + '" data-total="' + total + '" data-id="' + val.seq + '" data-page="' + (Number(cookie_page)+1)+ '" data-view="' + view + '" data-folder="' + val.folder + '" data-mode="' + val.mode + '">' + btn_txt +' &nbsp;(<span class="display">' + cookie_view + '</span> / ' + total + ')</div>';
						
						if($tag.find('.gallery-loadmore').length > 0) $tag.find('.gallery-loadmore').replaceWith(btn_tag);
						else $tag.append(btn_tag);
                	}
                }

	            msny = (val.feature=='masonry') ? true : false;
	            $tag.addClass('el_' + idx)
	                .attr('data-id', val.seq)
	                .attr('data-el','el_' + idx)
	                .attr('data-pos', idx+1)
	                .attr('data-name', val.elname)
	                .attr('data-msny', msny)
	                .attr('data-type', val.type)
	                .attr('data-type2', val.type2)
	                .attr('data-mode', val.mode)
	                .attr('data-width', val.folder)
	                .attr('data-overlap',val.overlap);

				if(checkGalleryView) {
					if(val.page == 'fixedblock_'+b.PARENT.pid) $tag.addClass('el-fixedblock');
					else $tag.removeClass('el-fixedblock');
					$tag.attr('data-pos', page_pos);
					$tag.attr('data-ppos', val.pos);
					$tag.attr('data-posby', val.elnew);
				}

	            if(val.type=='forum' || val.type=='latest') $tag.addClass('preloading');
	            if(val.type2) $tag.attr('data-type2', val.type2);
	          
	            if(b.ONE && val.orgpos==1) {
	                $tag.attr('data-link', val.orgpage);
	            }

				$tag.find('[data-map="true"]').attr('id','map-'+val.seq);
	            $tag.addClass('element');

				var map_url = $tag.find('[data-map="true"]').attr('data-url');
	            if(val.orgpos==1)  $tag.addClass('link-to-'+val.orgpage.replace(/ /g,'-'));
	            $.each($tag.find('[data-edit="true"]'), function(i,v) {
	                $(this).css('z-index','');
	            });

				$last_el = ($('.fnav').length) ? $('.fnav') : $('.el-footer');
	            $last_el.before($tag);

	            if(val.type == 'sns' && typeof val.type2 != 'undefined' && val.type2 == 'feed') {
	                $tag.find('.data-feed-load-more').attr('data-feed-el',val.elname);
	                $tag.find('.data-feed-load-more').removeAttr('style');
	                $tag.find('.show-posts').removeClass('show-posts');

	                if(val.mode == 'site') {
	                	if(!$.isEmptyObject(b.SOCIAL)) {
							var load_sns = {};
							if(!$.isEmptyObject(b.SOCIAL.instagram) && typeof settings.sns_instagram != 'undefined' && settings.sns_instagram == 'ON') load_sns['instagram'] = b.SOCIAL.instagram;
							if(!$.isEmptyObject(b.SOCIAL.twitter) && typeof settings.sns_twitter != 'undefined' && settings.sns_twitter == 'ON') load_sns['twitter'] = b.SOCIAL.twitter;
							
							if(!$.isEmptyObject(load_sns)) {
								loadingElement(val.elname,'loading posts...');
								updateFeed(val.elname,load_sns,function() {
									$('.'+val.elname+' .listprogress').remove();
								});
							}
						}
	                } else {
						// SNS FEED:: before version
						if(typeof settings.sns != 'undefined' &&  settings.sns.twitter) {
							loadingElement(val.elname,'loading posts...');
							updateFeed(val.elname,settings.sns);
						}
	                }
	            }

	            if(val.type == 'others' && typeof val.type2 != 'undefined' && val.type2 == 'countdown') {
	                var el_dday = $tag.find('[data-dday="true"]'),
	                	cd_date = (el_dday.attr('data-countdown')) ? el_dday.attr('data-countdown') : new Date(),
	                    dateformat  = { days : '%D', hours: '%H', minutes: '%M', seconds: '%S' },
                        dateendformat  = { days : '00', hours: '00', minutes: '00', seconds: '00' };
					
					if( typeof settings.countdown != 'undefined' && settings.countdown ) {  //set - block setting date 
                        cd_date = settings.countdown;
	                }
	                if( !el_dday.attr('data-countdown') && typeof countdown == 'object' ) { //set - example date
	                    cd_date.setTime(cd_date.getTime() + (35*24*60*60*1000));
	                }
		            cd_date = moment(cd_date).format('YYYY/MM/DD HH:mm:ss');

					el_dday.countdown(cd_date, function(event) {
						$(this).find('.date-item[data-datetype]').each(function(i) {
							var dd_type = $(this).attr('data-datetype'),
								dd_format = $(this).attr('data-format'),
								dd_endformat = $(this).attr('data-finish');

							if(typeof dd_format == 'undefined' || !dd_format) dd_format = dateformat[dd_type];
							if(typeof dd_endformat == 'undefined' || !dd_endformat) dd_endformat = dateendformat[dd_type];

							if(event.elapsed) $(this).text(dd_endformat);
							else $(this).text(event.strftime(dd_format));
						});
					});
	            }

				if(typeof settings.bookmark != 'undefined' && settings.bookmark) {
					$tag.attr('data-bookmark',val.seq);
				}

	            if(val.type == 'gallery') {
	                $tag.attr('data-category',category_onoff);
	                if(category_onoff == 'ON') {
	                	loadGalleryCategoryBlock($tag,val.seq,category_onoff,settings);

	                	if(gallery_empty) {
							var gallery_empty_str = '<div class="col-xs-12 col-sm-12 col-md grid empty-txt">' + $.lang[LANG]['editor.gallery.category.empty.list'] + '</div>';

	                		if(!is_gc_cookie) $tag.find('.gallery-category-nav').addClass('empty');
	                		else $tag.find('[data-loop="true"]').addClass('empty').append(gallery_empty_str);
	                	}
	                }

	                var img_onoff = (typeof settings.img_original_display != 'undefined' && settings.img_original_display) ? settings.img_original_display : 'OFF',
		                title_onoff = (typeof settings.gframe_title_visible != 'undefined' && settings.gframe_title_visible == 'OFF') ? false : true;
	                $tag.find('[data-gallery]').attr({'data-img-original':img_onoff, 'data-gallery-title':title_onoff});
	                if(!title_onoff) $tag.find('[data-gallery]').attr('data-title','');
	                
					if(typeof val.price_hidden != 'undefined' && val.price_hidden == 'ON') {
						$tag.find('.figure.price').html('');
					}
					
					if($tag.find('.goption[data-gcol]').length > 0) {
						var gOption = $tag.find('.goption[data-gcol]'),
							gcol = gOption.attr('data-gcol'),
							gcol_t = gOption.attr('data-gcol-t'),
							gcol_m = gOption.attr('data-gcol-m');

						if(typeof gcol_t == 'undefined') { gOption.attr('data-gcol-t',gcol); gcol_t = gcol; }
						if(typeof gcol_m == 'undefined') { gOption.attr('data-gcol-m',gcol_t); }
					}
					
					refreshGalleryField($tag,settings);

					// gallery option - gh
					if($tag.find('.goption[data-gh]').length > 0) refreshGalleryHeight(val.elname);
	            }

	            if(val.type == 'forum') {
	            	var view = $tag.find('[data-loop="true"]').attr('data-view');
	                if(typeof view == 'undefined') view = 10;
	                if(typeof $.cookie('forum_' + val.seq) != 'undefined' && $.cookie('forum_' + val.seq)) {
	                	$.forum.init(val.seq,b.PAGE,view,$.cookie('forum_' + val.seq),$.cookie('forum_'+ val.seq +'_sfl'),$.cookie('forum_'+ val.seq +'_stx'),$.cookie('forum_'+ val.seq +'_scate'));
	                } else 
	                	$.forum.init(val.seq,b.PAGE,view);
	                	
	                $.removeCookie('forum', { path : '/' });
	                $.removeCookie('forum_'+val.seq, { path : '/' });
	                $.removeCookie('forum_'+val.seq+'_sfl', { path : '/' });
	                $.removeCookie('forum_'+val.seq+'_stx', { path : '/' });
	                $.removeCookie('forum_'+val.seq+'_scate', { path : '/' });
				}

				var checkVideoTag = (val.type == 'video' || $tag.find('video').length > 0) ? true : false;
				if(checkVideoTag) {
					if (navigator.userAgent.match(/(safari)/gi) !== null) {
						$tag.find('video').each(function() {
							//safari...
							$(this).attr('webkit-playsinline',1);
							$(this).attr('playsinline',1);
						});
					}

					if (navigator.userAgent.match(/(iPod|iPhone|iPad)/gi) !== null) {
						$tag.find('video').each(function() {
							$(this).removeAttr('muted');
							$(this).removeAttr('loop');
							$(this).removeAttr('autoplay');
							$(this).removeAttr('preload');
						});
					}
				}
				
				if(val.type == 'latest') {
					var latest_data = (typeof settings.latest_data != 'undefined' && settings.latest_data) ? settings.latest_data : {};
					$.latest.init(val.seq, latest_data);
					$tag.removeClass('preloading');
				}


				if(b.VIEW) {
					var img_onoff = (typeof settings.img_original_display != 'undefined' && settings.img_original_display) ? settings.img_original_display : 'OFF';
					$tag.find('img[data-attach="true"]').attr('data-img-original',img_onoff);

					var c_g_p = (typeof $.cookie('gallery-page-' + b.PARENT.pid) != 'undefined') ? $.cookie('gallery-page-' + b.PARENT.pid) : 1;
			    	$.cookie('gallery',b.PARENT.pid, { path: '/', expires: 12 * 60 * 60 * 1000 });
			    	$.cookie('loadmore-' + b.PARENT.pid, c_g_p, { path: '/', expires: 12 * 60 * 60 * 1000 });
	            }

				if(typeof map_url != 'undefined' && map_url) {
					var is_templates = checkTemplateSite(b.SID);
					if(b.VALIDPLAN || is_templates) {
						var map_style = $tag.find('[data-map="true"]').attr('data-style');
						loadmap(map_url,'map-'+val.seq, map_style);
					} else {
						$tag.find('.google-map').addClass('disabled-map');
					}
	            }

	            // log 
	            if(typeof settings['google_track'] != 'undefined') {
            		$('.dsgn-body').append("<script type='text/javascript' src='//www.googleadservices.com/pagead/conversion_async.js'></script>");
	            }

		        $('.dsgn-body').fitVids();
		        $('.carousel').carousel({
		        	pause: 'none'
		        });

	            //add script
	            if(val.eljs){
	                var js_string = val.eljs;
	                var $script_tag = $('<script type="text/javascript" id="js_' + idx + '"></script>');
	                $script_tag.html(js_string);
	                $('.dsgn-body').append($script_tag);
	            }

	            //add style
	            var jcss = CSSJSON.toJSON(val.elcss),
	            	elpd = style.getPadding(jcss,val.elname);

            	var elFonts = $tag.css('font-family');
        		elFonts = elFonts + ',"Nanum Gothic"';
        		elFonts = elFonts.replace(/"/g, '\'');
        		$tag.css('font-family',elFonts);

	            var pt = parseInt(elpd.top),
	                pb = parseInt(elpd.bottom);
	                
	            if(pt>0||pb>0){
	                default_t_css = default_t_css + '\n 	.'+val.elname + '{';
	                if(Math.ceil(pt*0.8)>0)
	                default_t_css = default_t_css + 'padding-top: '+Math.ceil(pt*0.8) + 'px!important;';
	                if(Math.ceil(pb*0.8)>0)
	                default_t_css = default_t_css + 'padding-bottom: '+Math.ceil(pb*0.8) + 'px!important;';
	                default_t_css = default_t_css + '}';

	                default_m_css = default_m_css + '\n 	.'+val.elname + '{';
	                if(Math.ceil(pt*0.5)>0)
	                default_m_css = default_m_css + 'padding-top: '+Math.ceil(pt*0.5) + 'px!important;';
	                if(Math.ceil(pb*0.5)>0)
	                default_m_css = default_m_css + 'padding-bottom: '+Math.ceil(pb*0.5) + 'px!important;';
	                default_m_css = default_m_css + '}';
	            }
	            if(idx == data.length-1){
	                var css = '@media only screen and (max-width:767px) {' + default_t_css + '\n}\n';
	               	css = css + '@media only screen and (max-width:480px) {' + default_m_css + '\n}';

                    if($('#el-paddingcss').length == 0) $('.dsgn-body').find('#el_'+(data.length-1)+'css').after('<style id="el-paddingcss">'+css+'</style>');
                    else $('#el-paddingcss').append(css);
	            }

	        });

	        if(b.VIEW) {
		        // prev next
		        $('.data-page-prev').addClass('active');
				$('.data-page-next').addClass('active');

		        if(b.PARENT.prev === null) $('.data-page-prev').removeClass('active');
				if(b.PARENT.next === null) $('.data-page-next').removeClass('active');
	        }



            var isPage = false;
            $.each(b.MENULIST, function(i,k) {
                isPage = (k.toUpperCase() == b.PAGE.toUpperCase()) ? true : isPage;
            });

            if(!b.ONE && !b.VIEW && !isPage) location.replace(URL);
            
			// menu ver3 : fheader
			if($('header.navbar').hasClass('navbar-fheader')) $.fheader.position();

	        $('.el-footer').show();
	        parallax();
			deferred.resolve();
		    return deferred.promise();
		}

		var elPush = function (prop) {
		    /* prop - reorder list hide */
		    var pageID = b.PAGE.split(','),
		        chgBG = false,
		        tmpTag = '',
		        currentPAGE = '',
		        default_t_css = '', default_m_css = '';

			// currentPAGE = (property.COUNT==0 && pageID[1] && pageID[0]!='forum') ? 'index,template' : b.PAGE;
			currentPAGE = b.PAGE;
			param = (currentPAGE=='index,template' && param.indexOf('/org/') == -1) ? param + '/org/' + b.PAGE : param;

			/*
			var page_reset = false;
			$.each(b.SMENU, function(i,o) {
				if(currentPAGE.indexOf(',') > -1) return false;
				if(i == 0 && o.name == 'INTRO') o.link = '';
				
				if(page_reset) {
					if( o.display == 'on' && o.link == '') {
						currentPAGE = o.name.replace(/ /g, '-');
						return false;
					} else {
						$.each(o.children, function(o_c_i, o_c_o) {
							if(o_c_o.display == 'on' && o_c_o.link == '') {
								currentPAGE = o_c_o.name.replace(/ /g, '-');					
								return false;
							}
						});
					}
				} else {
					if(currentPAGE == o.name.replace(/ /g,'-')) {
						if( o.display == 'off') {
							page_reset = true;
						} else if( o.link != '') {
							if(o.link == 'folder-menu') {
								$.each(o.children, function(o_c_i, o_c_o) {
									if(o_c_o.display == 'on' && o_c_o.link == '') {
										currentPAGE = o_c_o.name.replace(/ /g, '-');
										return false;
									}
								});
							} else {
								page_reset = true;
							}
						} else {
							return false;
						}
					} else {
						$.each(o.children, function(o_c_i, o_c_o) {
							if(currentPAGE == o_c_o.name.replace(/ /g,'-')) {
								if(o.display == 'on' && o_c_o.link == '') return false;
							}
						})
						page_reset = true;
					}
				}
			});
			*/
			
	        if(pageID[0] == 'forum' && b.VIEW && property.COUNT==0) {
		    	clearDsgnbody();
		    	var ps_fmview = $.forum.view(b.VIEW);
		    	ps_fmview.then(function() {
		    		_this.displayComment(b.VIEW);
		    		$('.el-footer').show();
		    	});
			    return false;
	        }

	        // console.log(b.pageContent.hasOwnProperty(currentPAGE));
	        // console.log(b.pageContent);
	        if(b.pageContent.hasOwnProperty(currentPAGE)) {
	        	var loadingContents = loadPush(b.pageContent[currentPAGE]);
	        } else {
				$.ajax({
	                url: '/template/contents/sid/' + b.SID + '/page/' + encodeURIComponent(currentPAGE) + param,
			        dataType: 'json',
	                type: 'GET',
	                async: false,
	                success: function(data) {
				    	if(typeof data.error != 'undefined' || data.error) {
				    		if(currentPAGE!='index,template') {
					    		alert($.lang[LANG]['page.not.found']);
					    		location.replace('/');
				    		}
				    	}

				    	if(currentPAGE!='index,template') b.pageContent[currentPAGE] = data;
				    	var loadingContents = loadPush(data);
	                }
				});
	        }
		}

		var scrollspy = function() {
		    if(!b.ONE) return false;
		    var top = 0,
		        active = '';

		    top = ($('.dsgn-body').hasClass('sidebar')) ? 0 : $('.header.el-menu').height();

		    $.each(b.MENULINK,function(i,v) {

		        var $el = ($.inArray(v,property.MENULIST) > -1) ? $('.link-to-'+v) : '';
		        if($el.length>0) {
		            var offset = $el.offset();
		            if((Math.floor(offset.top) - $(document).scrollTop())<=top) active = v;
		        }

		    });

			if(!$('#tpl-menu li a[href="#'+active+'"]').parent().hasClass('active')) {
				$('#tpl-menu li').removeClass('active').removeClass('open');

				$('#tpl-menu li a[href="#'+active+'"]').parent().addClass('active');
				if( $('#tpl-menu li a[href="#'+active+'"]').closest('.dropdown-menu').length>0 ) {
					if($('body').width() > 768) $('#tpl-menu li a[href="#'+active+'"]').closest('.dropdown').addClass('active');
					else $('#tpl-menu li a[href="#'+active+'"]').closest('.dropdown').addClass('open');
				}
			}

		    if($(document).scrollTop() + $('body').height() == $('body').prop('scrollHeight')) {
		        var last = b.MENULINK[b.MENULINK.length-1],
		            $el = ($.inArray(last,property.MENULIST) > -1) ? $('.link-to-'+last) : '';

		        if($el.length>0) {
		            if($el.offset().top>top) {
		                $('#tpl-menu li').removeClass('active').removeClass('open');

		                $('#tpl-menu li a[href="#'+last+'"]').parent().addClass('active');
						if($('#tpl-menu li a[href="#'+last+'"]').closest('.dropdown-menu').length>0) {
							if($('body').width() > 768) $('#tpl-menu li a[href="#'+last+'"]').closest('.dropdown').addClass('active');
							else $('#tpl-menu li a[href="#'+last+'"]').closest('.dropdown').addClass('open');
						}
		            }
		        }
		    }

		}

		var fixedMenu = function() {
			if($('header.navbar').hasClass('navbar-fheader')) { // menu ver3 : fheader 

				if($(document).scrollTop() > $('header.navbar').height()) {
					if(window.innerWidth > 768) {
						$('.menu-logo-top').hide();
						// $('.menu-logo-top').slideUp('fast');
						$('.el-menu').addClass('fixed-fheader');
					}					
					if(b.HEADER) $('header.navbar').removeClass('transparent');
				} else if($(document).scrollTop() < $('header.navbar').height()) {
					$('.el-menu').removeClass('fixed-fheader');
					$('.menu-logo-top').show();
					// $('.menu-logo-top').slideDown('fast');
					if(b.HEADER) {
						$('header.navbar').addClass('transparent');
						$('.dsgn-body').removeAttr('style');
					}
				}

				return false;
			}

		    header_fixed = $('.header.el-menu').height();
		    var user_menu = $('.el-menu'),
				menu_color = $('header.navbar').css('background-color'),
				menu_bg_img = (typeof $('header.navbar').css('background-image') != 'undefined') ? $('header.navbar').css('background-image') : 'none',
				menu_bg_position = (typeof $('header.navbar').css('background-position') != 'undefined') ? $('header.navbar').css('background-position') : 'center center',
				menu_bg_repeat = (typeof $('header.navbar').css('background-repeat') != 'undefined') ? $('header.navbar').css('background-repeat') : 'no-repeat',
				menu_bg_size = (typeof $('header.navbar').css('background-size') != 'undefined') ? $('header.navbar').css('background-size') : 'cover';

		    if($(document).scrollTop() > header_fixed && user_menu.hasClass('fixed')==false && !$('.dsgn-body').hasClass('sidebar')) {
		        user_menu.fadeOut('fast', function() {
		            $(this).addClass('fixed').fadeIn('fast');
		            $('.fixed').addClass('fixed-position');
		            if(!b.HEADER || $('header.navbar').hasClass('sidebar') ) {
	                	var topval = ($('.creatorlink-header').length==1) ? '55px' : '0';
		            	$('.el_0').css('margin-top',topval);
		                var $header_empty = $('<div class="header-empty"></div>');
		                if($(".header-empty").length==0) {
		                	var topval = ($('.creatorlink-header').length==1) ? '55px' : '0';
			                $header_empty.css({
			                    'background-color' : $('header.navbar').css('background-color'),
								'background-image' : menu_bg_img,
								'background-position' : menu_bg_position,
								'background-repeat' : menu_bg_repeat,
								'background-size' : menu_bg_size,
			                    //'position' : 'relative',
			                    'width' : '100%',
			                    'height' : header_fixed+'px',
			                    'top' : topval,
			                    'z-index' : '1'
			                });
			                $('.dsgn-body').prepend($header_empty);
			            }
       		        	$(".header-empty").css('position','relative');
		            } else {
		            	$('header.navbar').removeClass('transparent');
		            }
		            if(window.innerWidth > 768) $('.menu-logo-top').hide();
		        });        
		    } else if($(document).scrollTop() < header_fixed && user_menu.hasClass('fixed') && !$('.dsgn-body').hasClass('sidebar')){
		        user_menu.fadeOut('fast', function(){
			        $('.header-empty').css('position','absolute');
		            $('.fixed').addClass('fixed-position');
		            user_menu.removeClass('fixed').fadeIn('fast');
		            if(!b.HEADER  || $('header.navbar').hasClass('sidebar') ) {
		            	$('.el_0').css('top','0');
		            } else {
		            	$('header.navbar').addClass('transparent');
		            	if($('.creatorlink-header').length == 1) $('div.header.fixed-position').addClass('top-zero');
		            }
		            $('.menu-logo-top').show();
		        });
		    }
		}


		var elFooter = function() {

			if($('.el-footer').length) return false;
			if(b.FTAG == '') b.FTAG = '<div class="footer-' + b.SID + '"></div>';
		    $footer = $(b.FTAG);
		    $footer.find('.link-site-home').prop('href',URL);
		    $footer.addClass('element')
		           .addClass('el-footer')
		           .attr('data-type','footer')
		           .attr('data-el','el-footer')
		           .attr('data-id','footer')
		           .attr('data-name','footer-' + b.SID);

		    $footer.appendTo($('.dsgn-body'));
		    $('.dsgn-body').prepend("<style id='el-footercss'>" + b.FCSS + "</style>");


			/*180822 add*/
			// before v1 creatorlink-box remove
			if($('.el-footer').find('.creatorlink-box').length > 0 ) {
				if($('.el-footer').find('.creatorlink-box').prev().hasClass('col-md-10')) $('.el-footer').find('.creatorlink-box').prev().removeClass('col-md-10').addClass('col-md-12');
				$('.el-footer').find('.creatorlink-box').remove();
			}
			// before v2 creatorlink-footer remove
			if( $('.el-footer').find('.creatorlink-footer').length > 0) {
				$('.el-footer').find('.creatorlink-footer').remove();
			}

			// made it with Creatorlink
			if(!b.VALIDPLAN || b.VALIDTYPE == 'PK' || b.VALIDTYPE == 'FR') {
				var is_templates = checkTemplateSite(b.SID);
				if(!is_templates) {
					$('.goto-top').addClass('moved');
					setMadeWithCreatorlink();
				}	
			}

		 	var isfooterAttach = typeof $footer.attr('data-flogo') == 'undefined' ? false : $footer.attr('data-flogo');
	    	if(isfooterAttach) {
				if(b.ONE){
					if(b.VIEW) $footer.find('#site-home-footer').attr('href',URL).removeClass('mini-home');
					else $footer.find('#site-home-footer').attr('href','javascript:;').addClass('mini-home');
				} else $footer.find('#site-home-footer').attr('href',URL).removeClass('mini-home');
			}

			/*180822  delete - powered by Creatorlink
			// before creatorlink-box remove
			if($('.el-footer').find('.creatorlink-box').length > 0 ) { 
				if($('.el-footer').find('.creatorlink-box').prev().hasClass('col-md-10')) $('.el-footer').find('.creatorlink-box').prev().removeClass('col-md-10').addClass('col-md-12');
				$('.el-footer').find('.creatorlink-box').remove();
			}

			if($('.el-footer').find('*[data-edit="true"]').first().closest('.row').children('div').length == 1 &&
				$('.el-footer').find('*[data-edit="true"]').first().closest('.row').children('div').hasClass('col-md-10') ) {
				$('.el-footer').find('*[data-edit="true"]').first().closest('.row').children('div').removeClass('col-md-10').addClass('col-md-12');
			}

			if(typeof b.VALIDPLAN != 'undefined' && b.VALIDPLAN && b.VALIDTYPE != 'PK') {
				if( $('.el-footer').find('.creatorlink-footer').length > 0 ) $('.el-footer').find('.creatorlink-footer').remove();
			} else {
				var el_f_style = $('.el-footer').attr('style');
				if(typeof el_f_style != 'undefined' && 
					(el_f_style.indexOf('display') > -1 || el_f_style.indexOf('opacity') > -1 || el_f_style.indexOf('z-index') > -1) ) $('.el-footer').removeAttr('style');
				if($('.el-footer').css('display') == 'none') $('.el-footer').css('display','block');
				if($('.el-footer').css('opacity') < 1) $('.el-footer').css('opacity',1);
				if($('.el-footer').css('z-index') != 'auto') $('.el-footer').css('opacity','auto');

				if( $('.el-footer').find('.creatorlink-footer').length == 0) setFooterCretorlinkBox();
				setFooterLink();
			}
			*/

		    if(!b.FTAG || b.FOOTER) {
		        $footer.hide();
		    } else {
		    	if(b.VIEW && b.PARENT.mode == 'shopping' && $(document).width() < 768) {
		    		$('.el-footer').css('margin-bottom','55px');
		    	}
		    }
		}

		var reloadMasonry = function(container,items) {
			$('.gallery-loading-status').remove();

			if(container.find('[data-loop="true"]').length > 0) container.find('[data-loop="true"]').append(items).closest('.container').masonry();
			else container.masonry().append(items);
		    container.masonry('appended',items).masonry();
		}		

		function setDefaultValue(value) {
			return (typeof value == 'undefined') ? '' : value;
		}

		function setDefaultValueEtc(type, el) {
			type = (typeof el.attr('data-contact-etc-type') != 'undefined' && el.attr('data-contact-etc-type') ) ? el.attr('data-contact-etc-type') : type;
            
            var input_type = ['text','email','number','tel','url'];
            if($.inArray(type,input_type)) {
				return (typeof el.val() == 'undefined') ? '' : el.val();
			} else if(type == 'checkbox') {
				return ( el.prop('checked') ) ? 'O' : 'X';
			} else if(type == "radio") {
				return el.find('input:radio:checked').val();
			} else if(type == 'selectbox') {
				var result = (el.find('option').length > 0 ) ? el.find('option:checked').val() : el.find('.active').find('.opval').text();
				return result;
			} else {
				return 'etc article';
			}
		}

		function setDefaultForm(el) {
			$(el + ' [form-idx]').val('');
			$(el + ' [form-idx]').find('.form-date').val('');
			$(el).find('input:checkbox').removeAttr('checked');
			$(el).find('input:radio').removeAttr('checked');
		}

		function setDefaultContactForm(el) {
			$(el + ' [data-contact-firstname]').val('');
			$(el + ' [data-contact-lastname]').val('');
			$(el + ' [data-contact-email]').val('');
			$(el + ' [data-contact-website]').val('');
			$(el + ' [data-contact-phone]').val('');
			$(el + ' [data-contact-subject]').val('');
			$(el + ' [data-contact-message]').val('');
			$(el).find('input:checkbox').removeAttr('checked');
			$(el).find('input:radio').removeAttr('checked');
		}

		function setDefaultContactFormEtc(el) {
			$(el).find('[data-contact-etc]').each(function(i) {
				var type = (typeof $(this).attr('data-contact-etc-type') != 'undefined' && $(this).attr('data-contact-etc-type') ) ? $(this).attr('data-contact-etc-type') : $(this).attr('type');
				
				var input_type = ['text','email','number','tel','url'];
				if($.inArray(type,input_type)) {
					$(this).val('');
				} else if(type == "checkbox") {
					$(this).removeAttr('checked');
				} else if(type == "radio") {
					$(this).find('input:radio').first().click();
				} else if(type == "selectbox") {
					if($(this).find('option').length > 0) {
						$(this).find('option:first').attr('selected','selected');
					} else {
						$(this).find('.active').removeClass('active');
						$(this).find('li').first().addClass('active');
					}
				}
			});
		}

		var ieLineClamp = function() {
		    if(isIE()) {
		        $('[data-ie-clamp]').each(function(index, element) {
		            var clamp = $(this).attr('data-ie-clamp').split(','),
		                line = new Array();

		            $.each(clamp,function(k,v) {
		                line.push(v);
		            });

		            for(i=line.length; i<3; i++) line[i] = 0;
		            var idx = getScreenIndex();
		            var apply = line[idx];

		            // console.log($(element).text());
		            //safeClamp(element, apply);
		            $clamp(element, {clamp:apply, useNativeClamp:false });
		        });
		    }
		}

		var safeClamp = function (selector, lines) {
			lines = lines || 3; // a default
			$(selector).each( function() {
				if($(this).text()) {
					$clamp( this, { clamp: lines, useNativeClamp:false  });
				}
			});
		}

		$('.data-page-back').live({
		    click : function() {
				var pPage = b.PARENT.page,
					inMenu = ($.inArray(pPage,b.MENULIST) == -1) ? false : true;

				if(!inMenu) {
					$(this).showModalFlat('INFORMATION','이동할 수 없습니다',true,false,'','ok');
					return false;
				} else {
					var c_g_p = (typeof $.cookie('gallery-page-' + b.PARENT.pid) != 'undefined') ? $.cookie('gallery-page-' + b.PARENT.pid) : 1;
			    	$.cookie('gallery',b.PARENT.pid, { path: '/', expires: 12 * 60 * 60 * 1000 });
			    	$.cookie('loadmore-' + b.PARENT.pid, c_g_p, { path: '/', expires: 12 * 60 * 60 * 1000 });
			    	
			    	var url_replace = (b.URL == '/') ? '' : b.URL;
			    	if(b.ONE) {
			    		_this.history.pushState(null,b.TITLE,url_replace + '/index#' + b.PARENT.page);
			    	} else {
			    		var page = b.PAGE.split(',');
			    		if(page[1]=='template') {
				    		_this.history.pushState(null,b.TITLE,url_replace + '/' + page[0]);
			    		} else {
				    		_this.history.pushState(null,b.TITLE,url_replace + '/' + b.PARENT.page);
			    		}		    		
			    	}
			    }
		    }
		});

	    $('#config-mode-view').click(function() {
	    	location.href = '//' + b.HOST + b.REFERER;
	    });

		$('body').on('click','.mini-home, #goto-top', function(event) { 
			event.preventDefault();	
			$('body,html').animate({scrollTop: 0}, 900,'easeInOutQuart'); 
		});	

		$('.data-page-prev').live({
		    click : function(e) {
		    	if(!$(this).hasClass('active') || b.PARENT.prev === null) return false;
		    	if(typeof b.PARENT.page == 'string' && $.inArray(b.PARENT.page,b.MENULIST) == -1) return false;
		        var page = b.PAGE.split(',');
		    	var url_replace = (b.URL == '/') ? '' : b.URL;
		    	if(b.PARENT.prev)
		    		_this.history.pushState(null,b.TITLE,url_replace + '/' + page[0] + '/view/' + b.PARENT.prev);
		    }
		});

		$('.data-page-next').live({
		    click : function() {
		    	if(!$(this).hasClass('active') || b.PARENT.next === null) return false;
		    	if(typeof b.PARENT.page == 'string' && $.inArray(b.PARENT.page,b.MENULIST) == -1) return false;
		        var page = b.PAGE.split(',');
		    	var url_replace = (b.URL == '/') ? '' : b.URL;
		    	if(b.PARENT.next)
		    		_this.history.pushState(null,b.TITLE,url_replace + '/' + page[0] + '/view/' + b.PARENT.next);
		    }
		});



		//menu click
		$('#tpl-menu.nav > li:not(.siteUM,.siteLANG) a:not([href="javascript:;"]), .el-menu header.navbar a#site-home').live({
		    click : function(e) {
		    	e.preventDefault();
				if(e.target.className.indexOf('fa') > -1 && $(this).closest('header').hasClass('navbar-simple')) { 
					return false; 
				}
				if(typeof $(this).attr('data-toggle') != 'undefined') { return false; }

				$.each($.cookie(), function(i,v) {
					if(i.indexOf('gallery-category-') > -1) {
						var gallery_seq = i.replace('gallery-category-','');
							gcate_home = (typeof $.cookie('gallery-catehome-'+gallery_seq) == 'undefined') ? '' : $.cookie('gallery-catehome-'+gallery_seq);
						$.cookie(i, gcate_home, { path : '/', expires: 12 * 60 * 60 * 1000 });
					}
					if(i.indexOf('gallery-page-') > -1) $.cookie(i, 1, { path : '/', expires: 12 * 60 * 60 * 1000 });
					if(i.indexOf('loadmore-') > -1) $.cookie(i, 1, { path : '/', expires: 0 });
				});

				$.removeCookie('gallery', { path: '/' });
				$.removeCookie('gallery-item', { path : '/' });
				$.removeCookie('forum', { path : '/' });
				$.removeCookie('forum-item', { path : '/' });

				var isClickSiteHome = (typeof $(this).attr('id') != 'undefined' && $(this).attr('id') == 'site-home') ? true : false;

				if($('body').width() < 769)  {
					var menuVer03 = ($('.el-menu > header').hasClass('navbar-fheader')) ? true : false,
						menuVer02 = (!menuVer03 && $('.el-menu > header').hasClass('navbar-simple')) ? true : false,
						menuVer01 = (!menuVer03 && !menuVer02) ? true : false;

					var clickNavbarToggle = ( (menuVer03 && $('.navbar-toggle').css('visibility') == 'hidden') && !isClickSiteHome ||
											  (menuVer02 && !isClickSiteHome) ||
											  menuVer01
											) ? true : false;
					if(clickNavbarToggle) $('.navbar-toggle').click();
				}

				if(!isClickSiteHome) {
					if($(this).hasClass('loginout')) {
						if(b.URL == '/render') {
							$(this).showModalFlat('INFORMATION','미리보기에서는 제공되지 않습니다.',true,false,'','ok');
							return false;
						}
						$('#loginModal').modal('show');
						$('#loginModal').css('z-index',1042);
						$('.modal-backdrop.fade.in').css('z-index', 1041);
					} else {
						$('#tpl-menu li').removeClass('active').removeClass('open');
						
						$(this).parent().addClass('active');
						if($(this).closest('.dropdown-menu').length>0) {
							if($('body').width() > 768) $(this).closest('.dropdown').addClass('active');
							else $(this).closest('.dropdown').addClass('open');
						} else {
							if(menuVer03) $('#mobile-nav li.menu-has-children ul.dropdown-menu').hide();
							else {
								if($('body').width() < 768) $('#tpl-menu li.dropdown ul.dropdown-menu').hide();
							}
						}
					}
				}


				var loc = $(this).attr('href'),
					uri = (b.PUBLISH) ? loc : loc.replace('/render/',''),
					blank = $(this).attr('target'),
					bookmark = $(this).attr('attr-bookmark');

				if(typeof bookmark !='undefined' && bookmark) return false;
				if(typeof blank != 'undefined' && (blank == '_blank' || blank == 'blank')) {
					window.open(loc);
					e.stopPropagation();
					return false;
				}

				if(loc.match("^(mailto:|tel:|sms:)")) {
					window.location.href = loc;
					return false;
				}

				if(b.ONE!='1') {

					if(loc == 'javascript:;') return false;

					if(uri == "/render" || uri == '/') {
						uri = b.MENULINK[0];
						$('body,html').animate({scrollTop: 0}, 900,'easeInOutQuart'); 
					}

			    	if(loc.match(/\@/g) === null && loc.match(/\//g) === null) {
			    		window.location.href = loc;
			    		return false;
			    	}
			    	var url = new getLocation(loc);
				    golink(_this,url);
		    		// _this.history.pushState(null,b.TITLE,(b.PUBLISH) ? "/" + uri : "/render/" + uri);
		    	} else {
			    	if(loc == 'javascript:;') {
			    		loc = '#';
			    	}

			    	var hash = '';
					if(_this.b.PUBLISH) {
						if(loc.indexOf('/index/view/') > -1 && b.ONE) ;
						else loc = loc.replace('/index','');
					} else {
						if(loc.indexOf('/index/view/') > -1 && b.ONE) ;
						else loc = loc.replace('/render/index','');
					}
					hash = loc;

			    	var fstr = loc.charAt(0),
			    		pathname = window.location.pathname;
			    	switch(fstr) {
			    		case '#':
			    			if(_this.b.PAGE == 'index') {
			    				if(pathname.charAt(1) == '_') {
				    				loc = (_this.b.PUBLISH) ? '/'+loc : '/render/'+loc;	
				    				window.location.href = loc;
			    				} else {
						    		if($(this).hasClass('mini-home')) {
						    			$('body,html').animate({scrollTop: 0}, 900,'easeInOutQuart'); 
						    			history.pushState('', '', hash);
						    			return false;
						    		}
				    				var urlType = (b.PUBLISH) ? '/index' : '/render';
									_this.history.pushState(null,b.TITLE,urlType + hash);
			    				}
			    			} else {
				    			loc = (_this.b.PUBLISH) ? '/index' : '/render/index';
								_this.history.pushState(null,b.TITLE,loc);
								history.pushState('', '', loc + hash);
			    			}
			    			break;
			    		case '@':

			    			break;
			    		case '/':
			    			if(loc == '/render' || loc == '/') {
			    				loc = (_this.b.PUBLISH) ? '/index' : '/render/index';	
				    			$('body,html').animate({scrollTop: 0}, 900,'easeInOutQuart'); 
			    			}
			    			
					    	var url = new getLocation(loc);
					    	golink(_this,url);
			    			break;
			    		default:
					    	// var url = new getLocation(loc);
					    	// golink(_this,url);
					    	window.location.href = loc;
			    			break;
			    	}
	
			    	// window.location.href = loc;
		    	}
		    }
		});

		// menu click (onepage)
		$('.nav li a[href*=#]:not([href="javascript"])').live({
		    click : function(e) {
				if(e.target.className.indexOf('fa') > -1 && $(this).closest('header').hasClass('navbar-simple')) {
					e.preventDefault();
					return false;
				}

		        var link = $(this).attr('href').replace('#','');
		        if(link.substring(0,1) == '/') link = link.substring(1,link.length);
		        if(b.MENULINK.indexOf(link) > -1) {
		            if($('.dsgn-body').width()<769) {
		                setTimeout(function() {
		                    moveLinkPage(link);
		                },250);
		            } else moveLinkPage(link);
		        }
		    }
		});


		$('[data-type="gallery"] [data-loop="true"] > .grid').live({
			touchstart: function() {
				galleryStartHover();
			},
			touchend: function() {
				galleryCloseHover();
			},
			click: function() {
				galleryMovelink();
			}
		});

		$('.gallery-item a').live({
			click : function(e) {
		    	e.preventDefault();
				var loc = $(this).attr('href'),
					mode = $(this).attr('data-gallery'),
					menu_link = $(this).attr('data-user-link'),
					bookmark = $(this).attr('attr-bookmark'),
					blank = $(this).attr('target'),
					user_link = $(this).attr('attr-link');


				if( (typeof mode!='undefined' && mode.length>0) ||
					(typeof menu_link!='undefined' && menu_link.length>0) ||
					// (typeof user_link!='undefined' && user_link.length>0) ||
					(typeof bookmark!='undefined' && bookmark.length>0) 
				) return;

				if(typeof blank!='undefined' && blank.length) {
					var url = (typeof user_link != 'undefined' && user_link.match("^(tel:|mailto:|sms:)") === null) ? makeLinkUrl(user_link, b.ONE, b.VIEW) : loc;
					var openNewWindow = window.open(url);
				} else {
					if(typeof user_link != 'undefined' && user_link.match("^(tel:|mailto:|sms:)") !== null) {
						location.href=loc;
					} else {
						var url = new getLocation(loc);
						golink(_this,url);
					}
		    	}

		    	// 	uri = (b.PUBLISH) ? loc : loc.replace('/render/',''),
		    	// 	attr = $(this).attr('attr-link');

		    	// if(typeof attr!='undefined' && attr) return;
	    		// _this.history.pushState(null,b.TITLE,(b.PUBLISH) ? "/" : "/render/" + uri);
			}
		});


		$('.navbar-simple .nav li a .fa').live('click', function(e) {
			if($(this).closest('header').hasClass('navbar-simple')) {
				$(this).closest('a').next('ul.dropdown-menu').slideToggle(200).closest('li').toggleClass('open').siblings().removeClass('open').find('ul.dropdown-menu').slideUp(200);
				e.preventDefault();
				return false;
			} 
		});

		$('.navbar-simple .nav li a.dropdown-toggle[href="javascript:;"]').live('click', function(e) {
			e.preventDefault();
			if($('body').width() < 768) $(this).find('.fa').click();
			return false;
		});


		$('body').on('click', '.micon', function(e) { $('#goto-top').hide(); });

		$('body').on('touchstart.dropdown.data-api, click','header .siteUM-dmenu-wrap, header .siteLANG-dmenu-wrap', function(e) {
			if(e.target.className.indexOf('siteUM-dmenu-wrap') > -1 || e.target.className.indexOf('siteLANG-dmenu-wrap') > -1) {
				if($(this).hasClass('open')) {
					$(this).removeClass('open');
					$('#goto-top').show();
				}
			} 
		});
		$('body').on('touchstart.dropdown.data-api, click', 'header.navbar-simple .navbar-collapse.in', function(e) {
			if(e.target.className.indexOf('navbar-collapse') > -1) {
				$('.navbar-toggle').click();
			}
		});

		$("a[href*=#][attr-link]").live({
		    click : function(e) {
				if(e.target.className.indexOf('fa') > -1 && $(this).closest('header').hasClass('navbar-simple')) {
					e.preventDefault();
					return false;
				}

		        if($(this).attr('target') != '_blank') {
			        var link = $(this).attr('href').replace('#','');
			        if(link.length > 0 && link != '/') {
				        if(b.MENULINK.indexOf(link) > -1) {
				            if($('.dsgn-body').width()<769) {
				                setTimeout(function() {
				                    moveLinkPage(link);
				                },250);
				            } else moveLinkPage(link);
				        } else if($('.' + link).length) {
				        	moveLinkPage(link,1200,true);
				        }
			        }
		    	}
		    }
		});

		$('.gallery-category-nav li a').live({
		    click: function() {
		    	if($(this).closest('.gallery-category-nav').hasClass('empty')) {
		    		$(this).blur();
		    		return false;
		    	}

		        if($(this).closest('li').hasClass('active')) return;

		        var d = new Date(),
		            now = d.getTime(),
		            idx = $(this).attr('data-idx'),
		            sfl = 'category',
		            stx = (idx != '0') ? $(this).text().trim() : '',
		            pid = $(this).closest('.element[data-type="gallery"]').attr('data-id');

		        $('.element[data-id="'+pid+'"] .gallery-category-nav li').removeClass('active');
		        $('.element[data-id="'+pid+'"] .gallery-category-nav li').eq(idx).addClass('active');

		        $('#el-empty').empty();
		        
	            var val = _this.galleryEL[pid],
	                tag = htmlspecialchars_decode(val.eltag,'ENT_QUOTES')
	                elsettings = (typeof val.elsettings != 'undefined' && val.elsettings) ? $.parseJSON(val.elsettings) : {};

                $('#el-empty').append($(tag));
                $('#el-empty').find('[data-loop="true"]').html('');

                var nodes = $(tag).find('[data-loop="true"]').children(),
                    p = $('#el-empty').children(),
                    i = [],
                    view = $(tag).find('[data-loop="true"]').data('view'),
                    total = 0,
                    display = 0;

                if(typeof view == 'undefined') view = 10;
	            var cookie_page = 1,
	                cookie_view = view,
	                // cookie_gallery_category = (typeof escape(stx) != 'undefined') ? escape(stx) : '',
	                cookie_gallery_category = (typeof stx != 'undefined') ? stx : '',
	                is_gc_cookie = (typeof $.cookie('gallery-category-'+val.seq) != 'undefined' && $.cookie('gallery-category-'+val.seq).length > 0) ? true : false;

				// $.cookie('gallery',val.seq, { path: '/', expires: 12 * 60 * 60 * 1000 });
				// $.cookie('loadmore-' + val.seq, cookie_page, { path: '/', expires: 12 * 60 * 60 * 1000 });
				$.cookie('gallery-page-' + val.seq, cookie_page, { path : '/', expires: 12 * 60 * 60 * 1000 });
				$.cookie('gallery-category-' + val.seq, cookie_gallery_category, { path : '/', expires: 12 * 60 * 60 * 1000 });
				$.removeCookie('loadmore-' + val.seq, { path : '/' });
				$.removeCookie('gallery', { path : '/' });

				var el_gh = $(tag).find('.goption').attr('data-gh'),
					checkGalleryHeight = (typeof el_gh != 'undefined' && el_gh) ? true : false,
					checkGallerySVG = ($(tag).find('.gimg-svg-wrap').length > 0) ? true : false,
					checkGFrameTitleOFF = (val.mode == 'gallery' && (typeof elsettings.gframe_title_visible != 'undefined' && elsettings.gframe_title_visible == 'OFF')) ? true : false;

                $.ajax({
                    url: '/template/gallery/list/pid/' + val.seq + '/sid/' + b.SID + '/spage/' + b.PAGE + '/view/' + cookie_view  + param,
                    data: { g_mode: val.mode, visible: true, sfl: sfl, stx: stx },
                    dataType: 'json',
                    type: 'POST',
                    async: false,
                    cache: false,
                    success: function (data) {
                        $.each(data.list, function (idx, value) {
                            i.push(value);
                        });

                        total = (typeof data.total.list_total != 'undefined') ? data.total.list_total : data.total;
                        display = data.list.length;

                        if ( i.length>0 || (i.length==0 && is_gc_cookie) ) {
                            var loop_count = nodes.length, item_index = 0;
                            var elem = [];
                            $.each(i,function(index,v) {
                                loop_pos = index%loop_count;
                                c = nodes[loop_pos];

								v.title = (v.title.length>0) ? v.title : 'Title';
								v.caption = (v.caption.length>0) ? v.caption : 'You can change this text';

								$(c).addClass('gallery-item').attr('data-index',index).attr('data-seq',v.seq);

                                var vgsettings = (typeof v.gsettings != 'undefined' && v.gsettings) ? $.parseJSON(v.gsettings) : {},
							        img_path = (typeof vgsettings['storage'] != 'undefined') ? vgsettings['storage'] : _this.b.RESOURCE + '/' + _this.b.SID + '/',
							        img_original = (typeof vgsettings['storage'] != 'undefined') ? img_path + '1920/' : img_path;

								var folder = (val.folder == 0) ? '' : val.folder + '/',
									src = getServeImage(v.image,val.folder,img_path),
									src_s0 = getServeImage(v.image,'0',img_path);
								$(c).find('img').attr('src', src);
								if(checkGalleryHeight) $(c).find('.g-img').css('background-image', 'url('+src+')');
								if(checkGallerySVG) {
									var gimgSVG = $(c).find('.gimg-svg-wrap svg');
									gimgSVG.find('pattern').attr('id','gimgSvg_'+val.elname+'_'+index);
									gimgSVG.find('image').attr('xlink:href', src);
									gimgSVG.find('polygon').attr('fill', 'url(#gimgSvg_'+val.elname+'_'+index+')');
								}
								
								var glink = (typeof vgsettings['glink'] != 'undefined' && vgsettings['glink']) ? vgsettings['glink'] : '',
									glink_target = (typeof vgsettings['glink_target'] != 'undefined' && vgsettings['glink_target']) ? vgsettings['glink_target'] : '';

								if(glink) {
									if(glink.match(/^\@/g) !== null) {													// link-type: link-bookmark ==> a[attr-bookmark]
										var bookmark_seq = glink.replace(/^\@/g,'');
										if(typeof _this.b.SETTINGS.blockBookmarkList == 'undefined' || typeof _this.b.SETTINGS.blockBookmarkList['bookmark' + bookmark_seq] == 'undefined') {
											glink = '';
											glink_target = '';
										}
									} else if(_this.b.MENULIST.includes(glink.replace(/^\//g,'').replace(/ /g,'-'))) {	// link-type: link-menu     ==> a[data-user-link]
									} else {																			// link-type: link-out      ==> a[attr-link]
										if(checkBase64Encode(glink)) glink = Base64.decode(glink);
									}
								}

								if (typeof v.price_hidden != 'undefined' && v.price_hidden == 'ON' && property['SITEUM'] >= 1) {
									$(c).addClass('gallery-item').addClass('nonePrice');
									$(c).find('a').attr('href', '#');
								} else {
	                                if(glink) {
										var glink_val = makeLinkUrl(glink, b.ONE, b.VIEW);

									    $(c).find('a').removeAttr('data-gallery').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');
									    $(c).find('a').attr('href',glink_val);

									    if(_this.b.MENULIST.includes(glink.replace(/ /g,'-'))) {
									        $(c).find('a').attr('data-user-link',glink_val);
									    } else if(glink.match(/^\@/g)) {
									        $(c).find('a').attr('attr-bookmark',glink.replace(/^\@/g,''));
									    } else {
									        $(c).find('a').attr('attr-link',glink);
									    }
	                                } else {
			                            $(c).find('a').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');

										if (val.mode == 'gallery') {
											$(c).find('a').attr('href', src_s0);
											$(c).find('a').attr('data-gallery', '#gframe-' + val.seq);
										} else {
											$(c).find('a').removeAttr('data-gallery');
											$(c).find('a').attr('href', ((URL=='/') ? '' : URL) + '/' + b.PAGE + '/view/' + v.seq);
										}
		                            }
		                        }

								if(glink_target == '_blank') $(c).find('a').attr('target','_blank');
								else $(c).find('a').removeAttr('target');

								if(checkGFrameTitleOFF) $(c).find('a').attr('data-title', '');
								else $(c).find('a').attr('data-title', v.title);

                                // caption
                                var ftitle = $(c).find('h5.figure'),
                                    fcaption = $(c).find('p.figure'),
                                    fdatetime = $(c).find('.figure.datetime'),
                                    fhashtag = $(c).find('.figure.hashtag'),
                                    fprice = $(c).find('.figure.price'),
									freview = $(c).find('.figure.review');

                                // datetime / hashtag
                                if(fdatetime.length<1) {
                                    $(c).find('figcaption').append('<div class="figure datetime hide"></div>');
                                    fdatetime = $(c).find('.figure.datetime');
                                }
                                if(fhashtag.length<1) {
                                    $(c).find('figcaption').append('<div class="figure hashtag hide"></div>');
                                    fhashtag = $(c).find('.figure.hashtag');
                                }

                                $(c).find('figcaption').removeClass('hide');
                                if (v.title || v.caption) {
                                    var gallery_caption = v.caption;
                                    gallery_caption = gallery_caption.replace(/\n/g,'<br />');

                                    ftitle.html(v.title);
                                    fcaption.html(gallery_caption);
                                    fdatetime.text(v.datetime);
                                    fhashtag.text(v.hashtag);
                                }
								if(val.mode == 'shopping') {

									var checkPriceHidden = (typeof v.price_hidden != 'undefined' && v.price_hidden == 'ON') ? true : false,
										gallery_price = (v.price && !checkPriceHidden) ? v.price : 0,
										gallery_sale_price = (typeof v.sale != 'undefined' && v.sale > 0 && !checkPriceHidden) ? v.sale : 0,
										gallery_sale_per = (typeof v.sale_per != 'undefined' && v.sale_per && !checkPriceHidden) ? v.sale_per : '',
										product_soldout = (typeof elsettings.sh_soldout == 'string') ? elsettings.sh_soldout : '구매불가',
                                        product_status = ((v.status == 'off' || (v.quantity_on == 'on' && v.quantity < 1)) && product_soldout && !checkPriceHidden) ? '<span class="cl-sh-soldout">' + product_soldout + '</span>' : '';

									$(c).find('.cl-sh-soldout').remove();
									if(product_status != '') $(c).attr('data-soldout',true);
									else $(c).removeAttr('data-soldout');

									if($(c).find('ul.figure.price').length > 0) {
										//Ver2
										if(gallery_price > 0) {
											$(c).find('ul.figure.price .price-val').html('￦' + gallery_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));
											$(c).find('ul.figure.price .price-val').removeClass('hide');

											if(gallery_sale_price > 0) {
												$(c).find('ul.figure.price .price-sale').html('￦' + gallery_sale_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));
												$(c).find('ul.figure.price .price-sale-per').html(gallery_sale_per);
												$(c).find('ul.figure.price .price-sale, ul.figure.price .price-sale-per').removeClass('hide');
											} else {
												$(c).find('ul.figure.price .price-sale, ul.figure.price .price-sale-per').addClass('hide').html('');
											}
										} else {
											$(c).find('ul.figure.price .price-val, ul.figure.price .price-sale, ul.figure.price .price-sale-per').addClass('hide').html('');
										}

										if(product_status) $(c).find('ul.figure.price').append('<li>'+product_status+'</li>');

									} else {
										//Ver1
										if(fprice.length == 0) fprice = fcaption;
										
										if(checkPriceHidden) fprice.html('');
										else fprice.html('<span class="figure-krw">￦</span>' + gallery_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',') + product_status);
									}

									if($(c).find('ul.figure.review').length > 0) {
										var gallery_review = (v.review_onoff && v.review_cnt) ? v.review_cnt : 0;
										if(gallery_review > 0) {
											$(c).find('ul.figure.review, ul.figure.review li').removeClass('hide');
											$(c).find('ul.figure.review .figure-review-cnt').html(gallery_review);
											$(c).find('ul.figure.review .figure-review-score').html(v.review_score);
										} else {
											$(c).find('ul.figure.review, ul.figure.review li').addClass('hide');
											$(c).find('ul.figure.review .figure-review-cnt, ul.figure.review .figure-review-score').html('');
										}
									}

								} else {
									fprice.addClass('hide');
									freview.addClass('hide');
								}
                                
                                $(p).find('[data-loop="true"]').append($(c)[0].outerHTML);
                            });
                        } else {
                        	if(idx == '0') {
	                            nodes.find('a')
	                                .addClass('emptyGalleryItem')
	                                .attr('href', '/config/page/' + b.PAGE + '/view/template')
	                                .removeAttr('data-gallery')
									.removeAttr('data-user-link')
									.removeAttr('attr-bookmark')
									.removeAttr('attr-link')
	                                .find('img')
	                                .attr('data-index',0);
	                            $(p).find('[data-loop="true"]').append(nodes);
                        	}

	                        $.cookie('gallery-category-'+val.seq,'',{ path: '/', expires: 12 * 60 * 60 * 1000 });
                        }

                        tag = $(p)[0].outerHTML;
                
                        if (val.mode == 'gallery' && total) tag = appendGalleryFrame($(tag),val.seq,val.elsettings);
                        $('#el-empty').empty();
                    }
                });

                var $tag = $(tag),
                	$galleryEL = $('.element[data-id="' + val.seq + '"]'),
                	g_settings = (typeof val.elsettings != 'undefined' && val.elsettings) ? $.parseJSON(val.elsettings) : {};

                $.each($tag.find('[data-edit="true"]'), function() {
                    var source = $(this).html();
                    source = source.replace(/&lt;&nbsp;/g,'&lt;').replace(/&nbsp;&gt;/g,'&gt;');
                    $(this).html(source);
                });

                if(val.feature=='masonry') {
                    var $container = $galleryEL.find('.container'),
                        $gallery_items = $tag.find('[data-loop="true"]');

                    $container.html('');
                    $galleryEL.find('[data-loop="true"]').before('<div class="gallery-loading-status"><div class="loading-dots"></div></div>');

                    var process_index = 0,
		                last_view = (view > total) ? total : view; 
                    $gallery_items.imagesLoaded().progress(function(imgload, image) {
                        process_index++;
                        if(total>0 && last_view==process_index) {
                        	reloadMasonry($container,$gallery_items);
							refreshGalleryField($galleryEL,g_settings);
                        }
                    });
                } else {
                    $galleryEL.find('[data-loop="true"]').replaceWith($tag.find('[data-loop="true"]'));
					refreshGalleryHeight();
					refreshGalleryField($galleryEL,g_settings);
                }

                if(total == 0) {
					var gallery_empty_str = '<div class="col-xs-12 col-sm-12 col-md grid empty-txt">' + $.lang[LANG]['editor.gallery.category.empty.list'] + '</div>';
	                if(val.feature=='masonry') { 
	                    $galleryEL.find('.container').removeAttr('style').addClass('empty').append(gallery_empty_str);
	                } else {
	                    $galleryEL.find('[data-loop="true"]').addClass('empty').empty().append(gallery_empty_str);
	                }
                    $galleryEL.find('.gallery-loadmore').remove();
                } else if ( total == view || view > display ) {
                   $galleryEL.find('.gallery-loadmore').remove();
                } else {
					var btn_class = (val.feature=='masonry') ? 'gallery-loadmore masonry-layout' : 'gallery-loadmore',
						btn_txt = (typeof g_settings.loadmore_lang != 'undefined' && g_settings.loadmore_lang == 'KO') ? '더보기' : 'LOAD MORE',
						btn_tag = '<div class="' + btn_class + '" data-total="' + total + '" data-id="' + val.seq + '" data-page="2" data-view="' + view + '" data-folder="' + val.folder + '" data-mode="' + val.mode + '">' + btn_txt + ' &nbsp;(<span class="display">' + cookie_view + '</span> / ' + total + ')</div>';

					if($galleryEL.find('.gallery-loadmore').length > 0) $galleryEL.find('.gallery-loadmore').replaceWith(btn_tag);
					else $galleryEL.append(btn_tag);
                }

                if($galleryEL.find('*[data-direffect="true"]').length > 0 ) {
                    setTimeout(function() {
                        $galleryEL.find('.grid').each(function() {
                            $(this).hoverdir();
                        });
                    }, 400);
                }
		    }
		});


		// menu ver3 : fheader - #mobile-nav show/hide function
		$(document).on('click', '#fixed-menu li.siteSEARCH > a.psearch-btn, \
								#fixed-menu li.siteSEARCH .psearch-overlay.open, \
								#fixed-menu li.siteSEARCH .psearch-input, \
								#fixed-menu-sub li.siteSEARCH > a.psearch-btn, \
								#fixed-menu-sub li.siteSEARCH .psearch-overlay.open, \
								#fixed-menu-sub li.siteSEARCH .psearch-input', function(e) {
			e.preventDefault();
			var taret_nav = (window.innerWidth <= 768) ? $('#mobile-nav') : $('header.navbar-fheader'),
				check_psearch_area = (taret_nav.find('.psearch-wrap').is(e.target) || taret_nav.find('.psearch-wrap').has(e.target).length > 0) ? true : false;
	
			if(!check_psearch_area) {
				taret_nav.find('.psearch-overlay').toggleClass('open');
				setTimeout(function() {
					$.psearch.showSiteProjectSEARCH(false);
					taret_nav.find('.psearch-overlay').find('input.psearch-input').focus();
				},300);
			}
			return false;
		});

		$(document).on('click', '#fixed-menu li.siteCART > a[href="javascript:;"], #fixed-menu-sub li.siteCART > a[href="javascript:;"]', function(e) {
			e.preventDefault();
			$(this).showModalFlat('INFORMATION',$.lang[LANG]['fheader.cart.no-support.render-mode'],true,false,'','ok');
			return false;
		});

		$(document).on('click', '#mobile-nav .login-content:not(.siteUM)', function(e) {
			e.preventDefault();
			$('#mobile-nav #fixed-menu .siteUM a i').click();
			return false;
		});

		$(document).on('click', '#mobile-nav .nav li.menu-has-children > a[href="javascript:;"]', function(e) {
			e.preventDefault();
			$(this).prev('.fa').click();
			return false;
		});

		$(document).on('click', '#mobile-nav ul li.menu-has-children i', function(e) {
			if($(this).closest('li.menu-has-children').hasClass('open')) {
				$(this).closest('li.menu-has-children').removeClass('open');
				$(this).nextAll('ul').eq(0).slideToggle(200);
				// $(this).next().removeClass('menu-item-active');
				$(this).toggleClass('fa-chevron-down fa-chevron-up');
			} else {
				$(this).closest('li.menu-has-children').addClass('open').siblings('li.open').find('i').click();
				$(this).nextAll('ul').eq(0).slideToggle(200);
				// $(this).next().toggleClass('menu-item-active');
				$(this).toggleClass('fa-chevron-down fa-chevron-up');
			}
		});

		$(document).on('click', 'header.navbar-fheader .navbar-toggle', function(e) {
			if($('.dsgn-body').hasClass('mobile-nav-active')) {
				//close mobile menu
				$('header.navbar-fheader .navbar-toggle').css({'visibility':'visible'});
				$('.dsgn-body').removeClass('mobile-nav-active');
				$('#mobile-body-overly').removeClass('in');
			} else {
				//show mobile menu
				$('header.navbar-fheader .navbar-toggle').css({'visibility':'hidden'});
				$('.dsgn-body').addClass('mobile-nav-active');
				$('#mobile-body-overly').addClass('in');
			}
		});

		$(document).on('click', '.dsgn-body.mobile-nav-active', function(e) {
			if( $('#mobile-nav').is(e.target) || 
				$('#mobile-body-overly').is(e.target) || 
				( $(e.target).is('img') && $(e.target).parent('#mobile-nav-toggle') )
			) {
				$('header.navbar-fheader .navbar-toggle').click();
			}
		});



		$('header.navbar-simple .navbar-toggle').live('click',function(e) {
			var check = $(this).hasClass('collapsed') ? false : true;
			if(check) {
				var p_t = $('.el-menu header').height() + 'px';

				$('.element').each(function(){ $(this).addClass('blur-filter'); });
				$('.el-menu').addClass('blur-filter');

				if($('body').height() > ($('.el-menu').find('#tpl-menu').height() + 80)) $('.el-menu').find('#tpl-menu').addClass('center-position');
				else $('.el-menu').find('#tpl-menu').removeClass('center-position');
				
				$('.dsgn-body').bind('touchmove');
				$('#goto-top').hide();
			} else {
				$('.element').each(function(){ $(this).removeClass('blur-filter'); });
				$('.el-menu').removeClass('blur-filter');
		        $('.dsgn-body').unbind('touchmove');
				$('#goto-top').show();
			}
		});


		$('.element[data-type="gallery"]').live({
			mouseenter : function() {
				$(this).find('.row[data-direffect="true"] .grid').each(function() {
					$(this).hoverdir();
				});
			}
		});	

		$('.creatorlink-header .data-user > ul > li').live({
			click : function() {
				$(this).closest('.pull-right').toggleClass('open');
				if($(this).closest('.pull-right').hasClass('open')) {
					$('.popover').show();
				} else {
					$('.popover').hide();
				}
			}
		});


		$('*[data-user-link]').live('click',function(e) {
			if(e.target.className.indexOf('fa') > -1 && $(this).closest('header').hasClass('navbar-simple')) {
				return false;
			}
			$.removeCookie('gallery', { path: '/' });
			$.removeCookie('gallery-item', { path : '/' });
			$.removeCookie('forum', { path : '/' });
			$.removeCookie('forum-item', { path : '/' });

		 	if(!selectEL || typeof selectEL == 'undefined') {
				selectEL = $(this).closest('.element').attr('data-el');
			}

			//latest block - table header click, set click table
			if(typeof $(this).attr('data-lt-header') != 'undefined') {
				var type = $(this).closest('.latest-table').attr('data-type'),
					pid = $(this).closest('.latest-table').attr('data-pid'),
					clickEL = (type == 'gallery') ? $('.gallery-item[data-seq="'+pid+'"]') : $('.element[data-id="' + pid + '"]'),
					checkThisPage = (b.ONE && clickEL.length > 0) ? true : false;

				if(checkThisPage) {
					if(type == 'forum') {
						scrollToBlock('.element[data-id="' + pid + '"]', 1000);
						return false;
					} else if(type == 'gallery') {
						moveGallery(pid);
						return false;
					}
				} else $.cookie(type+'-item',pid, { path: '/' });
			}

			//psearch - project item(pitem) click, set click parent
			if($(this).closest('.psearch-view').length > 0) {
				if(typeof $(this).attr('data-psearch-seq') != 'undefined') {
					$.cookie('gallery-item',$(this).attr('data-psearch-seq'), { path: '/' });
				} else {
					$.cookie('gallery',$(this).attr('data-psearch-pid'), { path: '/' });
				}

				if(b.ONE && typeof $(this).attr('data-user-link') != 'undefined' &&  $(this).attr('data-user-link') == 'index') {
					location.replace('/');
					return false;
				}
			}

		 	var datatype = $('.'+selectEL).attr('data-type'),
    			isimglink = $('.'+selectEL).hasClass('imglink'),
    			hasalink = $(this).hasClass('sha_link'),
    			isshlink = $(this).is('[data-shlink]');

		    var userLink = ((datatype == 'showcase') && isimglink && isshlink) ? $(this).attr('data-shlink') : $(this).attr('href'),
        		target = '';


    		if((typeof $(this).attr('target') != 'undefined') || (typeof $(this).attr('data-blank') != 'undefined')) {
		        if((datatype == 'showcase') && isimglink && isshlink) {
		           target = $(this).attr('data-blank'); 
		        } else target = $(this).attr('target'); 
		    } 

		    if(userLink.match(/^mailto:|^tel:|^sms:/gi) !== null) {
		    	window.location.href = userLink;
		    	return false;
		    }

			if(typeof userLink == 'undefined' || $(this).attr('data-user-link') == '' ) {
				if(target == '_blank' || target == 'blank') {
			    	var openNewWindow = window.open(userLink);
			    	return false;
		    	} else  {
			    	var url = new getLocation(userLink);
			    	golink(_this,url);
			    	return false;
		    	}
			}

			e.preventDefault();
		    if(b.ONE) {
		    	if(userLink.charAt(0)=="/") {
				    var linkRegExp = /\/view\//gi;
				    var linkMatch = userLink.match(linkRegExp);
				    if(linkMatch && linkMatch[0]) {
					    var url = ((b.URL=="/") ? "" : b.URL) + userLink;
					    if(target == '_blank') {
					    	var openNewWindow = window.open(url);
					    } else { 
						    location.href=url;
						}
					    return false;
				    }
			    	userLink = userLink.charAt(0).replace("/","") + userLink.slice(1);
			    	if(target == '_blank') {
					    var url = ((b.URL=="/") ? "/" : b.URL) + '#' + userLink;
				    	var openNewWindow = window.open(url);
			    	} else { 
			    		if(b.VIEW) {
						    var url = ((b.URL=="/") ? "/" : b.URL) + '#' + userLink;
					    	url = new getLocation(url);
					    	golink(_this,url);
			    		} else {
			    			moveLinkPage(userLink);
			    		}
				    }
		    	} else {
		    		// alert('Invalid URL');
		    		return false;
		    	}
		    } else {
			    var url = ((b.URL=="/") ? "" : b.URL) + userLink;
			    if(target == '_blank' || target == 'blank') {
			    	var openNewWindow = window.open(url);
			    } else { 
			    	url = new getLocation(url);
			    	golink(_this,url);
				}
		    }
		});

		$("a[attr-bookmark],*[data-imglink='true'][attr-bookmark]").live({
		    click : function(e) {
		        e.preventDefault();
				if(e.target.className.indexOf('fa') > -1 && $(this).closest('header').hasClass('navbar-simple')) {
					return false;
				}
				if(!selectEL || typeof selectEL == 'undefined') {
					selectEL = $(this).closest('.element').attr('data-el');
				}
				var datatype = $('.'+selectEL).attr('data-type'),
            		isimglink = $('.'+selectEL).hasClass('imglink'),
            		hasalink = $(this).hasClass('sha_link'),
            		isshlink = $(this).is('[data-shlink]');
				
				$.removeCookie('gallery', { path: '/' });
				$.removeCookie('gallery-item', { path : '/' });
				$.removeCookie('forum', { path : '/' });
				$.removeCookie('forum-item', { path : '/' });

		        var a_el = $(this),
		        	link = ((datatype == 'showcase') && isimglink && isshlink) ? $(this).attr('data-shlink').replace(/^\@/g,'') : $(this).attr('href').replace(/^\@/g,''),
		            target = '';

	            if((typeof $(this).attr('target') != 'undefined') || (typeof $(this).attr('data-blank') != 'undefined')) {
		            if((datatype == 'showcase') && isimglink && isshlink) {
		               target = $(this).attr('data-blank'); 
		            } else target = $(this).attr('target'); 
		        } 

		        if($('.element[data-bookmark="' + link + '"]').length > 0 && target != '_blank') {
		            moveLinkPage(b.PAGE+'\@'+link,1200,true);
		        } else {
		        	var attr_bookmark = $(this).attr('attr-bookmark');
		        	if(typeof attr_bookmark != 'undefined' && attr_bookmark && typeof b.SETTINGS.blockBookmarkList['bookmark' + attr_bookmark] != 'undefined') {
		        		// if(b.SETTINGS.blockBookmarkList['bookmark' + attr_bookmark] == link) {
		        			link = attr_bookmark;
		        		// }
		        	}
					if(typeof b.SETTINGS.blockBookmarkList == 'undefined'|| !b.SETTINGS.blockBookmarkList || typeof b.SETTINGS.blockBookmarkList['bookmark'+link] == 'undefined' ) {
						a_el.find('img[data-attach="true"]').unwrap();
						return false;
					}

		            $.post('/template/bookmarkBlock', {sid: b.SID, seq: link, publish : b.PUBLISH}, function(data) {
						checkError(data);

						var d = data[0];
						if(typeof d.orgpage == 'undefined' || d.orgpage.length == 0) d.orgpage = d.page;

						var	org_title = d.orgpage.replace(/-/g," "),
							bb_o_page = (d.page.match(/^index/g) !== null ) ? org_title : d.page,
							bb_page = (bb_o_page.match(/\,/g) !== null) ? bb_o_page.substring(0,d.page.indexOf('\,')) : bb_o_page;


						var check_link = true,
							is_visible_menu = false;

						$.each(b.SMENU, function (idx, obj) {
							if(bb_page == obj.name.replace(/ /g,'-')) {
								if(!obj.link) check_link = false;
								if(obj.display == 'on') is_visible_menu = false;
							}
							if(obj.children) {
								$.each(obj.children, function (i, v){
									if(bb_page == v.name.replace(/ /g,'-')) {
										if(!v.link) check_link = false;
										if(v.display == 'on') is_visible_menu = false;
									}
								});
							}
						});

						var is_here = ($('.element[data-bookmark="' + link + '"]').length > 0 ) ? true : false,
							is_page = (b.PAGE.toLowerCase()==d.page.toLowerCase()) ? true : false,
							// is_visible_menu = ($.inArray(bb_page,b.MENULINK)>-1) ? true : false,
							// check_link = ( $('#tpl-menu li a[href*="'+bb_page+'"]').length > 0 && $('#tpl-menu li a[href*="'+bb_page+'"]').text().trim().replace(/ /gi,'-') == bb_page ) ? false : true,
							is_link = ( check_link && is_visible_menu && org_title != 'INTRO' ) ? true : false,
							is_visible = (check_link && is_visible_menu && org_title != 'INTRO') ? true : false;


						// console.log('is_visible_menu : ' + is_visible_menu);
						// console.log('bb_page : ' + bb_page);
						// console.log('d.glivisible : ' + d.glivisible);
						// console.log('is_link : ' + is_link);
						// console.log('is_visible : ' + is_visible);
						// console.log('is_here : ' + is_here);
						// console.log('is_page : ' + is_page);

						if( ( !is_visible_menu && bb_page!='index' ) || 
							( typeof d.glivisible!='undefined' && d.glivisible ) ||
							( /*( (is_here && target=='_blank') || !is_page ) &&*/ ( is_link || is_visible ) ) ||
							( !is_here && is_page ) )  {
								if(is_visible_menu == false) {
									moveBookmark(d.page,'\@'+link,1200,target);
								} else {
									a_el.find('img[data-attach="true"]').unwrap();
									return false;
								}
						} else {
							moveBookmark(d.page,'\@'+link,1200,target);
						}

		            }, 'json');
		        }
		        
		    }
		});

		$('.element img[data-attach="true"][data-img-original="ON"]').live({
			click: function(e) {
				$(this).mouseenter();
			},
			mouseenter : function(e) {
				if(!selectEL || typeof selectEL == 'undefined') {
					selectEL = $(this).closest('.element').attr('data-el');
				}
				if(typeof selectEL == 'undefined') return false;

				var offset = $(this).offset(),
			        left = $(this).width() + offset.left-25,
					top = offset.top;
				var index = $('.' + selectEL + ' img[data-attach="true"]').index(this);

				if(b.VIEW) {
					var src = $(this).prop('src').split('/'),
						file = src[src.length-1];
		            if(src.indexOf('googleusercontent') > -1) {
		            	file = src;
		            }
					$('.config-image-view').css({ top : top + 'px', left : left + 'px' }).attr('data-src',$(this).prop('src')).attr('data-index',index).show();
				}
			},
			mouseleave : function(e) {
				$('.config-image-view').hide();
			}
		});

		$('.config-image-view').live({
			mousemove : function(e) { $('.config-image-view').show(); },
			mouseout : function(e) { $('.config-image-view').show(); }
		});

	    $('.config-image-view').on({
			click: function (e) {
				$('.config-image-view').hide();

				var src = $(this).attr('data-src').split('/'),
					file = src[src.length-1],
	                free = (src[4]=='free') ? true : false;

	            var img_src = $(this).attr('data-src')
	            if(img_src.indexOf('googleusercontent') > -1) {
	            	file = img_src;
	            }
	            file = Base64.encode(file);
				if(b.SID && file) {
					$('.tooltip.in').removeClass('in');
			  		$(this).attr("href","/image/original/sid/" + b.SID + "/file/" + file + '/free/' + free);
				} else {
					// console.log('None:: sid or src');
					return false;
				}
	        }
	    });

		$('[data-lock-password]').live('keydown.autocomplete', function(e) {
		    if (e.keyCode == 13) {
		    	$('[data-lock-submit]').click();
			}
		});

		$('[data-form-submit]').live('click', function() { 
			if($('#flat-modal').length) return;
			var $parent = $(this).parents('.element'),
				$items = $parent.find('[form-idx]'),
				values = {},
				pid = $parent.attr('data-id'),
				submit = true,
				el = '.' + $(this).parents('.element').attr('data-name');

			$parent.find('.error').remove();
			$.each($items, function(i,v) {
				var idx = $(this).attr('form-idx'),
					name = $(this).attr('form-name'),
					type = $(this).attr('form-type'),
					require = $(this).attr('form-require'),
					seq = $(this).attr('form-seq');

				switch(type) {
					case "radio":
					case "check":
						if(type == 'radio') {
							var val = $(this).find(':radio[name]:checked').val();
							values[seq] = (typeof val == 'undefined') ? '' : val;
						} else {
							values[seq] = $(this).find(':checkbox[name]:checked').map(function() { return this.value; } ).get().join();
						}

						if(typeof require != 'undefined' && require) {
							if(!values[seq]) {
								formRequireDisplay($(this),i+1);
								submit = false;
							}
						}
						break;
					case "date":
					case "date2":
						var date = $(this).find('input').map(function() { return this.value; } ).get(),
							valid = true;

						$.each(date, function(k,d) {
							if(d=='') valid = false;
						});

						if(typeof require != 'undefined' && require) {
							if(valid == false) {
								formRequireDisplay($(this),i+1);
								submit = false;
							}
						}
						values[seq] = date.join('');
						break;
					default : 
						values[seq] = $(this).val().trim();
						if(typeof require != 'undefined' && require) {
							if(!values[seq]) {
								formRequireDisplay($(this),i+1);
								submit = false;
							}
						}
						break;
				}
			});

			var $privacy = $parent.find('.form-privacy'),
				check;

			if($privacy.css('display')!='none') {
				check = $privacy.find('.check-privacy').prop('checked');
				if(check === false) {
					formRequireDisplay($privacy.find('.check-privacy'),'privacy');
					submit = false;
				}
			}

			if(submit) {
				$.processON();
		        $.ajax({
		            url: '/template/forms/submit',
					data: { sid : b.SID, pid : pid, values : values, check : check },
					dataType: 'json',
					type: 'POST',
		            async: true,
		            cache: false,
		            success: function (data) {
					    $.processOFF();
						checkError(data);
						$(this).showModalFlat('INFORMATION',data.done,true,false);

			    		setDefaultForm(el);
			    		if(typeof formCallback == 'function')
			    			formCallback(pid);
			    	}
				},'json');
			}
		});

		var formRequireDisplay = function($obj,idx) {
			var blang = $obj.parents('.element').attr('data-lang'),
				sdefault = '';

			if(typeof property.SLANG.select != 'undefined') {
				var _lang = property.SLANG.select;
				if(_lang.indexOf('한국어') > -1) {
					sdefault = '필수 입력 사항';
				} else if(_lang.indexOf('English') > -1) {
					sdefault = 'Required';
				} else if(_lang.indexOf('日本語') > -1) {
					sdefault = '必須';
				} else {
					sdefault = 'Required';
				}
			} else sdefault = '필수 입력 사항';

			/*
			if(typeof blang == 'undefined') {
				blang = getLanguage(true);
			}
	        if(blang == 'ko') {
	        	sdefault = '필수 입력 사항';
	        } else if(blang == 'en') {
	            sdefault = 'Required';
	        } else if(blang == 'ja') {
	            sdefault = '必須';
	        } else {
	            sdefault = 'Required';
	        }
			*/
			var $parent = $obj.parents('.form-group'),
				$html = $('<div class="error">' + sdefault + '</div>');
			$parent.append($html);
			if($obj.parents('.form-inline').find('.error').length==1) {
				if(isNumber(idx)) $('body').scrollTo($('[form-idx="' + idx + '"]'), 0, { offset : -150 } );
				else  $('body').scrollTo($parent, 0, { offset : -150 } );
			}
		}

		$('.date-yyyy').live('keyup', function(e) {
			var val = $(this).val();
			if(val.length>=4) {
				if((e.target.selectionStart).length) ;
				else {
					if(isNaN(parseInt(val))) {
						$(this).val('1900');
					}
					$(this).parents('.form-group').find('.date-mm').focus();
				}
			}				
		}).live('blur', function(e) {
			var val = $(this).val();
			if(isNaN(parseInt(val))) {
				$(this).val('1900');
			} else {
				if(parseInt(val)<1900) {
					$(this).val('1900');
				}
			}
		});

		$('.date-mm, .date-dd, .date-hh, .date-ii').live('keyup', function(e) {
			var val = $(this).val();
			if(val.length>=2) {
				if((e.target.selectionStart).length) ;
				else {
					if(isNaN(parseInt(val))) {
						$(this).val('00');
					}
					if($(this).hasClass('date-mm')) {
						$(this).parents('.form-group').find('.date-dd').focus();
					} else if($(this).hasClass('date-dd')) {
						$(this).parents('.form-group').find('.date-hh').focus();
					} else if($(this).hasClass('date-hh')) {
						$(this).parents('.form-group').find('.date-ii').focus();
					} else if($(this).hasClass('date-ii')) {
						// $(this).parents('.form-group').next().find('input').focus();
					}
				}
			}				
		}).live('blur', function(e) {
			var val = $(this).val();
			if(isNaN(parseInt(val))) {
				$(this).val('01');
			} else {
				if(val.length==1) {
					$(this).val('0' + val);
				} else {
					if($(this).hasClass('date-mm') && parseInt(val)>12) {
						$(this).val('12');
					} else if($(this).hasClass('date-dd') && parseInt(val)>31) {
						$(this).val('31');
					} else if($(this).hasClass('date-hh') && parseInt(val)>23) {
						$(this).val('00');
					} else if($(this).hasClass('date-ii') && parseInt(val)>59) {
						$(this).val('00');
					}
				}
			}
		});

		$('[data-lock-submit]').live('click', function() { 
			$.modalON();
			var el = '.' + $(this).parents('element').attr('data-name');

			var pw = $('[data-lock-password]').val();
			if(pw.length == 0 ) {
				$('[data-lock-password]').focus();
				$('.error-text').text('! ' + $.lang[LANG]['config.enter-password']);
			}
			$.post('/template/menuLockController/type/pw_check', {s: b.SMENU, sid: b.SID, page: b.PAGE, pw: pw, publish : b.PUBLISH}, function(data) {
				checkError(data);
				$.modalOFF();
				if(data.result) {
					window.location.reload(true);
				} else {
					$('[data-lock-password]').focus();
					$('.error-text').text('! ' + $.lang[LANG]['config.enter-password']);
				}
			}, 'json');
		});

		$('[data-contact-submit]').live('click',function() {
			if($('#flat-modal').length || window.location != window.parent.location) return;
			$.modalON();
		    var el = '.' + $(this).parents('.element').attr('data-name'),
		    	el_id = $(this).parents('.element').attr('data-id'),
		    	google_track = $(this).attr('data-google-track'),
		    	google_track_run = false,
		    	daum_track = $(this).attr('data-daum-track'),
		    	daum_track_run = false,
		    	naver_track = $(this).attr('data-naver-track'),
		    	naver_track_run = false;
			
			google_track_run = (typeof google_track != 'undefined') ? true : false;
			daum_track_run = (typeof daum_track != 'undefined') ? true : false;
			naver_track_run = (typeof naver_track != 'undefined') ? true : false;

		    if($(el).length==0 || $(el).length>1) {
		        alert('Invalid form data');
		        return false;
		    }

		    var firstname = setDefaultValue($(el + ' [data-contact-firstname]').val()),
		    	lastname = 	setDefaultValue($(el + ' [data-contact-lastname]').val()),
		    	email = 	setDefaultValue($(el + ' [data-contact-email]').val()),
		    	web = 		setDefaultValue($(el + ' [data-contact-website]').val()),
		    	phone = 	setDefaultValue($(el + ' [data-contact-phone]').val()), 
		    	subject = 	setDefaultValue($(el + ' [data-contact-subject]').val()),
		    	message = 	setDefaultValue($(el + ' [data-contact-message]').val()),
		    	etc = {};
    		$(el + ' [data-contact-etc]').each(function(i) {
				var key = $(this).attr('data-contact-etc');
				etc[key] = setDefaultValueEtc($(this).attr('type'),$(this));
			});

		    var require_firstname 	= $(el + ' [data-contact-firstname]').attr('data-required'),
		    	require_lastname 	= $(el + ' [data-contact-lastname]').attr('data-required'),
		    	require_email		= $(el + ' [data-contact-email]').attr('data-required'),
		    	require_web			= $(el + ' [data-contact-website]').attr('data-required'),
		    	require_phone		= $(el + ' [data-contact-phone]').attr('data-required'),
		    	require_subject 	= $(el + ' [data-contact-subject]').attr('data-required');

		    /*default:: required[email,message] | optional[firstname,lastname,web,phone,subject]  // data-optional='true'->optional, 'false'->required */
		    var optional_firstname  = $(el + ' [data-contact-firstname]').attr('data-optional'),
		    	optional_lastname   = $(el + ' [data-contact-lastname]').attr('data-optional'),
		    	optional_email		= $(el + ' [data-contact-email]').attr('data-optional'),
		    	optional_web		= $(el + ' [data-contact-web]').attr('data-optional'),
		    	optional_phone		= $(el + ' [data-contact-phone]').attr('data-optional'),
		    	optional_subject	= $(el + ' [data-contact-subject]').attr('data-optional'),
		    	optional_message	= $(el + ' [data-contact-message]').attr('data-optional');
		    var optional_etc		= {};

    		$(el + ' [data-contact-etc]').each(function(i) {
				var key = $(this).attr('data-contact-etc');
				optional_etc[key] = $(this).attr('data-optional');
			});

    		var $parent = $(this).parents('.element'),
    			el = '.' + $(this).parents('.element').attr('data-name'),
		    	contprivacy = $(el+' .form-group.contact-privacy-area').css('display'),
        		contprivacy_display = (typeof contprivacy == 'undefined' || contprivacy == 'none') ? false : true,
    			privacy_check = $parent.find('.contact-checkbox-text'),
				privacy_chk = privacy_check.is(":checked"),
				check = true,
		    	check_option = [];

		    if((!firstname && typeof optional_firstname != 'undefined' && optional_firstname == "false") || (!lastname && typeof optional_lastname != 'undefined' && optional_lastname == "false")) {
		    	var str = ($(el + ' [data-contact-firstname]').attr('data-contact-firstname').length > 0) ? $(el + ' [data-contact-firstname]').attr('data-contact-firstname') : 'name';
		    	check_option.push(str);
		    }
		    
		    if(!web && typeof optional_web != 'undefined' && optional_web == "false") {
		    	var str = ($(el + ' [data-contact-web]').attr('data-contact-web').length > 0) ? $(el + ' [data-contact-web]').attr('data-contact-web') : 'web';
		    	check_option.push(str);
		    }

		    if(!phone && typeof optional_phone != 'undefined' && optional_phone == "false") {
		    	var str = ($(el + ' [data-contact-phone]').attr('data-contact-phone').length > 0) ? $(el + ' [data-contact-phone]').attr('data-contact-phone') : 'phone';
		    	check_option.push(str);
		    }

		    if(!subject && typeof optional_subject != 'undefined' && optional_subject == "false") {
		    	var str = ($(el + ' [data-contact-subject]').attr('data-contact-subject').length > 0) ? $(el + ' [data-contact-subject]').attr('data-contact-subject') : 'subject';
		    	check_option.push(str);
		    }

		    if(!email) {
		    	if(typeof optional_email != 'undefined' && optional_email == "true") check = true;
		    	else if ($(el + ' [data-contact-email]').length == 0) check = true;
		    	else check = false;
		    	
		    	var str = ($(el + ' [data-contact-email]').attr('data-contact-email').length > 0) ? $(el + ' [data-contact-email]').attr('data-contact-email') : 'email';
		    	if(!check) check_option.push(str);
		    }
		    if(!message) {
		    	if(typeof optional_message != 'undefined' && optional_message == "true") check = true;
		    	else check = false;

		    	var str = ($(el + ' [data-contact-message]').attr('data-contact-message').length > 0) ? $(el + ' [data-contact-message]').attr('data-contact-message') : 'message';
		    	if(!check) check_option.push(str);
		    }

		   	$.each(etc,function(k,v){
		   		if(!etc[k] && typeof optional_etc[k] != 'undefined' & optional_etc[k] == "false") {
		   			check_option.push(k);
		   		}
		   	});

		   	check = ((check_option.length == 0) && ((contprivacy_display == false) || (privacy_chk == true))) ? true : false;

		    if(require_firstname == "true" && !firstname) {
		    	$(this).showModalFlat('INFORMATION',$(el + ' [data-contact-firstname]').attr('placeholder') + $.lang[LANG]['check.required'], true, false, '', 'ok');
		    	return false;
		    }

		    if(require_lastname == "true" && !lastname) {
		    	$(this).showModalFlat('INFORMATION',$(el + ' [data-contact-lastname]').attr('placeholder') + $.lang[LANG]['message.check.required'], true, false, '', 'ok');
		    	return false;
		    }

		    if(require_web == "true" && !web) {
		    	$(this).showModalFlat('INFORMATION',$(el + ' [data-contact-website]').attr('placeholder') + $.lang[LANG]['message.check.required'], true, false, '', 'ok');
		    	return false;
		    }

		    if(require_phone == "true" && !phone) {
		    	$(this).showModalFlat('INFORMATION',$(el + ' [data-contact-phone]').attr('placeholder') + $.lang[LANG]['message.check.required'], true, false, '', 'ok');
		    	return false;
		    }

		    if(require_subject == "true" && !subject) {
		    	$(this).showModalFlat('INFORMATION',$(el + ' [data-contact-subject]').attr('placeholder') + $.lang[LANG]['message.check.required'], true, false, '', 'ok');
		    	return false;
		    }

		    if(check) {
		    	$.post('/template/update/type/contact',{
		    		id : b.SID,
		    		seq : el_id,
		    		s : 'message',
		    		firstname : firstname,
		    		lastname : lastname,
		    		email : email,
		    		web : web,
		    		phone : phone,
		    		subject : subject,
		    		message : message,
		    		etc : JSON.stringify(etc),
		    	}, function(data) {
		    		checkError(data);
		    		if(typeof data.error == 'undefined' || data.error=="") {
			    		$(this).showModalFlat('INFORMATION',$.lang[LANG]['message.sent'],true,false, '', 'ok');
			    		setDefaultContactForm(el);
			    		setDefaultContactFormEtc(el);
			    		if(typeof contactCallback == 'function')
			    			contactCallback();
		    		}
		    	},'json');
			    setTimeout(function() {
				    $.modalOFF();
			    },1000);
		    } else {
		    	$.modalOFF();
		    	var check_str = '';
		    	$.each(check_option,function(k,v) {
		    		check_str = (check_str) ? check_str + ' / ': '';
		    		check_str = check_str + v;
	            });
	            
		    	if(check_str) {
		    		var modal = $(this).showModalFlat('INFORMATION',check_str+ $.lang[LANG]['message.check.required'],true,false, '', 'ok');
		    	} else {
		    		var modal = $(this).showModalFlat('INFORMATION',$.lang[LANG]['message.privacy.check.required'],true,false, '', 'ok');
		    	}
		    	
		    }					    
		});	
	
		$('.contact-privacy-text').live('click',function() {
			var contactEL = $(this).parents('.element'),
				contactPriavcy = $(contactEL).find('.form-inline .contact-privacy-area .contact-privacy-box'),
				checkType = (typeof $(contactEL).attr('data-type') != 'undefined' && $(contactEL).attr('data-type') == 'contact') ? true : false;

			if(checkType && contactPriavcy.length > 0) {
				if(contactPriavcy.css('display') == 'none') contactPriavcy.show();
				else contactPriavcy.hide();
			}
		});
		
		$('.gallery-loadmore').live({
		    click: function() {
				var id = $(this).data('id'),
					gpage = $(this).data('page'),
					view = $(this).data('view'),
					mode = $(this).data('mode'),
					$galleryELLoadmore = $(this),
					$galleryEL = $('.element[data-id="' + id + '"]'),
					$gContainer = $galleryEL.find('.container'),
					$gLoop = $galleryEL.find('[data-loop="true"]'),
					$gc =  $galleryEL.find('.gallery-category-nav li.active'),
					sfl = ($gc.index() > 0) ? 'category' : '',
					stx = (sfl) ? $gc.text().trim() : '';

		        var val = galleryEL[id],
		        	tag = htmlspecialchars_decode(val.eltag,'ENT_QUOTES'),
		        	g_settings = (typeof val.elsettings != 'undefined' && val.elsettings) ? $.parseJSON(val.elsettings) : {},
		        	folder = (typeof val.folder != 'undefined' && val.folder > 0) ? val.folder : '',
		        	isMasonry = $galleryELLoadmore.hasClass('masonry-layout');

		        var nodes = $gLoop.clone().children(),
					total = 0,
					items = 0,
					gallery_item = '';

				var el_gh = $(tag).find('.goption').attr('data-gh'),
					checkGalleryHeight = (typeof el_gh != 'undefined' && el_gh) ? true : false,
					checkGallerySVG = ($(tag).find('.gimg-svg-wrap').length > 0) ? true : false,
					checkGFrameTitleOFF = (val.mode == 'gallery' && (typeof g_settings.gframe_title_visible != 'undefined' && g_settings.gframe_title_visible == 'OFF')) ? true : false;

		        $.ajax({
		            url: '/template/gallery/list/pid/' + id + '/sid/' + property.SID + '/spage/' + property.PAGE + '/page/' + gpage + '/view/' + view,
					data: { g_mode: mode, visible: true, sfl: sfl, stx: stx },
					dataType: 'json',
					type: 'POST',
		            async: false,
		            cache: false,
		            success: function (data) {
		            	$.cookie('gallery-page-' + id, gpage, { path: '/', expires: 12 * 60 * 60 * 1000 });
		                var stx_str = (typeof escape(stx) != 'undefined') ? escape(stx) : '';
		                $.cookie('gallery-category-' + id, stx_str, { path: '/', expires: 12 * 60 * 60 * 1000 });
		                var loop_count = nodes.length;

                        total = (typeof data.total.list_total != 'undefined') ? data.total.list_total : data.total;
		                items = data.list.length;

		                $.each(data.list,function(i,v) {
		                    loop_pos = i%loop_count;
		                    c = nodes[loop_pos];
		                    item_index = ((gpage-1)*loop_count) + i;
							$(c).addClass('gallery-item').attr('data-index',item_index).attr('data-seq',v.seq);

                            var vgsettings = (typeof v.gsettings != 'undefined' && v.gsettings) ? $.parseJSON(v.gsettings) : {},
						        img_path = (typeof vgsettings['storage'] != 'undefined') ? vgsettings['storage'] : _this.b.RESOURCE + '/' + _this.b.SID + '/',
						        img_original = (typeof vgsettings['storage'] != 'undefined') ? img_path + '1920/' : img_path;

							var src = getServeImage(v.image,folder,img_path),
								src_s0 = getServeImage(v.image,'0',img_path);
							$(c).find('img').attr('src', src);
							if(checkGalleryHeight) $(c).find('.g-img').css('background-image', 'url('+src+')');
							if(checkGallerySVG) {
								var gimgSVG = $(c).find('.gimg-svg-wrap svg');
								gimgSVG.find('pattern').attr('id','gimgSvg_'+val.elname+'_'+item_index);
								gimgSVG.find('image').attr('xlink:href', src);
								gimgSVG.find('polygon').attr('fill', 'url(#gimgSvg_'+val.elname+'_'+item_index+')');
							}
							
							var glink = (typeof vgsettings['glink'] != 'undefined' && vgsettings['glink']) ? vgsettings['glink'] : '',
								glink_target = (typeof vgsettings['glink_target'] != 'undefined' && vgsettings['glink_target']) ? vgsettings['glink_target'] : '';

							if(glink) {
								if(glink.match(/^\@/g) !== null) {													// link-type: link-bookmark ==> a[attr-bookmark]
									var bookmark_seq = glink.replace(/^\@/g,'');
									if(typeof _this.b.SETTINGS.blockBookmarkList == 'undefined' || typeof _this.b.SETTINGS.blockBookmarkList['bookmark' + bookmark_seq] == 'undefined') {
										glink = '';
										glink_target = '';
									}
                                } else if(_this.b.MENULIST.includes(glink.replace(/^\//g,'').replace(/ /g,'-'))) {	// link-type: link-menu     ==> a[data-user-link]
                                } else {																			// link-type: link-out      ==> a[attr-link]
									if(checkBase64Encode(glink)) glink = Base64.decode(glink);
								}
							}

							if (typeof v.price_hidden != 'undefined' && v.price_hidden == 'ON' && property['SITEUM'] >= 1) {
								$(c).addClass('gallery-item').addClass('nonePrice');
								$(c).find('a').attr('href', '#');
							} else {
                                if(glink) {
									var glink_val = makeLinkUrl(glink, b.ONE, b.VIEW);

								    $(c).find('a').removeAttr('data-gallery').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');
								    $(c).find('a').attr('href',glink_val);

								    if(_this.b.MENULIST.includes(glink.replace(/ /g,'-'))) {
								        $(c).find('a').attr('data-user-link',glink_val);
								    } else if(glink.match(/^\@/g)) {
								        $(c).find('a').attr('attr-bookmark',glink.replace(/^\@/g,''));
								    } else {
								        $(c).find('a').attr('attr-link',glink);
								    }
                                } else {
		                            $(c).find('a').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');

									if (val.mode == 'gallery') {
										$(c).find('a').attr('href', src_s0);
										$(c).find('a').attr('data-gallery', '#gframe-' + val.seq);
									} else {
										$(c).find('a').removeAttr('data-gallery');
										$(c).find('a').attr('href', ((b.URL=='/') ? '' : b.URL) + '/' + b.PAGE + '/view/' + v.seq);
									}
	                            }
	                        }

		                    if(glink_target == '_blank') $(c).find('a').attr('target','_blank');
		                    else $(c).find('a').removeAttr('target');

							if(v.title.length==0) v.title = 'Title';
							if(v.caption.length==0) v.caption = 'You can change this text';

							if(checkGFrameTitleOFF) $(c).find('a').attr('data-title', '');
							else $(c).find('a').attr('data-title', v.title);

		                    // caption
		                    var ftitle = $(c).find('h5.figure'),
		                        fcaption = $(c).find('p.figure'),
		                        fdatetime = $(c).find('.figure.datetime'),
		                        fhashtag = $(c).find('.figure.hashtag'),
		                        fprice = $(c).find('.figure.price'),
								freview = $(c).find('.figure.review');

		                    // datetime / hashtag
		                    if(fdatetime.length<1) {
		                        $(c).find('figcaption').append('<div class="figure datetime hide"></div>');
		                        fdatetime = $(c).find('.figure.datetime');
		                    }
		                    if(fhashtag.length<1) {
		                        $(c).find('figcaption').append('<div class="figure hashtag hide"></div>');
		                        fhashtag = $(c).find('.figure.hashtag');
		                    }

		                    $(c).find('figcaption').removeClass('hide');
							if(v.title || v.caption) {
								var gallery_caption = v.caption;
								gallery_caption = gallery_caption.replace(/\n/g,'<br />');

								ftitle.html(v.title);
								fcaption.html(gallery_caption);
								fdatetime.text(v.datetime);
								fhashtag.text(v.hashtag);
							}
							if(mode == 'shopping') {

								var checkPriceHidden = (typeof v.price_hidden != 'undefined' && v.price_hidden == 'ON') ? true : false,
									gallery_price = (v.price && !checkPriceHidden) ? v.price : 0,
									gallery_sale_price = (typeof v.sale != 'undefined' && v.sale > 0 && !checkPriceHidden) ? v.sale : 0,
									gallery_sale_per = (typeof v.sale_per != 'undefined' && v.sale_per && !checkPriceHidden) ? v.sale_per : '',
									product_soldout = (typeof g_settings.sh_soldout == 'string') ? g_settings.sh_soldout : '구매불가',
									product_status = ((v.status == 'off' || (v.quantity_on == 'on' && v.quantity < 1)) && product_soldout && !checkPriceHidden) ? '<span class="cl-sh-soldout">' + product_soldout + '</span>' : '';

								$(c).find('.cl-sh-soldout').remove();
								if(product_status != '') $(c).attr('data-soldout',true);
								else $(c).removeAttr('data-soldout');

								if($(c).find('ul.figure.price').length > 0) {
									//Ver02
									if(gallery_price > 0) {
										$(c).find('ul.figure.price .price-val').html('￦' + gallery_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));
										$(c).find('ul.figure.price .price-val').removeClass('hide');

										if(gallery_sale_price > 0) {
											$(c).find('ul.figure.price .price-sale').html('￦' + gallery_sale_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));
											$(c).find('ul.figure.price .price-sale-per').html(gallery_sale_per);
											$(c).find('ul.figure.price .price-sale, ul.figure.price .price-sale-per').removeClass('hide');
										} else {
											$(c).find('ul.figure.price .price-sale, ul.figure.price .price-sale-per').addClass('hide').html('');
										}
									} else {
										$(c).find('ul.figure.price .price-val, ul.figure.price .price-sale, ul.figure.price .price-sale-per').addClass('hide').html('');
									}

									if(product_status) $(c).find('ul.figure.price').append('<li>'+product_status+'</li>');

								} else {
									//Ver01
									if(fprice.length == 0) fprice = fcaption;

									if(checkPriceHidden) fprice.html('');
									else fprice.html('<span class="figure-krw">￦</span>' + gallery_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',') + product_status);
								}

								if($(c).find('ul.figure.review').length > 0) {
									var gallery_review = (v.review_onoff && v.review_cnt) ? v.review_cnt : 0;
									if(gallery_review > 0) {
										$(c).find('ul.figure.review, ul.figure.review li').removeClass('hide');
										$(c).find('ul.figure.review .figure-review-cnt').html(gallery_review);
										$(c).find('ul.figure.review .figure-review-score').html(v.review_score);
									} else {
										$(c).find('ul.figure.review, ul.figure.review li').addClass('hide');
										$(c).find('ul.figure.review .figure-review-cnt, ul.figure.review .figure-review-score').html('');
									}
								}

							} else {
								fprice.addClass('hide');
								freview.addClass('hide');
							}
		                    
		                    if(isMasonry) {
		                        gallery_item = gallery_item + $(c)[0].outerHTML;
		                    } else {
		                        $gLoop.append($(c)[0].outerHTML);    
		                    }
		                });
		            }
		        });

				if(isMasonry) {
					var $gallery_items = $(gallery_item);
					$gallery_items.hide();

					$('.gallery-loadmore[data-id="' + id + '"]').before('<div class="gallery-loading-status"><div class="loading-dots"></div></div>');
					var process_index = 0;		            
					$gallery_items.imagesLoaded().progress(function(imgload, image) {
						process_index++;
						var $item = $(image.img).parents('.grid');
						$item.show();
						if(items == process_index) {
							reloadMasonry($gContainer,$gallery_items);

							if(checkGalleryHeight) refreshGalleryHeight();
							refreshGalleryField($galleryEL,g_settings);
						}
					});
				} else {
					if(checkGalleryHeight) refreshGalleryHeight();
					refreshGalleryField($galleryEL,g_settings);
				}

				var cookie_page = gpage,
					new_view = (view > total) ? total : view,
					cookie_view = ( (cookie_page*new_view) > total ) ? total : cookie_page*new_view;

				$galleryEL.find('.display').text(cookie_view);

				if(total<=cookie_view) $('.gallery-loadmore[data-id="'+id+'"]').fadeOut();
				if(items) $galleryELLoadmore.data('page', cookie_page + 1);

				if($galleryEL.find('*[data-direffect="true"]').length > 0 ) {
					setTimeout(function() {
						$galleryEL.find('.grid').each(function() {
							$(this).hoverdir();
						});
					}, 400);
				}
			}
		});

		$('.gallery-item a[title]').live('mouseenter', function () {
		    $(this).tooltip('destroy');
		});

		$('.gallery-item').live('click', function(e) {
			var pid = $(this).parents('.element').attr('data-id');
		    $('.blueimp-gallery').addClass('blueimp-gallery-controls');
		    $('.blueimp-gallery a.view-original').remove();
		    if($(this).find('a').attr('data-img-original') == 'ON') {
			    $('.blueimp-gallery a.close').after('<a class="view-original" data-id="' + pid + '"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M24 22.94l-6.42-6.42C19.08 14.76 20 12.49 20 10c0-5.52-4.48-10-10-10S0 4.48 0 10s4.48 10 10 10c2.49 0 4.76-0.92 6.52-2.42L22.94 24 24 22.94zM1.5 10c0-4.69 3.81-8.5 8.5-8.5 4.69 0 8.5 3.81 8.5 8.5s-3.81 8.5-8.5 8.5C5.31 18.5 1.5 14.69 1.5 10z"/><polygon points="10.75 6 9.25 6 9.25 9.25 6 9.25 6 10.75 9.25 10.75 9.25 14 10.75 14 10.75 10.75 14 10.75 14 9.25 10.75 9.25 "/></svg></a>');
			}
			$('.blueimp-gallery').find('h3.title').text($(this).find('a').attr('data-title'));

		   	$.cookie('gallery-item', $(this).attr('data-seq'), { path : '/', expires: 12 * 60 * 60 * 1000 });
		   	if(b.PARENT.prev != null) $('.data-page-prev').addClass('active');
		   	if(b.PARENT.next != null) $('.data-page-next').addClass('active');
			e.stopPropagation();
		});

		$('body').on('click','.blueimp-gallery a.view-original', function(e) {
		    var idx = 0,
		        eid = $(this).attr('data-id');
		    $('#gframe-' + eid + ' .slide').each(function(i,v) {
		        var trans = $(v).attr('style');
		        if(trans.indexOf('translate(0px, 0px)') > -1 || trans.indexOf('transform: translate(0px) translateZ(0px)') > -1) {
		            idx=i;
		        }
		    });
		    var src = $('#gframe-' + eid + ' .slide[data-index="' + idx + '"] > img').attr('src');

		    $('.blueimp-gallery a.view-original').attr('href',src).attr('target','_blank');
		    e.stopPropagation();
		});

		/* page count */
		if(Object.keys(b.CONTENTS).length) {
			var ps_elupdate = this.contentUpdate(b.CONTENTS),
				vpmode = (typeof $('.mobilepc_ch').attr('data-desktop-option') != 'undefined') ? $('.mobilepc_ch').attr('data-desktop-option') : b.SETTINGS.viewportMode;
			ps_elupdate.then(function() {
				elFooter();
				if(b.COUNT) {
					if(b.PARENT.mode == 'shopping') {
						if($('#review-onoff').val() == 'true') $.products.review(b.VIEW,b.PAGE);
						if($('#qna-onoff').val() == 'true') $.products.qna(b.VIEW,b.PAGE);
					} else _this.displayComment(b.VIEW);
				}
			}).then(function() {
		        if(typeof b.SETTINGS.viewportMode != 'undefined' && b.SETTINGS.vpMode_onoff===true) $.mpcWeb.mpcWebhtml(vpmode,b.CONTENTS,b.SETTINGS.zoom);
			}).then(function() {
				if(b.VIEW && b.PARENT.mode != 'shopping') displayPageToolbar();
			}).then(function() {
	    		if(b.VIEW && b.PARENT.mode != 'shopping') displaySnsShare(b.PARENT.pid);
	    	}).then(function() {
				if(b.VIEW && b.PARENT.mode != 'shopping') displayBottomList(b.PARENT.pid);
			}).then(function() {
				var ismodeSm = ($('.cl-s-page').hasClass('mode-shopping')) ? true : false;

				if(!ismodeSm && b.ONE && !b.VIEW || b.PAGE == b.MENULINK[0] && !b.VIEW) setSitePopup(); 
				if(b.VALIDPLAN && (b.VALIDTYPE == 'BN' || b.VALIDTYPE == 'SM')) {
					if(typeof b.SETTINGS.fnav != 'undefined' && !$.isEmptyObject(b.SETTINGS.fnav)) $.fnav.draw(b.SETTINGS.fnav);
				}

				if(typeof b.SETTINGS.viewportMode != 'undefined' && b.SETTINGS.vpMode_onoff===true) mobileWebfnavCheck(vpmode);
	    	});
		} 
		else {
			var checkUrl = b.PAGE.split(","),
				vpmode = (typeof $('.mobilepc_ch').attr('data-desktop-option') != 'undefined') ? $('.mobilepc_ch').attr('data-desktop-option') : b.SETTINGS.viewportMode;

			if(property.COUNT==0) {
				elFooter();
			    if(checkUrl[0] == "forum" && b.VIEW) {
					var ps_fmview = $.forum.view(b.VIEW);
					ps_fmview.then(function() {
						_this.displayComment(b.VIEW);
					}).then(function() {
						if(b.VIEW) {
							displaySnsShare(b.PARENT.pid);
							displayBottomList(b.PARENT.pid);
						}
						if(b.VALIDPLAN && (b.VALIDTYPE == 'BN' || b.VALIDTYPE == 'SM')) {
							if(typeof b.SETTINGS.fnav != 'undefined' && !$.isEmptyObject(b.SETTINGS.fnav)) $.fnav.draw(b.SETTINGS.fnav);
						}
						if(typeof b.SETTINGS.viewportMode != 'undefined' && b.SETTINGS.vpMode_onoff===true) {
							$.mpcWeb.mpcWebhtml(vpmode,'',b.SETTINGS.zoom);
							mobileWebfnavCheck(vpmode);		
						}					
					});
				}

				if(property.PAGE == 'psearch') {
					var vpmode = (typeof $('.mobilepc_ch').attr('data-desktop-option') != 'undefined') ? $('.mobilepc_ch').attr('data-desktop-option') : property.SETTINGS.viewportMode;
					if(typeof property.SETTINGS.viewportMode != 'undefined' && property.SETTINGS.vpMode_onoff===true) $.mpcWeb.mpcWebhtml(vpmode,property.CONTENTS,property.SETTINGS.zoom);

					setTimeout(function() {
						if(property.VALIDPLAN && (property.VALIDTYPE == 'BN' || property.VALIDTYPE == 'SM')) {
							if(typeof property.SETTINGS.fnav != 'undefined' && !$.isEmptyObject(property.SETTINGS.fnav)) $.fnav.draw(property.SETTINGS.fnav);
						}
						if(typeof property.SETTINGS.viewportMode != 'undefined' && property.SETTINGS.vpMode_onoff===true) mobileWebfnavCheck(vpmode);
					}, 500);
				}

			}
		}

		if(typeof b.SETTINGS.hideScrollTop == 'undefined') {
			$('#goto-top').fadeOut(200).css('visibility','visible');
		}

	    $(window).load(function() {
	    	$('#no-fouc').css('opacity','1');
	        if(typeof $.cookie('gallery-item') != 'undefined' && b.VIEW == '') {
	        	moveGallery($.cookie('gallery-item'));
	        }
	        moveScroll(0);
		    _this.loaded();
		    var musicPlay = true;
		    if(typeof b.SETTINGS.musicStop != 'undefined' && b.SETTINGS.musicStop === true || b.SETTINGS.musicStop == 'true')
		    	musicPlay = false;

		    if(typeof b.SETTINGS.musicUse != 'undefined' && (b.SETTINGS.musicUse === true || b.SETTINGS.musicUse == 'true'))
				$.musicON(musicPlay);

			if(musicPlay == false) $.musicPause();
			var used_disk_value = b.USED_DISK / 1024,
				used_disk = Math.ceil(used_disk_value); // byte으로 가져와서 megsabyte으로 변한다

			if(Number(b.DISK_SPACE) != -1 && (used_disk > b.DISK_SPACE) && (b.MB_LEVEL != 10)) setlimitdiskPopup();

			// menu sidebar - height overflow
			if($('body').width() > 768) {
				$('header.navbar-li #fixed-menu > li.dropdown').live({
					mouseenter: function(e) {
						var this_bottom = $(this).find('.cl-icon').position().top + $(this).find('.cl-icon').height();
						$(this).find('.dropdown-menu').css({
							'top': this_bottom+'px',
						});
					},
					mouseleave: function(e) {
						$(this).find('.dropdown-menu').removeAttr('style');
					}
				});

				$('.sidebar .nav li.dropdown').live({
					mouseenter: function(e) {
						var checkSubMenuPosition = $(this).find('.dropdown-menu').css('position');
						if(checkSubMenuPosition == 'absolute') {
							var this_top = $(this).offset().top - $(document).scrollTop();
							if($(this).closest('header').parent('#element-display').length > 0) this_top -= $(this).closest('header').parent('#element-display').offset().top;

							$(this).find('.dropdown-menu').css({
								'position': 'fixed',
								'top': this_top+'px',
								'left': '260px'
							});
						}
					},
					mouseleave: function(e) {
						$(this).find('.dropdown-menu').removeAttr('style');
					}
				});
			} else {
				$('header.navbar-li #fixed-menu > li.dropdown').find('.dropdown-menu').removeAttr('style');
				$('header.sidebar #tpl-menu > li.dropdown').find('.dropdown-menu').removeAttr('style');
			}


			if(typeof $.cookie('ci_goto-gallery') != 'undefined' && $.cookie('ci_goto-gallery')) {
				var goto_gallery = '.element[data-id="' + $.cookie('ci_goto-gallery') + '"]',
					cookie_domain =  (property.HOST.indexOf(':') > -1) ? property.HOST.substring(0,property.HOST.indexOf(':')) : property.HOST;
				if($(goto_gallery).length > 0) {
					scrollToBlock(goto_gallery, 1000);
				}
				$.cookie('ci_goto-gallery', '', { domain: '.' + cookie_domain,expires: -1 });
				$.cookie('ci_goto-gallery-cate', '', { domain: '.' + cookie_domain,expires: -1 });
			}


	    });
    },
    contentUpdate : function(contents) {
    	// console.log(' page draw:: contentUpdate');

	    var deferred = $.Deferred();
    	var b = this.b,
    		_this = this,
    		idx = 0;

		isMenuLock(function() {
			var default_t_css = '', default_m_css  = '';
			
			var checkGalleryView = (b.VIEW && b.PAGE.match(/^forum,/g) === null) ? true : false,
				page_pos = 0;

	    	$.each(contents, function(i,v) {
	    		page_pos += 1;
	    		
	    		var c = v.element,
	    			$el = $('.' + c.elname),
	    			msny = (c.feature=='masonry') ? true : false;

	            if(c.orgpos==1)  $el.addClass('link-to-'+c.orgpage.replace(/ /g,'-'));

	            $el.addClass('el_' + idx)
	            	.addClass('element')
	            	.addClass('hide')
	                .attr('data-id', c.seq)
	                .attr('data-el','el_' + idx)
	                .attr('data-pos', c.pos)
	                .attr('data-name', c.elname)
	                .attr('data-msny', msny)
	                .attr('data-type', c.type)
	                .attr('data-type2', c.type2)
	                .attr('data-mode', c.mode)
	                .attr('data-width', c.folder)
	                .attr('data-overlap',c.overlap);

				if(checkGalleryView) {
					if(c.page == 'fixedblock_'+b.PARENT.pid) $el.addClass('el-fixedblock');
					else $el.removeClass('el-fixedblock');
					$el.attr('data-pos', page_pos);
					$el.attr('data-ppos', c.pos);
					$el.attr('data-posby', c.elnew);
				}

	            if(b.ISLOCK == 'false') $el.removeClass('hide');
	            else $el.addClass('locked');

	            if(c.type == 'forum' || c.type == 'latest') $el.addClass('preloading');

	            //add style
	            var jcss = CSSJSON.toJSON(c.elcss),
	            	elpd = style.getPadding(jcss,c.elname);

            	var elFonts = $el.css('font-family');
        		elFonts = elFonts + ',"Nanum Gothic"';
        		var reFonts = elFonts.replace(/"/g, '\'');
        		$el.css('font-family',reFonts);

	            var pt = parseInt(elpd.top),
	                pb = parseInt(elpd.bottom);
	                
	            if(pt>0||pb>0){
	                default_t_css = default_t_css + '\n 	.'+c.elname + '{';
	                if(Math.ceil(pt*0.8)>0)
	                default_t_css = default_t_css + 'padding-top: '+Math.ceil(pt*0.8) + 'px!important;';
	                if(Math.ceil(pb*0.8)>0)
	                default_t_css = default_t_css + 'padding-bottom: '+Math.ceil(pb*0.8) + 'px!important;';
	                default_t_css = default_t_css + '}';

	                default_m_css = default_m_css + '\n 	.'+c.elname + '{';
	                if(Math.ceil(pt*0.5)>0)
	                default_m_css = default_m_css + 'padding-top: '+Math.ceil(pt*0.5) + 'px!important;';
	                if(Math.ceil(pb*0.5)>0)
	                default_m_css = default_m_css + 'padding-bottom: '+Math.ceil(pb*0.5) + 'px!important;';
	                default_m_css = default_m_css + '}';
	            }
	            
	            if(idx == Object.keys(b.CONTENTS).length-1){
	                var css = '@media only screen and (max-width:767px) {' + default_t_css + '\n}\n';
	               	css = css + '@media only screen and (max-width:480px) {' + default_m_css + '\n}';

	                if($('#el-paddingcss').length == 0) $('.dsgn-body').find('#el_'+(Object.keys(b.CONTENTS).length-1)+'css').after('<style id="el-paddingcss">'+css+'</style>');
	                else $('#el-paddingcss').append(css);
	            }

	            var settings = (c.elsettings == '' || typeof c.elsettings == 'undefined') ? {} : $.parseJSON(c.elsettings);

				if(typeof settings.bookmark != 'undefined' && settings.bookmark) {
					$el.attr('data-bookmark',c.seq);
				}
				if(b.VIEW && c.type == 'project') {
					$el.find('.data-page-prev').addClass('active');
					$el.find('.data-page-next').addClass('active');

                    if(b.PARENT.prev == null) $el.find('.data-page-prev').removeClass('active');
                    if(b.PARENT.next == null) $el.find('.data-page-next').removeClass('active');
                }

                if(b.VIEW) {
	            	var img_onoff = (typeof settings.img_original_display != 'undefined' && settings.img_original_display) ? settings.img_original_display : 'OFF';
	            	$el.find('img[data-attach="true"]').attr('data-img-original',img_onoff);
                }

                var checkVideoTag = (c.type == 'video' || $el.find('video').length > 0) ? true : false;
				if(checkVideoTag) {
					if (navigator.userAgent.match(/(safari)/gi) !== null) {
						$el.find('video').each(function() {
							//safari...
							$(this).attr('webkit-playsinline',1);
							$(this).attr('playsinline',1);
						});
					}
					if (navigator.userAgent.match(/(iPod|iPhone|iPad)/gi) !== null) {
						$el.find('video').each(function() {
							$(this).removeAttr('muted');
							$(this).removeAttr('loop');
							$(this).removeAttr('autoplay');
							$(this).removeAttr('preload');
						});
					}
				}

				if(c.type == 'forum') {
					_this.forumUpdate(v.element.seq, 1, v.view, c.page, v.list);
				} else if(c.type == 'gallery') {
                    _this.galleryEL[c.seq] = {
                    	'seq' : c.seq,
                    	'elname' : c.elname,
                    	'eltag' : c.eltag,
                    	'folder' : c.folder,
                    	'mode' : c.mode,
                    	'elsettings' : c.elsettings,
                    	'feature' : c.feature,
                    };

					_this.galleryUpdate(c,v);

					if (typeof c.price_hidden != 'undefined' && c.price_hidden == 'ON') {
						$el.find('.figure.price').html('');
					}

				} else if(c.type == 'sns' && c.type2 == 'feed') {
	                $el.find('.data-feed-load-more').attr('data-feed-el',c.elname);
	                $el.find('.data-feed-load-more').removeAttr('style');
	                $el.find('.show-posts').removeClass('show-posts');

	                if(c.mode == 'site') {
						if(!$.isEmptyObject(b.SOCIAL)) {
							var load_sns = {};
							if(!$.isEmptyObject(b.SOCIAL.instagram) && typeof settings.sns_instagram != 'undefined' && settings.sns_instagram == 'ON') load_sns['instagram'] = b.SOCIAL.instagram;
							if(!$.isEmptyObject(b.SOCIAL.twitter) && typeof settings.sns_twitter != 'undefined' && settings.sns_twitter == 'ON') load_sns['twitter'] = b.SOCIAL.twitter;

							if(!$.isEmptyObject(load_sns)) {
								loadingElement(c.elname,'loading posts...');
								updateFeed(c.elname,load_sns,function() {
									$('.'+c.elname+' .listprogress').remove();
								});
							}
						}
	                } else {
						// SNS FEED:: before version
						if(typeof settings.sns != 'undefined' && settings.sns.twitter) {
							loadingElement(c.elname,'loading posts...');
							updateFeed(c.elname,settings.sns);
						}
	                }

				} else if(c.type == 'others' && c.type2 == 'countdown') {
	                var el_dday = $el.find('[data-dday="true"]'),
	                	cd_date = (el_dday.attr('data-countdown')) ? el_dday.attr('data-countdown') : new Date(),
	                    dateformat  = { days : '%D', hours: '%H', minutes: '%M', seconds: '%S' },
	                    dateendformat  = { days : '00', hours: '00', minutes: '00', seconds: '00' };
					
					if( typeof settings.countdown != 'undefined' && settings.countdown ) {  //set - block setting date 
                        cd_date = settings.countdown;
	                }
	                if( !el_dday.attr('data-countdown') && typeof cd_date == 'object' ) { //set - example date
	                    cd_date.setTime(cd_date.getTime() + (35*24*60*60*1000));
	                }
		            cd_date = moment(cd_date).format('YYYY/MM/DD HH:mm:ss');
		            
					el_dday.countdown(cd_date, function(event) {
						$(this).find('.date-item[data-datetype]').each(function(i) {
							var dd_type = $(this).attr('data-datetype'),
								dd_format = $(this).attr('data-format'),
								dd_endformat = $(this).attr('data-finish');

							if(typeof dd_format == 'undefined' || !dd_format) dd_format = dateformat[dd_type];
							if(typeof dd_endformat == 'undefined' || !dd_endformat) dd_endformat = dateendformat[dd_type];

							if(event.elapsed) $(this).text(dd_endformat);
							else $(this).text(event.strftime(dd_format));
						});
					});
				} else if (c.type == 'latest') {
					var latest_data = (typeof settings.latest_data != 'undefined' && settings.latest_data) ? settings.latest_data : {};
					$.latest.init(c.seq,latest_data);					
				}

	            idx++;
	    	});

			// $('.tag.preloading').replaceWith(function () {
			//     return $(this).html();
			// });
			$('.preloading').removeClass('preloading');
			if(b.ISLOCK == 'true') {
				$('.hide.locked').remove();
				return false;
			}
			
			var $el = $('[data-map="true"]');
			$.each($el, function(i,v) {
				var map_url = $(this).attr('data-url'),
					map_style = $(this).attr('data-style'),
					id = $(this).parents('.element').attr('data-id');
				
				$(this).attr('id','map-'+id);
				if(typeof map_url!='undefined' && map_url!='' && typeof id != 'undefined') {
					var is_templates = checkTemplateSite(b.SID);
					if(b.VALIDPLAN || is_templates) {
						loadmap(map_url,'map-'+id, map_style);
					} else {
						$(this).addClass('disabled-map');
					}
				}
			});
	    	$('.dsgn-body').fitVids();

		});
		parallax();

		deferred.resolve();
	    return deferred.promise();
    },
    setLoginout : function (show, sid, site, profileimg) {
		if(show=='1') {
			$.getJSON('/template/checkLogin', function(data) {
				if(data.user && site) {
					if($('#tpl-menu').find('.loginout')) $('#tpl-menu').find('.loginout').remove();
					setLoginoutNav(sid, function() {
						getProfileMember();
						getProfileAuthor(sid,profileimg);
						$('.el_0').css('margin-top','55px');
					});
				} else {
					$('#tpl-menu').append('<li class="loginout"><a href="javascript:;" title="CREATORLINK login"><i class="fa fa-user"></i></a></li>'); 
				}
			});
	    }
    },
    liveUpdate : function(obj) {
    	// console.log('liveUpdate');

    	var b = this.b;
	    var menu = $('#tpl-menu'),
	        idx = 0,
	        regex = /^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,7}(\:[0-9]+)?(\/\S[^\{\}]*)?$/,
	        regex2 = /^((http(s?))\:\/\/)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,7}(\:[0-9]+)?(\/\S[^\{\}]*)?$/;
	    menu.empty();
		if($('.fmcss').length > 0) $('.fmcss').remove(); //forum background css

	    $.each(obj, function (idx, obj) {
	        b.MENULIST.push(obj.name.replace(/ /g,'-'));
	        if(obj.children) {
	            $.each(obj.children, function (idx, obj){
	                b.MENULIST.push(obj.name.replace(/ /g,'-'));
	            });
	        }
	    });

	    for (i = 0; i < obj.length; i++) {
	        var link = obj[i].name,
	            link = (b.MENULIST.includes(link.replace(/ /g,'-'))) ? link.replace(/ /g,'-') : link,
		        parent = b.PAGE.split(','),
	            link_text = '', target = '', isBookmark = '';

	        if(i==0) {
	            if(obj[i].display=='on') b.MENULINK.push(link);
	            continue;
	        }

	        var active = (link == b.PAGE || link == parent[0]) ? 'active' : '',
	            sub = obj[i].children.length;


	        if(b.ONE) {
	        	linkUrl = (b.VIEW) ? '/#' : '#';
	        	linkUrl = (b.VIEW && !b.PUBLISH) ? '/render/index#' : linkUrl;
	        } else {
	            linkUrl = (b.URL=='/') ? '/' : b.URL + '/';  
	        } 

	        if (obj[i].display == 'on') {
				var checkLink = (obj[i].link) ? true : false,
					checkLinkInner = (obj[i].link && b.MENULIST.includes(obj[i].link.replace(/ /g,'-'))) ? true : false,
					checkLinkBookmark = (obj[i].link.match(/^\@/g) !== null) ? true : false;

				link = (checkLink) ? ((checkLinkInner) ? obj[i].link.replace(/ /g,'-') : obj[i].link) : link;
				isBookmark = (checkLinkBookmark) ? 'attr-bookmark="'+link.replace(/^\@/g,'')+'"' : '';
				target = (obj[i].ltarget == '_blank') ? 'target="_blank"' : '';

				if(link != 'folder-menu') b.MENULINK.push(link);
				
				if(checkLink && !checkLinkInner && !checkLinkBookmark) { // link-type: link-out      ==> a[attr-link]
					if(checkBase64Encode(link)) link = Base64.decode(link);
				}

	            if (sub) {
	                var sub_menu = '',
	                    sub_show = 0;

	                sub_menu = '<ul class="dropdown-menu">\r\n';
	                for (j = 0; j < obj[i].children.length; j++) {
	                    var child = obj[i].children,
							checkChildLink = (child[j].link) ? true : false,
							checkChildLinkInner = (b.MENULIST.includes(child[j].link.replace(/ /g,'-'))) ? true : false,
							checkChildLinkBookmark = (child[j].link.match(/^\@/g) !== null) ? true : false,
							child_link = (child[j].link) ? ((checkChildLinkInner) ? child[j].link.replace(/ /g,'-') : child[j].link) : '',
							child_isBookmark = (checkChildLinkBookmark) ? 'attr-bookmark="' + child_link.replace(/^\@/g,'') + '"' : '',
	                    	sub_link = (child_link) ? child_link : child[j].name.replace(/ /g, "-"),
							sub_target = (child[j].ltarget == '_blank') ? 'target="_blank"' : '',
							sub_active = '';

						if(checkChildLink && !checkChildLinkInner && !checkChildLinkBookmark) { // link-type: link-out      ==> a[attr-link]
							if(checkBase64Encode(child_link)) sub_link = Base64.decode(child_link);
						}

						if (!active && (sub_link == b.PAGE || link == parent[0])) {
							sub_active = 'active';
							if($('body').width() > 768) active = 'active';
							else active = 'open';
						}	                    	

	                    if (child[j].display == 'on') {
		                    if(child_link != 'folder-menu') b.MENULINK.push(child[j].name.replace(/ /g, '-'));
	                        link_text = (b.MENULIST.includes(sub_link)) ? linkUrl+sub_link : (!regex2.test(sub_link) && regex.test(sub_link)) ? '//'+sub_link : sub_link ;
	                        sub_menu = sub_menu + '<li class="' + sub_active + '"><a href="' + link_text + '" ' + sub_target + ' ' + child_isBookmark + '>' + child[j].name + '</a></li>\r\n';

	                        sub_show++;
	                    }
	                }
	                sub_menu = sub_menu +'</ul>\r\n';
	                if(link == 'folder-menu') {
	                	link_text = 'javascript:;';
	                	target = '';
	                    if(typeof menu.closest('.navbar-menu-'+b.SID).attr('data-submenu') != 'undefined') target = ' data-toggle="dropdown" aria-expanded="false" data-submenu="true" ';
	                } else {
		                link_text = (b.MENULIST.includes(link)) ? linkUrl + link : (!regex2.test(link) && regex.test(link)) ? '//'+link : link;
		            }

                var caret = ($('header.navbar').hasClass('sidebar')) ? ' <i class="fa fa-caret-right fa-1" aria-hidden="true"></i>' : ' <i class="fa fa-caret-down fa-1" aria-hidden="true"></i>';
                if (sub_show) {
                		var sub_menu_open = (typeof menu.closest('.navbar-menu-'+b.SID).attr('data-submenu') != 'undefined' && menu.closest('.navbar-menu-'+b.SID).attr('data-submenu') == 'open' && active != 'open') ? 'open' : '';
	                	menu.append('\r\n<li class="' + active + ' dropdown ' + sub_menu_open + '"><a href="' + link_text + '" class="dropdown-toggle" ' + target + ' ' + isBookmark + '>' + obj[i].name + caret + '</a></li>\r\n');
	                } else {
	                	menu.append('\r\n<li class="' + active + '"><a href="' + link_text + '" ' + target + ' ' + isBookmark + '>' + obj[i].name + '</a></li>\r\n');
	                }
	                if(sub_show) menu.find('.dropdown:last').append(sub_menu);
	            } else {
	                if(link == 'folder-menu') {
	                	link_text = 'javascript:;';
	                	target = '';
	                    if(typeof menu.closest('.navbar-menu-'+b.SID).attr('data-submenu') != 'undefined') target = ' data-toggle="dropdown" aria-expanded="false" data-submenu="true" ';
	                } else {
		                link_text = (b.MENULIST.includes(link)) ? linkUrl + link : (!regex2.test(link) && regex.test(link)) ? '//'+link : link ;
		            }
	            	menu.append('\r\n<li class="' + active + '"><a href="' + link_text + '" ' + target + ' ' + isBookmark + '>' + obj[i].name + '</a></li>');
	            } 
	            idx++;
	        }
		}



		// menu ver3 : fheader
		//              - Add #fixed-menu, #mobile-nav
		//              - Set mobile-design
		if($('header.navbar').hasClass('navbar-fheader')) $.fheader.init();

		if(typeof b.VALIDPLAN != 'undefined' && b.VALIDPLAN) {
			if(typeof b.VALIDTYPE != 'undefined' && b.VALIDTYPE == 'SM') {
				$.umember.init(b.SITEUM,b.SITEUMLANG,b.SITEUMDISPLAY, function() { 
					$.psearch.init();
					$.shopping.init();
					$.slang.init(b.SLANG);
				});
			} else if(typeof b.VALIDTYPE != 'undefined' && b.VALIDTYPE == 'BN') {
				$.umember.init(b.SITEUM,b.SITEUMLANG,b.SITEUMDISPLAY, function() { 
					$.slang.init(b.SLANG); 
				});
			} else {
				$.slang.init();
			}
		}

		// menu ver3 : fheader
		//             - Set site page top padding
		//             - Set menu config btn position
		if($('header.navbar').hasClass('navbar-fheader')) $.fheader.set();


	    $('header .navbar-nav').removeClass('hide').removeClass('preloading');
	    $('body,html').animate({scrollTop: 0}, 300,'easeInOutQuart');
	},
	galleryUpdate : function(el,data) {
		var _this = this;

		$('#el-empty').append($(data.source));
		$('#el-empty').find('[data-loop="true"]').html('');

		var gallery_empty = false,
			source = data.source,
			nodes = $(source).find('[data-loop="true"]').children(),
			p = $('#el-empty').children(),
            i = [],
            view = $(source).find('[data-loop="true"]').data('view'),
            total = (typeof data.total != 'undefined' && data.total) ? data.total : 0;

        if(typeof view == 'undefined') view = 10;

        var g_settings = (typeof el.elsettings == 'undefined' || el.elsettings == '') ? {} : $.parseJSON(el.elsettings),
        	cookie_page = 1,
            cookie_view = view;
            cookie_gallery_category = '',
            is_gc_cookie = (typeof $.cookie('gallery-category-'+el.seq) != 'undefined' && $.cookie('gallery-category-'+el.seq).length > 0) ? true : false;

		var category_onoff = (typeof g_settings.category_display != 'undefined' && g_settings.category_display) ? g_settings.category_display : 'OFF';
        if(	category_onoff == 'ON' &&
        	typeof $.cookie('ci_goto-gallery') != 'undefined' && $.cookie('ci_goto-gallery') == el.seq &&
        	typeof $.cookie('ci_goto-gallery-cate') != 'undefined' && g_settings.category.indexOf('|' + $.cookie('ci_goto-gallery-cate') + '|') > -1 &&
        	typeof g_settings.category != 'undefined' && g_settings.category 
    	) {
        	cookie_gallery_category = $.cookie('ci_goto-gallery-cate');
        	is_gc_cookie = true;
        } else if($.cookie('loadmore-' + el.seq)) {
			cookie_page = $.cookie('loadmore-'+el.seq);
			cookie_gallery_category = (typeof $.cookie('gallery-category-'+el.seq) != 'undefined') ? $.cookie('gallery-category-'+el.seq) : '';
			cookie_view = cookie_page * view;
        } else { 
			var checkCateHomeHide = (category_onoff == 'ON' &&
									typeof g_settings.category != 'undefined' && g_settings.category && 
									typeof g_settings.category_home_hide != 'undefined' && g_settings.category_home_hide) ? true : false;
			if(checkCateHomeHide) {
				var gc = g_settings.category.replace(/\|/g,'').split(',');
				cookie_gallery_category = gc[0];
				is_gc_cookie = true;

				$.cookie('gallery-catehome-' + el.seq, cookie_gallery_category, { path : '/', expires: 12 * 60 * 60 * 1000 });
			}
        }
		$.cookie('gallery-page-' + el.seq, cookie_page, { path : '/', expires: 12 * 60 * 60 * 1000 });
		$.cookie('gallery-category-' + el.seq, cookie_gallery_category, { path : '/', expires: 12 * 60 * 60 * 1000 });
        $.removeCookie('loadmore-' + el.seq, { path : '/' });

		var el_gh = $(source).find('.goption').attr('data-gh'),
			checkGalleryHeight = (typeof el_gh != 'undefined' && el_gh) ? true : false,
			checkGallerySVG = ($(source).find('.gimg-svg-wrap').length > 0) ? true : false,
			checkGFrameTitleOFF = (el.mode == 'gallery' && (typeof g_settings.gframe_title_visible != 'undefined' && g_settings.gframe_title_visible == 'OFF')) ? true : false;

		var param = (el.page=='index,template' && property.param.indexOf('/org/') == -1) ? property.param + '/org/' + el.page : property.param;
		$.ajax({
			url: '/template/gallery/list/pid/' + el.seq + '/sid/' + el.sid + '/spage/' + el.page + '/view/' + cookie_view + param,
			data: { g_mode: el.mode, visible: true, sfl: 'category', stx: unescape(cookie_gallery_category) },
			dataType: 'json',
			type: 'POST',
			async: false,
			cache: false,
			success: function (g_data) {
				$.each(g_data.list, function (idx, v) {
					i.push(v);
				});
				
				total = (typeof g_data.total.list_total != 'undefined') ? g_data.total.list_total : g_data.total;
				cookie_view = (cookie_view < total) ? cookie_view : total;

				if( total>0 ) gallery_empty = false;
				if( i.length>0 || (i.length==0 && is_gc_cookie) ) {
					var loop_count = nodes.length, item_index = 0, elem = [];
					$.each(g_data.list,function(index,v) {
						loop_pos = index%loop_count;
						c = nodes[loop_pos];

						v.title = (v.title.length>0) ? v.title : 'Title';
						v.caption = (v.caption.length>0) ? v.caption : 'You can change this text';

						$(c).addClass('gallery-item').attr('data-index',index).attr('data-seq',v.seq);

						var vgsettings = (typeof v.gsettings != 'undefined' && v.gsettings) ? $.parseJSON(v.gsettings) : {},
							img_path = (typeof vgsettings['storage'] != 'undefined') ? vgsettings['storage'] : _this.b.RESOURCE + '/' + _this.b.SID + '/',
							img_original = (typeof vgsettings['storage'] != 'undefined') ? img_path + '1920/' : img_path;

						var folder = (data.element.folder == 0) ? '' : data.element.folder + '/',
							src = getServeImage(v.image,data.element.folder,img_path),
							src_s0 = getServeImage(v.image,'0',img_path);
						$(c).find('img').attr('src', src);
						if(checkGalleryHeight) $(c).find('.g-img').css('background-image', 'url('+src+')');
						if(checkGallerySVG) {
							var gimgSVG = $(c).find('.gimg-svg-wrap svg');
							gimgSVG.find('pattern').attr('id','gimgSvg_'+el.elname+'_'+index);
							gimgSVG.find('image').attr('xlink:href', src);
							gimgSVG.find('polygon').attr('fill', 'url(#gimgSvg_'+el.elname+'_'+index+')');							
						}

						var glink = (typeof vgsettings['glink'] != 'undefined' && vgsettings['glink']) ? vgsettings['glink'] : '',
							glink_target = (typeof vgsettings['glink_target'] != 'undefined' && vgsettings['glink_target']) ? vgsettings['glink_target'] : '';

						if(glink) {
							if(glink.match(/^\@/g) !== null) {													// link-type: link-bookmark ==> a[attr-bookmark]
								var bookmark_seq = glink.replace(/^\@/g,'');
								if(typeof _this.b.SETTINGS.blockBookmarkList == 'undefined' || typeof _this.b.SETTINGS.blockBookmarkList['bookmark' + bookmark_seq] == 'undefined') {
									glink = '';
									glink_target = '';
								}
							} else if(_this.b.MENULIST.includes(glink.replace(/^\//g,'').replace(/ /g,'-'))) {	// link-type: link-menu     ==> a[data-user-link]
							} else {																			// link-type: link-out      ==> a[attr-link]
								if(checkBase64Encode(glink)) glink = Base64.decode(glink);
							}
						}

						if (typeof v.price_hidden != 'undefined' && v.price_hidden == 'ON' && property['SITEUM'] >= 1) {
							$(c).addClass('gallery-item').addClass('nonePrice');
							$(c).find('a').attr('href', '#');
						} else {
	                        if(glink) {
								var glink_val = makeLinkUrl(glink, _this.b.ONE, _this.b.VIEW);

							    $(c).find('a').removeAttr('data-gallery').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');
							    $(c).find('a').attr('href',glink_val);

							    if(_this.b.MENULIST.includes(glink.replace(/ /g,'-'))) {
							        $(c).find('a').attr('data-user-link',glink_val);
							    } else if(glink.match(/^\@/g)) {
							        $(c).find('a').attr('attr-bookmark',glink.replace(/^\@/g,''));
							    } else {
							        $(c).find('a').attr('attr-link',glink);
							    }
	                        } else {
	                            $(c).find('a').removeAttr('data-user-link').removeAttr('attr-bookmark').removeAttr('attr-link');
								if (el.mode == 'gallery') {
									$(c).find('a').attr('href', src_s0);
									$(c).find('a').attr('data-gallery', '#gframe-' + el.seq);
								} else {
									if (typeof URL == 'function') URL = '/';
									$(c).find('a').removeAttr('data-gallery');
									$(c).find('a').attr('href', ((_this.b.URL=='/') ? '' : _this.b.URL) + '/' + _this.b.PAGE + '/view/' + v.seq);
								}
	                        }
	                    }

						if(glink_target == '_blank') $(c).find('a').attr('target','_blank');
						else $(c).find('a').removeAttr('target');

						if(checkGFrameTitleOFF) $(c).find('a').attr('data-title', '');
						else $(c).find('a').attr('data-title', v.title);

						// caption
						var ftitle = $(c).find('h5.figure'),
						    fcaption = $(c).find('p.figure'),
						    fdatetime = $(c).find('.figure.datetime'),
						    fhashtag = $(c).find('.figure.hashtag'),
						    fprice = $(c).find('.figure.price'),
							freview = $(c).find('.figure.review');

						// datetime / hashtag
						if(fdatetime.length<1) {
						    $(c).find('figcaption').append('<div class="figure datetime hide"></div>');
						    fdatetime = $(c).find('.figure.datetime');
						}
						if(fhashtag.length<1) {
						    $(c).find('figcaption').append('<div class="figure hashtag hide"></div>');
						    fhashtag = $(c).find('.figure.hashtag');
						}

						$(c).find('figcaption').removeClass('hide');
						if (v.title || v.caption) {
						    var gallery_caption = v.caption;
						    gallery_caption = gallery_caption.trim().replace(/\n/g,'<br />');

						    ftitle.html(v.title);
						    fcaption.html(gallery_caption);
						    fdatetime.text(v.datetime);
						    fhashtag.text(v.hashtag);
						}
						if(el.mode == 'shopping') {
							
							var checkPriceHidden = (typeof v.price_hidden != 'undefined' && v.price_hidden == 'ON') ? true : false,
								gallery_price = (v.price && !checkPriceHidden) ? v.price : 0,
								gallery_sale_price = (typeof v.sale != 'undefined' && v.sale > 0 && !checkPriceHidden) ? v.sale : 0,
								gallery_sale_per = (typeof v.sale_per != 'undefined' && v.sale_per && !checkPriceHidden) ? v.sale_per : '',
								product_soldout = (typeof g_settings.sh_soldout == 'string') ? g_settings.sh_soldout : '구매불가',
								product_status = ((v.status == 'off' || (v.quantity_on == 'on' && v.quantity < 1)) && product_soldout && !checkPriceHidden) ? '<span class="cl-sh-soldout">' + product_soldout + '</span>' : '';

							$(c).find('.cl-sh-soldout').remove();
							if(product_status != '') $(c).attr('data-soldout',true);
							else $(c).removeAttr('data-soldout');

							if($(c).find('ul.figure.price').length > 0) {
								//Ver2
								if(gallery_price > 0) {
									$(c).find('ul.figure.price .price-val').html('￦' + gallery_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));
									$(c).find('ul.figure.price .price-val').removeClass('hide');

									if(gallery_sale_price > 0) {
										$(c).find('ul.figure.price .price-sale').html('￦' + gallery_sale_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','));
										$(c).find('ul.figure.price .price-sale-per').html(gallery_sale_per);
										$(c).find('ul.figure.price .price-sale, ul.figure.price .price-sale-per').removeClass('hide');
									} else {
										$(c).find('ul.figure.price .price-sale, ul.figure.price .price-sale-per').addClass('hide').html('');
									}
								} else {
									$(c).find('ul.figure.price .price-val, ul.figure.price .price-sale, ul.figure.price .price-sale-per').addClass('hide').html('');
								}

								if(product_status) $(c).find('ul.figure.price').append('<li>'+product_status+'</li>');

							} else {
								//Ver1
								if(fprice.length == 0) fprice = fcaption;

								if(checkPriceHidden) fprice.html('');
								else fprice.html('<span class="figure-krw">￦</span>' + gallery_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,',') + product_status);
							}

							if($(c).find('ul.figure.review').length > 0) {
								var gallery_review = (v.review_onoff && v.review_cnt) ? v.review_cnt : 0;
								if(gallery_review > 0) {
									$(c).find('ul.figure.review, ul.figure.review li').removeClass('hide');
									$(c).find('ul.figure.review .figure-review-cnt').html(gallery_review);
									$(c).find('ul.figure.review .figure-review-score').html(v.review_score);
								} else {
									$(c).find('ul.figure.review, ul.figure.review li').addClass('hide');
									$(c).find('ul.figure.review .figure-review-cnt, ul.figure.review .figure-review-score').html('');
								}
							}

						} else {
							fprice.addClass('hide');
							freview.addClass('hide');
						}
					    

						$(p).find('[data-loop="true"]').append($(c)[0].outerHTML); 
					});
				} else {
					if(el.mode=='project' && _this.b.TEMPLATE == false) {
						nodes.addClass('gallery-item');
						nodes.find('a').attr('href', ((_this.b.URL=='/') ? '' : _this.b.URL) + '/' + _this.b.PAGE + '/view/template').removeAttr('data-gallery').find('img').attr('data-index',0);
					}
					$(p).find('[data-loop="true"]').append(nodes);
				}

			}
        });



        var tag = $(p)[0].outerHTML,
        	$galleryEL = $('.element[data-id="' + el.seq + '"]');
    	
		if (el.mode == 'gallery' && total) tag = appendGalleryFrame($(tag),el.seq,g_settings);
		$galleryEL.html($(tag).html()).removeClass('preloading');

		$('#el-empty').empty();

        // loadmore...
        if (total > view && total > cookie_view) {
			var btn_class = (el.feature=='masonry') ? 'gallery-loadmore masonry-layout' : 'gallery-loadmore',
				btn_txt = (typeof g_settings.loadmore_lang != 'undefined' && g_settings.loadmore_lang == 'KO') ? '더보기' : 'LOAD MORE',
				btn_tag = '<div class="' + btn_class + '" data-total = "' + total + '" data-id="' + el.seq + '" data-page="' + (Number(cookie_page)+1)+ '" data-view="' + view + '" data-folder="' + el.folder + '" data-mode="' + el.mode + '">' + btn_txt + ' &nbsp;(<span class="display">' + cookie_view + '</span> / ' + total + ')</div>';

			if($galleryEL.find('.gallery-loadmore').length > 0) $galleryEL.find('.gallery-loadmore').replaceWith(btn_tag);
			else $galleryEL.append(btn_tag);
        }

		$galleryEL.attr('data-category',category_onoff);
		if(category_onoff == 'ON') {
			loadGalleryCategoryBlock($galleryEL,el.seq,category_onoff,g_settings);

			if(total==0) {
				var gallery_empty_str = '<div class="col-xs-12 col-sm-12 col-md grid empty-txt">' + $.lang[LANG]['editor.gallery.category.empty.list'] + '</div>';
				$galleryEL.find('[data-loop="true"]').addClass('empty').append(gallery_empty_str);

				if(!is_gc_cookie) $galleryEL.find('.gallery-category-nav').addClass('empty');
			}
		}

		if($galleryEL.find('.goption[data-gcol]').length > 0) {
			var gOption = $galleryEL.find('.goption[data-gcol]'),
				gcol = gOption.attr('data-gcol'),
				gcol_t = gOption.attr('data-gcol-t'),
				gcol_m = gOption.attr('data-gcol-m');

			if(typeof gcol_t == 'undefined') { gOption.attr('data-gcol-t',gcol); gcol_t = gcol; }
			if(typeof gcol_m == 'undefined') { gOption.attr('data-gcol-m',gcol_t); }
		}

		refreshGalleryField($galleryEL,g_settings);

		// gallery option - gh
		if ($galleryEL.find('.goption[data-gh]').length > 0) refreshGalleryHeight(el.elname);

        if(el.feature=='masonry') this.refreshMasonry(el.elname);

	},
	forumUpdate : function(pid,page_num,view,page,data) {
		$.forum.update(pid, page_num, view, page, '', '', '',data);
	},
	refreshMasonry : function(el) {
	    var $container = $('.'+el+' .container');
	    $container.imagesLoaded(function () {

	        $container.masonry({
	            itemSelector: '.grid',
	            columnWidth: '.grid'
	        });
	        $container.masonry();

	        $container.find('img').off('load.'+el).on('load.'+el, function () {
	            $container.masonry();
	        });
	    });		
	},
	displayComment : function(pid) {
		var checkUrl = this.b.PAGE.split(','),
			type = (checkUrl[0] == 'forum') ? 'F' : 'P',
			check_view_empty = (this.b.VIEW && this.b.COUNT == 1 && $('.error_404.element[data-name="error_404"]').length == 1) ? true : false;
		if(type == "P" && (this.b.COUNT == 0 || check_view_empty)) {
			$('.error_404.element[data-name="error_404"] *[data-lang]').each(function() {
				$(this).html($.lang[LANG][$(this).attr('data-lang')]);
			});
			return false;
		}

	    var option = (this.b.PARENT.settings) ? jQuery.parseJSON(this.b.PARENT.settings) : {};
	    if(typeof option.comment_display == 'undefined' || !option.comment_display || option.comment_display=="OFF") return false;

	    $.comment.init({
	        pid : pid,
	        type : type
	    });
	},
	loaded : function() {
		var b = _this.b;
		if($('body').width() <= 768 && $('.dsgn-body').hasClass('sidebar')) {
			if($('header.navbar').hasClass('sidebar')) {
				cssSidebar('off');
			}
			//$('.dsgn-body').removeClass('sidebar').addClass('removed-sidebar');
		} else if ($('body').width() > 768 /*&& $('.dsgn-body').hasClass('removed-sidebar')*/) {
			if($('header.navbar').hasClass('sidebar')) {
				cssSidebar('on');
			}
			//$('.dsgn-body').removeClass('removed-sidebar').addClass('sidebar');
		}

		$('.carousel').live('click',function(){
		    $('.carousel').carousel('cycle');
		});

        $('.carousel').carousel({
        	pause: 'none'
        });

        $('[data-fixed-width]').each(function() {
            $(this).css('width',$(this).attr('data-fixed-width')+'px');
        });
        
        SCREEN = getScreen();
        var targetUrl = document.URL,
        	isMoveLink = targetUrl.match(/#/g);

        $('.menu-logo-top').show();

    	if(typeof $.cookie('gallery-item') != 'undefined' && b.VIEW == '') {
    		moveGallery($.cookie('gallery-item'));
    	} else if(typeof $.cookie('forum-item') != 'undefined' && b.VIEW == '') {
    		scrollToBlock('.element[data-id="' + $.cookie('forum-item') + '"]', 1000);
    		$.removeCookie('forum-item', { path : '/' });
    	}

	    if(b.TRAFFICLIMIT) {
	    	if($('.made-with-creatorlink').length > 0) $('.made-with-creatorlink').hide();
	    	var host = (typeof SERVICE == 'undefined') ? property.SERVICE : SERVICE,
	    		str = (host.indexOf('gabia') > -1) ? '\
					<div class="traffic-limit-modal creatorlink-gabia">\
						<div class="inner-box text-center">\
	                        <p class="col-md-12 col-sm-12 col-xs-12">\
	                        	<a href="//www.gabia.com" target="_blank" class="gabia-logo"><img src="//storage.googleapis.com/i.addblock.net/gabia/logo_w.png" alt="Gabia logo" /></a>\
	                        	<img src="//storage.googleapis.com/i.addblock.net/gabia/logo_and.png" class="logo-and"/>\
	                        	<a href="//creatorlink.gabia.com" target="_blank" class="creatorlink-logo"><img src="//storage.googleapis.com/i.addblock.net/creatorlink_logo_w1.png" alt="Creatorlink-gabia logo" /></a>\
	                        	<a href="//www.gabia.com/mygabia/service" target="_blank" class="limit-txt">' + $.lang[LANG]['plan.traffice-space.limit.modal.text.gabia'] + ' </a>\
                        	</p>\
						</div>\
					</div>\
	    	' : '\
					<div class="traffic-limit-modal">\
						<div class="inner-box text-center">\
	                        <p class="col-md-6 col-sm-12 col-xs-12 col-md-offset-3"><a href="//creatorlink.net"><img src="//storage.googleapis.com/i.addblock.net/creatorlink_logo_w.png" alt="Creatorlink logo" />' + $.lang[LANG]['plan.traffice-space.limit.modal.text'] + ' <i class="fa fa-angle-double-right" aria-hidden="true"></i></a></p>\
                            <p class="col-md-3 col-sm-12 col-xs-12"><a href="//creatorlink.net"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> ' + $.lang[LANG]['plan.traffice-space.limit.modal.title'] + '</a></p>\
						</div>\
					</div>\
	    	';
	    	$('body').append(str);
	    } else {
    		if($('.made-with-creatorlink').length > 0 && $('.made-with-creatorlink').css('display') == "none") $('.made-with-creatorlink').show().attr('style','display: block!important');
	    }

    	if($('body').width() > 768) {
    		$('.form-date').attr('type','text');
    		$('.form-date').attr('maxlength','2');
    		$('.date-yyyy').attr('maxlength','4');
    	}

        $.modalOFF();
	},
	loadPage : function(page) {

	}
}

var mobileWebfnavCheck = function(vpmode) {
	var checkFnav = ($('.fnav').length > 0 && vpmode=="mobile_web") ? true : false,
		WebType = $.mpcWeb.mpcCheckWebType();
                
	if(checkFnav && WebType == 'MOBILE') {
		$('.fnav.fnav-mobile-fnav').css('margin-bottom','53px');
		$('.element.el-footer').css('margin-bottom','100px');
	} else {
		$('.mobilepc_ch').css('margin-bottom','0px');
		$('.element.el-footer').css('margin-bottom','0px');
	}	
	
	if(WebType == 'MOBILE') {
		$('.element.el-footer').addClass('mpcwebheight');	
		$.mpcWeb.mpcMusicandGoTop(checkFnav,vpmode); 
	}
}

var setlimitdiskPopup = function() {
	var icon = '<i class="site-space-icon fa fa-exclamation-circle"></i>',
		str = '<div class="site-space-disk">\
					<p>'+$.lang[LANG]['plan.disk-space.popup.limit.contents']+'</p>\
				</div>\
				';

	$(this).showModalFlat(icon + $.lang[LANG]['plan.disk-space.popup.limit.title'], str,false,false).addClass('flat-site-spacelimit-modal');
	$('.modal-backdrop.in').css('opacity','0');
}

var setSitePopup = function() {
    if(typeof property.SETTINGS != 'undefined' && property.SETTINGS.showPopup === true && typeof property.SETTINGS.sitePopup != 'undefined' ) {
        sitePopupOpen();
    }
}

var sitePopupOpen = function(idx,data) {
	var site_popup = (typeof data != 'undefined' & data) ? data : new Array();
	if(site_popup.length == 0)  site_popup = (typeof property.SETTINGS.sitePopup != 'undefined' && property.SETTINGS.sitePopup) ? property.SETTINGS.sitePopup : site_popup;
	if(site_popup.length > 0) {
        $('.refresh-popup').show().removeAttr('style');
        var isShow = true;

		if(typeof idx != 'undefined') {
			if($('#'+property.SID+'Popup'+idx).length == 0) isShow = false;
			else $('#'+property.SID+'Popup'+idx).fadeIn();
		} else {

			if($('.site-popup .modal-popup').length > 0) { 
				$('.site-popup .modal-popup').fadeIn();
			} else { 
				isShow = false; 
			}
		}

		if(!isShow) {
	        var modal = $(this).showPopupModal(site_popup,property.SID);
	        return modal;
	    }
	}
}

var sitePopupResize = function() {

	if($('.popup').find('.modal-popup').length == 0) return false;
	
	var img_w = new Array(),
		total_w = 0,
		add_w = 0,
		d_m = ($('.popup-modal').hasClass('popupimg-overflow-y')) ? 30 : 15;
		d_top = $('.header.el-menu').outerHeight() + 15,
		d_left = 0,
		x = 0, y = 0, y_r = 0;

	$('.modal-popup').each(function(i) {
		if($(this).css('display') != 'none') {
			img_w[i] = $(this).width();
			total_w += img_w[i] + d_m;
		}
	});


	var isOverflow = ($('.dsgn-body').width() < (Number($('.popup-modal').children().eq(0).css('left').replace('px',''))+total_w)) ? true : false,
		display_i = -1;

	if(isOverflow) { $('.popup-modal').addClass('popupimg-overflow-y');
	} else { $('.popup-modal').removeClass('popupimg-overflow-y'); }

	$('.modal-popup').each(function(i) {
		if($(this).css('display') != 'none') {
			display_i++;

			if(isOverflow) {
				x = (display_i==0) ? d_top : d_top + (display_i*30);
				y = d_left + ((display_i+1)*30);
				y_r = 120 - y;

				img_w[i] = 'auto';
			} else {
				d_left = ($('.dsgn-body').width() - total_w)/2;

				x = d_top;
				y = d_left + add_w + (i*15);
			}
			add_w = add_w + $(this).width();

			var css_val = (isOverflow) ? {'top': x +'px', 'left': y+'px', 'right': y_r+'px', 'margin-left': '0px', 'width': img_w[i], 'max-width': $(this).width()} : {'top': x +'px', 'left': y+'px' , 'width': img_w[i]};
			$(this).css(css_val);
		}
	});

}


var activeEL = function(el) {
    if(typeof el == 'undefined' || el=='') return;
    // header_fixed = $('header.navbar').height();
    // var offset = ($('.dsgn-body').hasClass('sidebar')) ? 0 : -header_fixed;
    // $('body').scrollTo('.'+el,0,{offset:offset});

   	scrollToBlock('.'+el);
}

var setLoginoutNav = function (sid, callback) {
	$('.creatorlink-header').remove();
	$('#tpl-menu li.loginout').remove();
	var str = '<div class="creatorlink-header">\n';
	str = str + '<div class="logo-text col-md-4 col-sm-6">\n';
	str = str + '	<a href="http://creatorlink.net"><img src="https://storage.googleapis.com/i.addblock.net/main/site_creatorlink_logo.png" alt="" /></a>\n';
	str = str + '</div>\n';
	str = str + '<div class="data-site col-md-4 col-sm-6 col-xs-6">\n';
	str = str + '	<ul>\n';
	str = str + '		<li class="profile-img"></li>\n';
	str = str + '		<li><span class="text">' + sid + '</span></li>\n';
	str = str + '	</ul>\n';
	str = str + '</div>\n';
	str = str + '<div class="data-user col-md-4 col-sm-6 col-xs-6">\n';
	str = str + '	<ul class="pull-right">\n';
	str = str + '		<li class="profile-img"></li>\n';
	str = str + '		<li><span class="caret"></span></li>\n';
	str = str + '	</ul>\n';
	str = str + '	<div class="message"></div>\n';
	str = str + '</div>\n';
	str = str + '</div>\n';
	str = str + '\n';
	str = str + '\n';
	$('.header.el-menu').before(str);
	var top = ($('header').hasClass('transparent')) ? '0' : '55px';
	$('.header.el-menu').css('top',top);
	if(top == '0') $('.creatorlink-header + .popover + .fixed-position').css('top','0');

	if(typeof callback == 'function') callback();
}

var getProfileAuthor = function(sid,img) {
	var imgstr = (img == 'https://storage.googleapis.com/i.addblock.net/member/profile_default.jpg') ? 'https://storage.googleapis.com/i.addblock.net/member/profile_default_top.png' : img;
	var str = 		'<span class="hexagon">\n';
		str = str + '	<svg viewBox="0 0 32 32">\n';
		str = str + '		<pattern id="pfimg-" + sid +"" patternUnits="userSpaceOnUse" width="32" height="32">\n';
		str = str + '			<image xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""+imgstr+"" x="-2px" y="-2px" width="36" height="36"></image>\n';
		str = str + '		</pattern>\n';
		str = str + '		<polygon points="16 0 30 8 30 24 16 32 2 24 2 8" fill="url(#pfimg-" + sid +")"></polygon>\n';
		str = str + '	</svg>\n';
		str = str + '</span>\n';
	$('.data-site .profile-img').append(str);
}

var getProfileMember = function() {
	$.getJSON('/template/checkLogin', function(data) {
		// if(!data.user) { }
		var imgstr = (data.myimg == 'https://storage.googleapis.com/i.addblock.net/member/profile_default.jpg') ? 'https://storage.googleapis.com/i.addblock.net/member/profile_default_top.png' : data.myimg;
		var str = 		'<span class="hexagon">\n';
			str = str + '	<svg viewBox="0 0 32 32">\n';
			str = str + '		<pattern id="pfimg-" + data.user +"" patternUnits="userSpaceOnUse" width="32" height="32">\n';
			str = str + '			<image xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""+imgstr+"" x="-2px" y="-2px" width="36" height="36"></image>\n';
			str = str + '		</pattern>\n';
			str = str + '		<polygon points="16 0 30 8 30 24 16 32 2 24 2 8" fill="url(#pfimg-" + data.user +")"></polygon>\n';
			str = str + '	</svg>\n';
			str = str + '</span>\n';
		$('.data-user .profile-img').append(str);
		$('.data-user .profile-img').addClass('user-'+data.name);
		$('.data-user .user-name').append('<span>'+data.name+'</span>');
		// $('.data-user .logoutlink').before('<span>You&apos;re logged in as '+data.name+' </span>');

		var str3_mysite = '';
		if($('.data-site ul li span.text').text() == data.sid) {
			$('.data-site').text('');
			var isNewmessage = (data.newCount == 0 ) ? false : true;
			var str2 = 		'<ul class="sub-menu pull-right">\n';
				str2 = str2 + '	<li class="newCount">\n';
				str2 = str2 + '		<a href="/message"><i class="fa fa-envelope"></i>\n';
				if(isNewmessage) str2 = str2 + '<span class="badge">"+data.newCount+"</span>\n';
				str2 = str2 + '</a>\n';
				str2 = str2 + '	</li>\n';
				str2 = str2 + '</ul>\n';
			$(".data-user .message").append(str2);
		} else {
			str3_mysite = '		<div class="item"><a href="http://'+data.sid+'.creatorlink.net"><img src="https://storage.googleapis.com/i.addblock.net/main/icon_mysite.png"/><img src="https://storage.googleapis.com/i.addblock.net/main/icon_mysite_active.png" class="active"/>'+ $.lang[LANG]['header.mysite'] + '</a></div>\n';
		}

		var str3 = 		'<div class="popover bottom" id="pop"+data.name+"">\n';
			str3 = str3 + '	<div class="arrow"></div>\n';
			str3 = str3 + '	<div class="popover-content">\n';
			str3 = str3 + '		<div class="user-name">"+data.name+"</div>\n';
			str3 = str3 + str3_mysite;
			str3 = str3 + '		<div class="item"><a href="http://creatorlink.net"><img src="https://storage.googleapis.com/i.addblock.net/main/icon_dashboard.png"/><img src="https://storage.googleapis.com/i.addblock.net/main/icon_dashboard_active.png" class="active"/>'+ $.lang[LANG]['header.dashboard'] + '</a></div>\n';
			str3 = str3 + '		<div class="item"><a href="/mypage" ><img src="https://storage.googleapis.com/i.addblock.net/main/icon_acc.png"/><img src="https://storage.googleapis.com/i.addblock.net/main/icon_acc_active.png" class="active"/>'+ $.lang[LANG]['header.mypage'] +'</a></div>\n';
			str3 = str3 + '		<div class="item"><a href="/profile/myboard" ><img src="https://storage.googleapis.com/i.addblock.net/main/icon_qna.png"/><img src="https://storage.googleapis.com/i.addblock.net/main/icon_qna_active.png" class="active"/>'+ $.lang[LANG]['header.cts'] +'</a></div>\n';
			str3 = str3 + '		<div class="item user-logout"><a href="/member/login/out" class="logoutlink"><img src="https://storage.googleapis.com/i.addblock.net/main/icon_logout.png"/><img src="https://storage.googleapis.com/i.addblock.net/main/icon_logout_active.png" class="active"/>'+ $.lang[LANG]['header.logout'] + '</a></div>\n';
			str3 = str3 + '	</div>\n';
			str3 = str3 + '	</div>\n';
		$('.creatorlink-header').after(str3);

	});
}

var pageHeight = function() {
    $('.page-comments').css('margin-top','0px');
    $('.el-footer').css('margin-top','0px');
    var docHeight = $('.dsgn-body').height();
    $('.dsgn-body').wrapInner('<div class="dsgn-body-wrap"></div>');
    var dsgnHeight = $('.dsgn-body-wrap').height();
    var diff = docHeight - dsgnHeight;
    $('.dsgn-body > .dsgn-body-wrap').contents().unwrap();
    return (diff>0) ? diff : 0;
}

var setHeight = function(height) {
	if(typeof property.VIEW == 'undefined' || property.VIEW == "") return false;
    if(height>0) {
        height = (typeof MODE == 'undefined') ? height : height-35;
        if($('.page-comments').length) {
            $('.page-comments').css('margin-top',height+'px');
		} else if($('.page-bottomlist').length) {
			$('.page-bottomlist').css('margin-top',height+'px');
        } else if($('.el-footer').length) {
            $('.el-footer').css('margin-top',height+'px');
        }
    }
}

var appendGalleryFrame = function(tpl,seq,elsettings) {
	if(property.TEMPLATE == '') tpl.find('[data-gallery]').attr('data-gallery','#gframe-' + seq);

	var settings = (typeof elsettings == 'object') ? elsettings : {};

    if($.isEmptyObject(settings)) settings = (typeof elsettings != 'undefined' && ($.isEmptyObject(elsettings) === false)) ? $.parseJSON(elsettings) : {};

	var img_onoff = (settings != null && typeof settings.img_original_display != 'undefined' &&  settings.img_original_display) ? settings.img_original_display : 'OFF',
		title_onoff = (settings != null && typeof settings.gframe_title_visible != 'undefined' && settings.gframe_title_visible == 'OFF') ? false : true;

	tpl.find('[data-gallery]').attr({'data-img-original':img_onoff, 'data-gallery-title':title_onoff});
	if(!title_onoff) {
		tpl.find('[data-gallery]').attr({'data-title':''});
	}

	galleryFrame(seq);
	return tpl;
}

var galleryFrame = function (id) {
    var str = '\
		<div id="gframe-' + id + '" class="blueimp-gallery blueimp-gallery-controls">\
		    <div class="slides"></div>\
		    <h3 class="title"><p>caption test</p></h3>\
		    <a class="prev"><img src="https://storage.googleapis.com/i.addblock.net/icon/fa_gframe_prev.png" alt="" /></a>\
		    <a class="next"><img src="https://storage.googleapis.com/i.addblock.net/icon/fa_gframe_next.png" alt="" /></a>\
			<a class="close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="22" height="22"><polygon points="22 1.06 20.94 0 11 9.94 1.06 0 0 1.06 9.94 11 0 20.94 1.06 22 11 12.06 20.94 22 22 20.94 12.06 11 "/></svg></a>\
		    <a class="play-pause"></a>\
		    <ol class="indicator"></ol>\
		</div>\
    ';
    $('.gallery-frame').append(str);
}        

var makeLinkUrl = function(link, one, view) {
    var link_url = '', link_val = '',
        is_menu = (property.MENULIST.includes(link.replace(/ /g,'-'))) ? true : false,
        regex = /^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,7}(\:[0-9]+)?(\/\S[^\{\}]*)?$/,
        regex2 = /^((http(s?))\:\/\/)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,7}(\:[0-9]+)?(\/\S[^\{\}]*)?$/;
    
        if(one) {
        	link_url = (view) ? '/#' : '#';
        	link_url = (view && !property.PUBLISH) ? '/render/index#' : link_url;
        	if(is_menu) link_url = '/';
        } else {
            link_url = (property.URL=='/' || is_menu) ? '/' : property.URL + '/'; 
        }

        if(link) {
            link_val = (property.MENULIST.includes(link.replace(/ /g,'-'))) ? link_url + link.replace(/ /g,'-') : (!regex2.test(link) && regex.test(link)) ? '//'+link : link;
        }
    return link_val;
}

var checkError = function(data) {
    if(typeof data.error != 'undefined' && data.error) {
        alert(data.error);
        if(data.error=='No user data') {
            location.href='/member/login';
        }
        return true;
    }
    return false;
}

var funcCallback = function(func,callback) {
    func();
    if(typeof callback=='function') {
        callback();
    }
}

var cssSidebar = function(onoff) {
	var width = (onoff == 'on') ? '260px' : '',
		dsgn_css = CSSJSON.toJSON($('#dsgn-body').text());

	if(width) {
		if(typeof dsgn_css['children']['.dsgn-body.sidebar'] == 'undefined') {
			dsgn_css['children']['.dsgn-body.sidebar'] = {'children' : {}, 'attributes' : { 'padding-left' : width, 'padding-top': '0px!important' }};
		}
	} else {
		if(typeof dsgn_css['children']['.dsgn-body.sidebar'] != 'undefined') {
			delete dsgn_css['children']['.dsgn-body.sidebar'];
		}
	}

	$('#dsgn-body').text(CSSJSON.toCSS(dsgn_css));
}

var getScreen = function() {
    var wid = window.innerWidth;

    var screen_size = 0;
    if (0 < wid && wid < 480) {
        screen_size = 320;
    } else if(wid <= 480 && wid <768) {
        screen_size = 480;
    } else if (768 <= wid && wid < 992) {
        screen_size = 768;
    } else if (992 <= wid && wid < 1200 ) {
        screen_size = 992;
    } else if (wid >= 1200) {
        screen_size = 1200;
    }

    return screen_size;
}

var getScreenIndex = function() {
    var idx = 0;
    switch(SCREEN) {
        case 320:
        case 480:
            idx = 2;
            break;
        case 769:
            idx = 1;
            break;

        case 992:
        case 1200:
            idx = 0;
            break;

        default : idx = 0; break;
    }
    return idx;
}
var moveGallery = function(element) {
    var header_fixed = $('header.navbar').height(),
    	offset = ($('.dsgn-body').hasClass('sidebar')) ? 0 : -header_fixed,
    	item = $('.gallery-item[data-seq="'+element+'"]');

    if($('header.navbar').hasClass('disableOffset') && !$('.'+link).hasClass('el_0')) offset = 0;
    if(item.length==0) {
    	if($('.element[data-id="'+element+'"]').length > 0) item = $('.element[data-id="'+element+'"]');
    	else return;
    }
    var sTop = item.offset().top + offset;
    $('html, body').animate({
        scrollTop: sTop
    }, 500, 'easeInOutQuart');		  

    $.removeCookie('gallery', { path: '/' });
    $.removeCookie('gallery-item', { path : '/' });
}

var scrollToBlock = function(el,interval) {
	if(typeof interval == 'undefined') interval = 1200;
	if(typeof el == 'undefined' || !el || $(el).length == 0) return;

	var header_fixed = $('header.navbar').outerHeight(),
		offset = $('.dsgn-body').scrollTop();

	if(!$('.dsgn-body').hasClass('sidebar') && !$('header.navbar').hasClass('disableOffset')) offset -= header_fixed;
	var sTop = $(el).offset().top + offset;
	$('html, body').animate({ scrollTop: sTop }, interval, 'easeInOutQuart');
}

var clearDsgnbody = function() {
	$('.psearch-view').remove();
	$('.menu-lock-block').remove();
	$('.config-image-view').hide();
	$('.forum-view').remove();
	$('.page-comments').remove();
	$('.page-bottomlist').remove();
	$('.tpl-page-footer').remove();
	$('.el-footer').hide();
	var element = $('div[class*="el_"]:not([class*=el__])'),
		css = $('style[id*="el_"]:not([id*=el__])'),
		js = $('script[id*="js_"]:not([id*=el__])');

	element.remove();
	css.remove();
	js.remove();
	// $.each(element, function(i,v) {
	// 	$('.el_' + (i+1)).remove();
	// 	$('#el_' + (i+1) + 'css').remove();
	// 	$('#js_' + (i+1)).remove();
	// });
}

var golink = function(_this,link) {
	var wloc = window.location,
		local_link = (wloc.hostname == link.hostname) ? true : false;

	if(local_link) {
    	var loc = link.pathname,
    		uri = (_this.b.PUBLISH) ? loc : loc.replace('/render/','');

    	if((uri == '/render' || uri == '/') && !_this.b.ONE) {
    		uri = _this.b.MENULINK[0];

    		$.each(_this.b.SMENU,function(i,v) {
    			var menu_name = (v.name).replace(' ','-');
    			var checkMenuName = (uri == menu_name) ? true : false,
    				checkMenuLink = (typeof v.link != 'undefined' && v.link) ? true : false;

    			if(checkMenuName && checkMenuLink) {
    				uri = (v.link).replace(' ','-');
    			}
    		});
    		
    	}

    	var go = (_this.b.PUBLISH) ? '/' + uri + link.hash: '/render/' + uri + link.hash;
		_this.history.pushState(null,_this.b.TITLE,go);

		if(typeof $.cookie('forum-item') != 'undefined') {
			setTimeout(function() {
				scrollToBlock('.element[data-id="' + $.cookie('forum-item') + '"]', 1000);
	    		$.removeCookie('forum-item', { path : '/' });
			}, 300);
		}
	} else {
		location.href = link.href;
	}
}

var parallax = function() {
	var deviceScreen = getScreen();
    $('.element[data-parallax="true"]').each(function() {
        //var yPos = -($('body').height() - $(document).scrollTop());
        // var yPos = -($(this).offset().top - $(document).scrollTop());

        // yPos = (yPos/100);
        // coords = '50% '+ yPos + 'px';
        // if(isMobile())
	       //  $(this).css('background-attachment','fixed !important');
        // else 
        var deviceAgent = navigator.userAgent.toLowerCase();
		if (deviceAgent.match(/(iphone|ipod|ipad)/)) {
			$(this).css('background-attachment','scroll');
		} else {
			$(this).css('background-attachment','fixed');
		}
        $(this).css('background-position','center center');
        $(this).css('-webkit-background-size','cover');
		$(this).css('-moz-background-size','cover');
		$(this).css('-o-background-size','cover');
		$(this).css('background-size','cover');
        $(this).css('background-repeat','no-repeat');
    });
}


		var loadGalleryCategoryBlock = function(el,pid,category_onoff,elsettings) {
		    var $el = el,
		        margin_val = $el.find('.row[data-loop="true"]').css('margin-left'),
		        padding_val = $el.find('.grid').first().css('padding-left'),
		        gc = (category_onoff == 'ON') ? true : false;

		    if(pid) {
		        if(gc) {
					var gallery_category_html = galleryCategoryBlockNav(pid,category_onoff,elsettings);
		            if($el.find('.gallery-category-wrap').length == 0) {
		                if(typeof $el.attr('data-msny') != 'undefined' && $el.attr('data-msny') == 'true' ) {
		                	if($el.find('.goption').length > 0) $el.find('.goption').after(gallery_category_html);
		                	else $el.prepend(gallery_category_html);
		                } else {
		                	$el.find('[data-loop="true"]').before(gallery_category_html);
		                }
		            } else {
		                $el.find('.gallery-category-wrap').replaceWith(gallery_category_html);
		            }
				    if($el.find('.row[data-loop="true"]').find('.emptyGalleryItem').length > 0 && $el.find('.gallery-category-nav .active').index() == 0) $el.find('.gallery-category-nav').addClass('empty');
		        } else {
		            $el.find('.gallery-category-wrap').remove();
		        }
		    }


			var checkGalleryPadding = ($el.find('.goption[data-gpd]').length > 0) ? true : false;
			if(checkGalleryPadding) {
			} else {
				// before Ver
				$el.find('.gallery-category-wrap').css({'margin-left': margin_val, 'margin-right': margin_val });
				$el.find('.gallery-category-nav').css({'padding-left': padding_val, 'padding-right': padding_val });

				var gc_width_control = ($el.find('.container').hasClass('full-width')) ? true : false; 
				if(typeof $el.attr('data-msny') != 'undefined' && $el.attr('data-msny') == 'true' || gc_width_control) {
					var width = (gc_width_control && $el.find('.container').css('margin') == '0px') ? $el.find('.container').outerWidth()-40 : $el.find('.container').outerWidth();
					$el.find('.gallery-category-wrap').css({'width': width, 'margin':'0 auto'});
				}
			}

			if($el.find('.row[data-loop="true"]').css('overflow') == 'hidden') $el.find('.row[data-loop="true"]').css('overflow','visible');
		}

		var galleryCategoryBlockNav = function(pid,category_onoff,elsettings) {
		    var gallery_category_home = (typeof elsettings.category_home == 'undefined') ? 'All' : elsettings.category_home,
        		gallery_settings_category = (typeof elsettings.category == 'undefined') ? '' : elsettings.category.replace(/\|/g,'').replace(/\,/g,', '),
			    gallery_settings_category_color = (typeof elsettings.category_color_type == 'undefined') ? '' : elsettings.category_color_type,
			    category_nav_list = '',
			    g_category = (typeof gallery_settings_category != 'undefined' && gallery_settings_category) ? gallery_settings_category.split(',') : {};

	        var active_arr = [],
	            cookie_gallery_category = unescape($.cookie('gallery-category-'+pid));

	        $.each(g_category, function(i,v) {
	            var active = (v.trim() == cookie_gallery_category) ? 'active' : '';
	            active_arr.push(active);
	            if(v) category_nav_list = category_nav_list + '\
	                    <li class="'+active+'"><a href="javascript:;" data-idx="'+ (i+1) +'">'+v.trim()+'</a></li>\
	                ';
	        });

	        var active_empty = ($.inArray('active',active_arr) == -1) ? 'active' : '',
	        	active_home = (typeof elsettings.category_home_hide != 'undefined' && (elsettings.category_home_hide == 'true' || elsettings.category_home_hide === true)) ? ' hide' : '',
	        	str = '\
	            <div class="gallery-category-wrap">\
	                <ul class="gallery-category-nav" data-category-color="' + gallery_settings_category_color + '">\
	                    <li class="'+active_empty+active_home+'"><a href="javascript:;" data-idx="0">' + gallery_category_home + '</a></li>\
	                    ' + category_nav_list + '\
	                </ul>\
	            </div>\
	        ';
		    return str;
		}

function isMenuLock(callback) {
    var is_lock_block = 'active', r;
    if(property.ISLOCK == 'true') { 
    	r = $.post('/template/menuLockController/type/lock_check', {s: property.SMENU, sid: property.SID, page: property.PAGE, publish : property.PUBLISH}, function(data) {
			var lock_type = data.lock_type,
				lock_error_type = (typeof data.error_data != 'undefined' && data.error_data.type) ? '.' + data.error_data.type : '';

			if(!data.error && data.result) { 
				property.ISLOCK = 'false';
			} else {
				var text = $.lang[LANG]['render.meun-lock.' + lock_type + '.text'];

				if (lock_type=='umlevel') {
					if(lock_error_type == '' && property.SITEUM == '1') lock_error_type = '.onlylogin';

					text = $.lang[LANG]['render.meun-lock.' + lock_type + '.text' + lock_error_type ];
					if(lock_error_type == '.lowerlevel') text = text.replace(/\#/gi, data.error_data.umlevel);
				}

				var str = '\
							<div class="menu-lock-block">\
								<div class="inner-box text-center">\
									<div class="form-inline" role="form">\
										<div clas="text">\
											<p> ' + text + ' </p>\
										</div>';
					if(lock_type=='password') {
						str = str + '\
										<div clas="form-group">\
											<input class="form-control" type="password" placeholder="password" data-lock-password=""/>\
											<label class="error-text"></label>\
										</div>\
										<div clas="form-group">\
											<span class="btn" data-edit="true" data-selector=".btn" data-lock-submit="">Okay</span>\
										</div>\
						';
					}
					str = str + '\
									</div>\
								</div>\
							</div>\
				';
		        $('.header.el-menu').after(htmlspecialchars_decode(str));
			}
		    if(typeof callback == 'function') {
		    	callback();
		    }

    	},'json');
    } else {
	    if(typeof callback == 'function') {
	    	callback();
	    }
	}
}

function galleryStartHover() {
    $(this).find('figure').addClass('hover');
};
function galleryCloseHover() {
    $(this).find('figure').removeClass('hover');
};
function galleryMovelink() {
	$(this).find('a').click();
};

$(function () {
	$(document).on('click', '.nonePrice', function () {
		alert('로그인 후 이용이 가능합니다.');
		if (property['VALIDTYPE'] != 'SM') {
			$('.login .cl_icon_profile').click();
		} else {
			location.href='/_login';
		}
		return false;
	});
});